


<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The minting contract &#8212; Concordium  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/style.css?v=87251df2" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tippy.css?v=6175c28d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=716d1818"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/nft-minting-w-id/minting-sc';</script>
    <link rel="icon" href="../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Frontend development" href="frontend.html" />
    <link rel="prev" title="The verifier backend" href="verifier-backend.html" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item"><style>
.navbar-brand img {
    max-height: 200px;
    width: auto;
}
</style>

<div>
    <a href="https://academy.concordium.software/">
        <img class="logo" src="../../_static/concordium-logo-dark.svg" />
    </a>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><style>
  body {margin:0;}
  
  .navbar-menu {
    position: relative;
    margin-left: 190px;
    background: none;
  }
  
  .navbar-light {
      background: #ededed!important;
      box-shadow: none;
  }
  
  .navbar-menu a {
    float: left;
    display: inline;
    text-align: center;
    color: var(--font-color);
    font-size: 15px;
    font-family: 'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;
  }
  
  /* Dropdown Button */
  .dropbtn {
    background: none;
    color: black;
    font-size: 16px;
    font-weight: 600;
    padding-left: 20px;
    padding-right: 20px;
    border: none;
    font-family: inherit; /* Important for vertical align on mobile phones */
    margin: 0; /* Important for vertical align on mobile phones */
  }
  
  /* The dropdown container */
  .dropdown {
      float: left;
    }
  
    /* Dropdown content (hidden by default) */
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }
  
    /* Links inside the dropdown */
    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }
  
    /* Show the dropdown menu on hover */
    .dropdown:hover .dropdown-content {
      display: block;
    }
  
  /* Large devices (laptops/desktops, 992px to 768px ) */
  @media only screen and (max-width: 1178px) {
    .navbar-menu {
      display: none;}
  
  }
  </style>
<div class="navbar-menu w3-hide-medium w3-hide-small">
  <div class="dropdown">
    <button class="dropbtn"><a href="../../intro.html">Introduction</a></button>
    <div class="dropdown-content">
      
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../beg-tutorials.html">Beginner</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../mid-tutorials.html">Intermediate</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../adv-tutorials.html">Advanced</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="https://docs.google.com/forms/d/1ks_oWIxbRoW6NGHHjwOGfaO4pVvZAD92me0ChbvzDZc/edit">Claim badge</a></button>
  </div>
  </div>
</div></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/concordium" title="Medium" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-medium fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Medium</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/index.html" title="Documentation" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-book fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Documentation</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><style>
  body {margin:0;}
  
  .navbar-menu {
    position: relative;
    margin-left: 190px;
    background: none;
  }
  
  .navbar-light {
      background: #ededed!important;
      box-shadow: none;
  }
  
  .navbar-menu a {
    float: left;
    display: inline;
    text-align: center;
    color: var(--font-color);
    font-size: 15px;
    font-family: 'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;
  }
  
  /* Dropdown Button */
  .dropbtn {
    background: none;
    color: black;
    font-size: 16px;
    font-weight: 600;
    padding-left: 20px;
    padding-right: 20px;
    border: none;
    font-family: inherit; /* Important for vertical align on mobile phones */
    margin: 0; /* Important for vertical align on mobile phones */
  }
  
  /* The dropdown container */
  .dropdown {
      float: left;
    }
  
    /* Dropdown content (hidden by default) */
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }
  
    /* Links inside the dropdown */
    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }
  
    /* Show the dropdown menu on hover */
    .dropdown:hover .dropdown-content {
      display: block;
    }
  
  /* Large devices (laptops/desktops, 992px to 768px ) */
  @media only screen and (max-width: 1178px) {
    .navbar-menu {
      display: none;}
  
  }
  </style>
<div class="navbar-menu w3-hide-medium w3-hide-small">
  <div class="dropdown">
    <button class="dropbtn"><a href="../../intro.html">Introduction</a></button>
    <div class="dropdown-content">
      
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../beg-tutorials.html">Beginner</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../mid-tutorials.html">Intermediate</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../adv-tutorials.html">Advanced</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="https://docs.google.com/forms/d/1ks_oWIxbRoW6NGHHjwOGfaO4pVvZAD92me0ChbvzDZc/edit">Claim badge</a></button>
  </div>
  </div>
</div></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/concordium" title="Medium" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-medium fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Medium</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/index.html" title="Documentation" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-book fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Documentation</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">NFT minting with ID 2.0</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="verifier-backend.html">The verifier backend</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">The minting contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="frontend.html">Frontend development</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-it-works.html">How it works</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../assignment-3/full-stack-dapp.html">Assignment 3: dApp using WalletConnect</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="the-minting-contract">
<span id="nft-w-id-sc"></span><h1>The minting contract<a class="headerlink" href="#the-minting-contract" title="Link to this heading">#</a></h1>
<p>You will update the <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/tree/main/examples/cis2-multi">cis2-multi contract</a> . Remember what you want to achieve: you would like to have a minting dApp that uses Concordium’s ID layer and according to the scenario, you should prove that you are older than 18 in order to mint a token. The most obvious solution to this is could be to ask for ID proofs from the smart contract, but the proofs are not available to use like that from directly the contract. Instead, to create the same logic using the verifier backend server, you will implement it in the following manner:</p>
<ul class="simple">
<li><p>You assume the owner of the verifier and the smart contract instance owner (dApp owner) is the same person. When you run the verifier backend server, you will use an account’s sign and verify keys.</p></li>
<li><p>While creating a new instance of the contract, the owner has to send its verify key(public key) and the contract will keep it in the state (to verify the signature).</p></li>
<li><p>When a user wants to mint a token, the dApp will ask for a <strong>challenge</strong> and a <strong>statement</strong> from the verifier.</p></li>
<li><p>Using that challenge, the dApp expects that the user accepts the information from his/her wallet that is going to be shared with it.</p></li>
<li><p>The proof will be shared with the verifier backend, and if they are verified then the verifier will sign the public address of the user with its sign key which is given as an input parameter while starting the server.</p></li>
<li><p>This signature will be the input of the minting function and using the public key stored in the state, the smart contract will verify that it’s coming from the verifier and is valid really.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">mint()</span></code> function will be executed.</p></li>
</ul>
<p>Create a project for your smart contract called cis2-multi.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cargo new cis2-multi</span>
</pre></div>
</div>
<p>Add the following dependencies to the <strong>Cargo.toml</strong> file.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[features]</span>
<span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
<span class="n">std</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;concordium-std/std&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;concordium-cis2/std&quot;</span><span class="p">]</span>

<span class="k">[dependencies]</span>
<span class="n">concordium-std</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span>
<span class="n">concordium-cis2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span>
<span class="n">hex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>

<span class="k">[lib]</span>
<span class="n">crate-type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cdylib&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rlib&quot;</span><span class="p">]</span>

<span class="k">[profile.release]</span>
<span class="n">codegen-units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">opt-level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s&quot;</span>
</pre></div>
</div>
<img alt="visual studio code window in dark mode while editing cargo.toml file" src="../../_images/adv-sc1.png" />
<p>Create a <strong>lib.rs</strong> file and copypaste the code from the example contract. Start modification with the <code class="docutils literal notranslate"><span class="pre">State</span></code> struct and add a variable for the <code class="docutils literal notranslate"><span class="pre">verify_key</span></code> and add it to the state’s <code class="docutils literal notranslate"><span class="pre">empty()</span></code> function. Note that unlike a regular <code class="docutils literal notranslate"><span class="pre">empty()</span></code> function, this one takes the <code class="docutils literal notranslate"><span class="pre">verify_key</span></code> as a parameter.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/// The contract state,</span>
<span class="go">///</span>
<span class="go">/// Note: The specification does not specify how to structure the contract state</span>
<span class="go">/// and this could be structured in a more space efficient way.</span>
<span class="gp">#</span><span class="o">[</span>derive<span class="o">(</span>Serial,<span class="w"> </span>DeserialWithState<span class="o">)]</span>
<span class="gp">#</span><span class="o">[</span>concordium<span class="o">(</span><span class="nv">state_parameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S&quot;</span><span class="o">)]</span>
<span class="go">struct State&lt;S&gt; {</span>
<span class="go">    /// The state of addresses.</span>
<span class="go">    state: StateMap&lt;Address, AddressState&lt;S&gt;, S&gt;,</span>
<span class="go">    /// All of the token IDs</span>
<span class="go">    tokens: StateMap&lt;ContractTokenId, MetadataUrl, S&gt;,</span>
<span class="go">    /// Map with contract addresses providing implementations of additional</span>
<span class="go">    /// standards.</span>
<span class="go">    implementors: StateMap&lt;StandardIdentifierOwned, Vec&lt;ContractAddress&gt;, S&gt;,</span>
<span class="go">    verify_key: PublicKeyEd25519,</span>
<span class="go">}</span>


<span class="go">impl&lt;S: HasStateApi&gt; State&lt;S&gt; {</span>
<span class="go">    /// Construct a state with no tokens</span>
<span class="go">    fn empty(state_builder: &amp;mut StateBuilder&lt;S&gt;, verify_key: PublicKeyEd25519) -&gt; Self {</span>
<span class="go">        State {</span>
<span class="go">            state: state_builder.new_map(),</span>
<span class="go">            tokens: state_builder.new_map(),</span>
<span class="go">            implementors: state_builder.new_map(),</span>
<span class="go">            verify_key,</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">/// rest of the state functions below</span>
<span class="go">}</span>
</pre></div>
</div>
<p>While creating a new instance, you will need to store the <code class="docutils literal notranslate"><span class="pre">verify_key</span></code> or the public key of the owner. So create a struct called <code class="docutils literal notranslate"><span class="pre">InitParam</span></code> to get that input parameter.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span><span class="o">[</span>derive<span class="o">(</span>Serial,<span class="w"> </span>Deserial,<span class="w"> </span>SchemaType<span class="o">)]</span>
<span class="go">struct InitParams {</span>
<span class="go">    verify_key: PublicKeyEd25519,</span>
<span class="go">}</span>
</pre></div>
</div>
<p>And for the last part of the state, while minting you will require the signature in order to verify, so the mint parameters should send it. Add it as shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/// The parameter for the contract function `mint` which mints a number of</span>
<span class="go">/// token types and/or amounts of tokens to a given address.</span>
<span class="gp">#</span><span class="o">[</span>derive<span class="o">(</span>Serial,<span class="w"> </span>Deserial,<span class="w"> </span>SchemaType<span class="o">)]</span>
<span class="go">struct MintParams {</span>
<span class="go">    /// Owner of the newly minted tokens.</span>
<span class="go">    owner: Address,</span>
<span class="go">    /// A collection of tokens to mint.</span>
<span class="go">    tokens: collections::BTreeMap&lt;ContractTokenId, (TokenMetadata, ContractTokenAmount)&gt;,</span>
<span class="go">    /// Signature from the owner of the contract</span>
<span class="go">    signature: SignatureEd25519,</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Finally, update the <code class="docutils literal notranslate"><span class="pre">mint()</span></code> function by adding:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span><span class="o">[</span>receive<span class="o">(</span>
<span class="go">    contract = &quot;CIS2-Multi&quot;,</span>
<span class="go">    name = &quot;mint&quot;,</span>
<span class="go">    crypto_primitives,</span>
<span class="go">    parameter = &quot;MintParams&quot;,</span>
<span class="go">    error = &quot;ContractError&quot;,</span>
<span class="go">    enable_logger,</span>
<span class="go">    mutable</span>
<span class="go">)]</span>
<span class="go">fn contract_mint&lt;S: HasStateApi&gt;(</span>
<span class="go">    ctx: &amp;impl HasReceiveContext,</span>
<span class="go">    host: &amp;mut impl HasHost&lt;State&lt;S&gt;, StateApiType = S&gt;,</span>
<span class="go">    logger: &amp;mut impl HasLogger,</span>
<span class="go">    crypto_primitives: &amp;impl HasCryptoPrimitives,</span>
<span class="go">) -&gt; ContractResult&lt;()&gt; {</span>
<span class="go">    // Get the sender of the transaction</span>
<span class="go">    let sender: AccountAddress = match ctx.sender() {</span>
<span class="go">        Address::Account(a) =&gt; a,</span>
<span class="go">        Address::Contract(_) =&gt; bail!(ContractError::Custom(CustomContractError::AccountOnly)),</span>
<span class="go">    };</span>

<span class="go">    // Parse the parameter.</span>
<span class="go">    let params: MintParams = ctx.parameter_cursor().get()?;</span>

<span class="go">    let (state, builder) = host.state_and_builder();</span>

<span class="go">    // Verifying that the signature belongs to the public key which was added at the time of init.</span>
<span class="go">    ensure!(</span>
<span class="go">        crypto_primitives.verify_ed25519_signature(state.verify_key, params.signature, &amp;sender.0),</span>
<span class="go">        ContractError::Unauthorized</span>
<span class="go">    );</span>

<span class="go">    for (token_id, token_info) in params.tokens {</span>
<span class="go">        ensure!(</span>
<span class="go">            state.contains_token(&amp;token_id).eq(&amp;false),</span>
<span class="go">            ContractError::Custom(CustomContractError::TokenAlreadyMinted)</span>
<span class="go">        );</span>

<span class="go">        // Mint the token in the state.</span>
<span class="go">        state.mint(</span>
<span class="go">            &amp;token_id,</span>
<span class="go">            &amp;token_info.0,</span>
<span class="go">            token_info.1,</span>
<span class="go">            &amp;params.owner,</span>
<span class="go">            builder,</span>
<span class="go">        );</span>

<span class="go">        // Event for minted token.</span>
<span class="go">        logger.log(&amp;Cis2Event::Mint(MintEvent {</span>
<span class="go">            token_id,</span>
<span class="go">            amount: token_info.1,</span>
<span class="go">            owner: params.owner,</span>
<span class="go">        }))?;</span>

<span class="go">        // Metadata URL for the token.</span>
<span class="go">        logger.log(&amp;Cis2Event::TokenMetadata::&lt;_, ContractTokenAmount&gt;(</span>
<span class="go">            TokenMetadataEvent {</span>
<span class="go">                token_id,</span>
<span class="go">                metadata_url: token_info.0.to_metadata_url(),</span>
<span class="go">            },</span>
<span class="go">        ))?;</span>
<span class="go">    }</span>
<span class="go">    Ok(())</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Nice! You are done with the smart contract. Without slowing down, start the <a class="reference internal" href="frontend.html#nft-w-id-frontend"><span class="std std-ref">frontend development</span></a>.</p>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="verifier-backend.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">The verifier backend</p>
      </div>
    </a>
    <a class="right-next"
       href="frontend.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Frontend development</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/Concordium/concordium.github.io/edit/main/source/academy/tutorials/nft-minting-w-id/minting-sc.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <style>
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }

    .cc a {
      display: inline-block;
      text-align: left;
      padding: 16px;
      color: black;
      font-size: 8px;
    }
</style>

<div class="cc">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img src="../../_static/cc-sa-by.png" />  Copyright 2021 - 2024, Concordium Software ApS
  </a>
</div>
  <div id="cookie-consent" class="consent">
    <p>This website only aggregates and analyzes the actions you take here if you allow cookies. If you do not allow cookies, it protects your privacy, but also prevents the owner from learning from your actions and creating a better experience for you and other users.</p><p>Note that if you opt in and you clear your cookies, delete the opt-in cookie, or if you change computers or Web browsers, you will need to perform the opt-in procedure again.</p>
    <button onclick="consentGranted()">Allow</button>
    <button onclick="consentDenied()">Decline</button>
    <a href="https://concordium.com/privacy-policy/">Privacy policy</a>
</div>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];

// Save the choice in a cookie
function storeChoice(granted) {
  document.cookie = "cookie-consent=" + granted
}

// Look for a cookie storing the previous choice of the user.
// Returns undefined if no choice was stored, otherwise a boolean for whether the
// user gave consent.
function loadChoice() {
  if (!document.cookie.includes("cookie-consent=")) {
      return undefined;
  }
  return document.cookie.includes("cookie-consent=true")
}

// Removes the cookie consent banner
function removeCookieConsentBanner() {
  document.getElementById("cookie-consent").remove()
}

// Called by the cookie consent banner if granted permission
function consentGranted() {
  storeChoice(true)
  _paq.push(['setCookieConsentGiven']);
  removeCookieConsentBanner()
}

// Called by the cookie consent banner if denied permission
function consentDenied() {
  storeChoice(true)
  removeCookieConsentBanner()
}

const stored = loadChoice();
if (stored) {
 consentGranted()
}

_paq.push(['requireCookieConsent']);
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);

(function() {
    var u="https://concordium.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/concordium.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();

  // remember tracking consent was given for all subsequent page views and visits
_paq.push(['rememberCookieConsentGiven']);

</script>

  </body>
</html>
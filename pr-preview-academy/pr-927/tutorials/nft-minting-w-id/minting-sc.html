


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The minting contract &#8212; Concordium  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tippy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <link rel="shortcut icon" href="../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Front-end development" href="front-end.html" />
    <link rel="prev" title="The verifier back end" href="verifier-backend.html" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" />

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    <style>
.navbar-brand img {
    max-height: 200px;
    width: auto;
}
</style>

<div>
    <a href="https://academy.concordium.software/">
        <img class="logo" src="../../_static/concordium-logo-dark.svg" />
    </a>
</div>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <style>
  body {margin:0;}
  
  .navbar-menu {
    position: relative;
    margin-left: 190px;
    background: none;
  }
  
  .navbar-light {
      background: #ededed!important;
      box-shadow: none;
  }
  
  .navbar-menu a {
    float: left;
    display: inline;
    text-align: center;
    color: var(--font-color);
    font-size: 15px;
    font-family: 'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;
  }
  
  /* Dropdown Button */
  .dropbtn {
    background: none;
    color: black;
    font-size: 16px;
    font-weight: 600;
    padding-left: 20px;
    padding-right: 20px;
    border: none;
    font-family: inherit; /* Important for vertical align on mobile phones */
    margin: 0; /* Important for vertical align on mobile phones */
  }
  
  /* The dropdown container */
  .dropdown {
      float: left;
    }
  
    /* Dropdown content (hidden by default) */
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }
  
    /* Links inside the dropdown */
    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }
  
    /* Show the dropdown menu on hover */
    .dropdown:hover .dropdown-content {
      display: block;
    }
  
  /* Large devices (laptops/desktops, 992px to 768px ) */
  @media only screen and (max-width: 1178px) {
    .navbar-menu {
      display: none;}
  
  }
  </style>
<div class="navbar-menu w3-hide-medium w3-hide-small">
  <div class="dropdown">
    <button class="dropbtn"><a href="../../intro.html">Introduction</a></button>
    <div class="dropdown-content">
      
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../beg-tutorials.html">Beginner</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../mid-tutorials.html">Intermediate</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="../../adv-tutorials.html">Advanced</a></button>
  </div>
  <div class="dropdown">
    <button class="dropbtn"><a href="https://docs.google.com/forms/d/1ks_oWIxbRoW6NGHHjwOGfaO4pVvZAD92me0ChbvzDZc/edit">Claim badge</a></button>
  </div>
  </div>
</div>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/Concordium" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="mailto:support@concordium.software" rel="noopener" target="_blank" title="Support"><span><i class="fas fa-envelope"></i></span>
            <label class="sr-only">Support</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" rel="noopener" target="_blank" title="Monitor"><span><i class="fas fa-chart-line"></i></span>
            <label class="sr-only">Monitor</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://support.concordium.software/latest" rel="noopener" target="_blank" title="Discourse"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" rel="noopener" target="_blank" title="YouTube"><span><i class="fab fa-youtube"></i></span>
            <label class="sr-only">YouTube</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://medium.com/concordium" rel="noopener" target="_blank" title="Medium"><span><i class="fab fa-medium"></i></span>
            <label class="sr-only">Medium</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://developer.concordium.software/en/mainnet/index.html" rel="noopener" target="_blank" title="Documentation"><span><i class="fas fa-book"></i></span>
            <label class="sr-only">Documentation</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   NFT minting with ID 2.0
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="verifier-backend.html">
     The verifier back end
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The minting contract
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="front-end.html">
     Front-end development
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="how-it-works.html">
     How it works
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignment-3/full-stack-dapp.html">
   Assignment 3: dApp using WalletConnect
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/Concordium/concordium.github.io/edit/main/source/academy/tutorials/nft-minting-w-id/minting-sc.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="the-minting-contract">
<span id="nft-w-id-sc"></span><h1>The minting contract<a class="headerlink" href="#the-minting-contract" title="Permalink to this headline">#</a></h1>
<p>You will update the <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/tree/main/examples/cis2-multi">cis2-multi contract</a> . Remember what you want to achieve: you would like to have a minting dApp that uses Concordium’s ID layer and according to the scenario, you should prove that you are older than 18 in order to mint a token. The most obvious solution to this is could be to ask for ID proofs from the smart contract, but the proofs are not available to use like that from directly the contract. Instead, to create the same logic using the verifier back-end server, you will implement it in the following manner:</p>
<ul class="simple">
<li><p>You assume the owner of the verifier and the smart contract instance owner (dApp owner) is the same person. When you run the verifier backend server, you will use an account’s sign and verify keys.</p></li>
<li><p>While creating a new instance of the contract, the owner has to send its verify key(public key) and the contract will keep it in the state (to verify the signature).</p></li>
<li><p>When a user wants to mint a token, the dApp will ask for a <strong>challenge</strong> and a <strong>statement</strong> from the verifier.</p></li>
<li><p>Using that challenge, the dApp expects that the user accepts the information from his/her wallet that is going to be shared with it.</p></li>
<li><p>The proof will be shared with the verifier backend, and if they are verified then the verifier will sign the public address of the user with its sign key which is given as an input parameter while starting the server.</p></li>
<li><p>This signature will be the input of the minting function and using the public key stored in the state, the smart contract will verify that it’s coming from the verifier and is valid really.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">mint()</span></code> function will be executed.</p></li>
</ul>
<p>Create a project for your smart contract called cis2-multi.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cargo new cis2-multi</span>
</pre></div>
</div>
<p>Add the following dependencies to the <strong>Cargo.toml</strong> file.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[features]</span>
<span class="n">default</span> <span class="o">=</span> <span class="k">[&quot;std&quot;]</span>
<span class="n">std</span> <span class="o">=</span> <span class="k">[&quot;concordium-std/std&quot;, &quot;concordium-cis2/std&quot;]</span>

<span class="k">[dependencies]</span>
<span class="n">concordium-std</span> <span class="o">=</span> <span class="p">{</span> <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span> <span class="p">}</span>
<span class="n">concordium-cis2</span> <span class="o">=</span> <span class="p">{</span> <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="n">default-features</span> <span class="o">=</span> <span class="n">false</span> <span class="p">}</span>
<span class="n">hex</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span>

<span class="k">[lib]</span>
<span class="n">crate-type</span><span class="o">=</span><span class="k">[&quot;cdylib&quot;, &quot;rlib&quot;]</span>

<span class="k">[profile.release]</span>
<span class="n">codegen-units</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">opt-level</span> <span class="o">=</span> <span class="s">&quot;s&quot;</span>
</pre></div>
</div>
<img alt="visual studio code window in dark mode while editing cargo.toml file" src="../../_images/adv-sc1.png" />
<p>Create a <strong>lib.rs</strong> file and copypaste the code from the example contract. Start modification with the <code class="docutils literal notranslate"><span class="pre">State</span></code> struct and add a variable for the <code class="docutils literal notranslate"><span class="pre">verify_key</span></code> and add it to the state’s <code class="docutils literal notranslate"><span class="pre">empty()</span></code> function. Note that unlike a regular <code class="docutils literal notranslate"><span class="pre">empty()</span></code> function, this one takes the <code class="docutils literal notranslate"><span class="pre">verify_key</span></code> as a parameter.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/// The contract state,</span>
<span class="go">///</span>
<span class="go">/// Note: The specification does not specify how to structure the contract state</span>
<span class="go">/// and this could be structured in a more space efficient way.</span>
<span class="gp">#</span><span class="o">[</span>derive<span class="o">(</span>Serial, DeserialWithState, StateClone<span class="o">)]</span>
<span class="gp">#</span><span class="o">[</span>concordium<span class="o">(</span><span class="nv">state_parameter</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span><span class="o">)]</span>
<span class="go">struct State&lt;S&gt; {</span>
<span class="go">    /// The state of addresses.</span>
<span class="go">    state: StateMap&lt;Address, AddressState&lt;S&gt;, S&gt;,</span>
<span class="go">    /// All of the token IDs</span>
<span class="go">    tokens: StateMap&lt;ContractTokenId, MetadataUrl, S&gt;,</span>
<span class="go">    /// Map with contract addresses providing implementations of additional</span>
<span class="go">    /// standards.</span>
<span class="go">    implementors: StateMap&lt;StandardIdentifierOwned, Vec&lt;ContractAddress&gt;, S&gt;,</span>
<span class="go">    verify_key: PublicKeyEd25519,</span>
<span class="go">}</span>


<span class="go">impl&lt;S: HasStateApi&gt; State&lt;S&gt; {</span>
<span class="go">    /// Construct a state with no tokens</span>
<span class="go">    fn empty(state_builder: &amp;mut StateBuilder&lt;S&gt;, verify_key: PublicKeyEd25519) -&gt; Self {</span>
<span class="go">        State {</span>
<span class="go">            state: state_builder.new_map(),</span>
<span class="go">            tokens: state_builder.new_map(),</span>
<span class="go">            implementors: state_builder.new_map(),</span>
<span class="go">            verify_key,</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">/// rest of the state functions below</span>
<span class="go">}</span>
</pre></div>
</div>
<p>While creating a new instance, you will need to store the <code class="docutils literal notranslate"><span class="pre">verify_key</span></code> or the public key of the owner. So create a struct called <code class="docutils literal notranslate"><span class="pre">InitParam</span></code> to get that input parameter.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span><span class="o">[</span>derive<span class="o">(</span>Serial, Deserial, SchemaType<span class="o">)]</span>
<span class="go">struct InitParams {</span>
<span class="go">    verify_key: PublicKeyEd25519,</span>
<span class="go">}</span>
</pre></div>
</div>
<p>And for the last part of the state, while minting you will require the signature in order to verify, so the mint parameters should send it. Add it as shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/// The parameter for the contract function `mint` which mints a number of</span>
<span class="go">/// token types and/or amounts of tokens to a given address.</span>
<span class="gp">#</span><span class="o">[</span>derive<span class="o">(</span>Serial, Deserial, SchemaType<span class="o">)]</span>
<span class="go">struct MintParams {</span>
<span class="go">    /// Owner of the newly minted tokens.</span>
<span class="go">    owner: Address,</span>
<span class="go">    /// A collection of tokens to mint.</span>
<span class="go">    tokens: collections::BTreeMap&lt;ContractTokenId, (TokenMetadata, ContractTokenAmount)&gt;,</span>
<span class="go">    /// Signature from the owner of the contract</span>
<span class="go">    signature: SignatureEd25519,</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Finally, update the <code class="docutils literal notranslate"><span class="pre">mint()</span></code> function by adding:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span><span class="o">[</span>receive<span class="o">(</span>
<span class="go">    contract = &quot;CIS2-Multi&quot;,</span>
<span class="go">    name = &quot;mint&quot;,</span>
<span class="go">    crypto_primitives,</span>
<span class="go">    parameter = &quot;MintParams&quot;,</span>
<span class="go">    error = &quot;ContractError&quot;,</span>
<span class="go">    enable_logger,</span>
<span class="go">    mutable</span>
<span class="go">)]</span>
<span class="go">fn contract_mint&lt;S: HasStateApi&gt;(</span>
<span class="go">    ctx: &amp;impl HasReceiveContext,</span>
<span class="go">    host: &amp;mut impl HasHost&lt;State&lt;S&gt;, StateApiType = S&gt;,</span>
<span class="go">    logger: &amp;mut impl HasLogger,</span>
<span class="go">    crypto_primitives: &amp;impl HasCryptoPrimitives,</span>
<span class="go">) -&gt; ContractResult&lt;()&gt; {</span>
<span class="go">    // Get the sender of the transaction</span>
<span class="go">    let sender: AccountAddress = match ctx.sender() {</span>
<span class="go">        Address::Account(a) =&gt; a,</span>
<span class="go">        Address::Contract(_) =&gt; bail!(ContractError::Custom(CustomContractError::AccountOnly)),</span>
<span class="go">    };</span>

<span class="go">    // Parse the parameter.</span>
<span class="go">    let params: MintParams = ctx.parameter_cursor().get()?;</span>

<span class="go">    let (state, builder) = host.state_and_builder();</span>

<span class="go">    // Verifying that the signature belongs to the public key which was added at the time of init.</span>
<span class="go">    ensure!(</span>
<span class="go">        crypto_primitives.verify_ed25519_signature(state.verify_key, params.signature, &amp;sender.0),</span>
<span class="go">        ContractError::Unauthorized</span>
<span class="go">    );</span>

<span class="go">    for (token_id, token_info) in params.tokens {</span>
<span class="go">        ensure!(</span>
<span class="go">            state.contains_token(&amp;token_id).eq(&amp;false),</span>
<span class="go">            ContractError::Custom(CustomContractError::TokenAlreadyMinted)</span>
<span class="go">        );</span>

<span class="go">        // Mint the token in the state.</span>
<span class="go">        state.mint(</span>
<span class="go">            &amp;token_id,</span>
<span class="go">            &amp;token_info.0,</span>
<span class="go">            token_info.1,</span>
<span class="go">            &amp;params.owner,</span>
<span class="go">            builder,</span>
<span class="go">        );</span>

<span class="go">        // Event for minted token.</span>
<span class="go">        logger.log(&amp;Cis2Event::Mint(MintEvent {</span>
<span class="go">            token_id,</span>
<span class="go">            amount: token_info.1,</span>
<span class="go">            owner: params.owner,</span>
<span class="go">        }))?;</span>

<span class="go">        // Metadata URL for the token.</span>
<span class="go">        logger.log(&amp;Cis2Event::TokenMetadata::&lt;_, ContractTokenAmount&gt;(</span>
<span class="go">            TokenMetadataEvent {</span>
<span class="go">                token_id,</span>
<span class="go">                metadata_url: token_info.0.to_metadata_url(),</span>
<span class="go">            },</span>
<span class="go">        ))?;</span>
<span class="go">    }</span>
<span class="go">    Ok(())</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Nice! You are done with the smart contract. Without slowing down, start the <a class="reference internal" href="front-end.html#nft-w-id-frontend"><span class="std std-ref">front-end development</span></a>.</p>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="verifier-backend.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The verifier back end</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="front-end.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Front-end development</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>

  <style>
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }

    .cc a {
      display: inline-block;
      text-align: left;
      padding: 16px;
      color: black;
      font-size: 8px;
    }
</style>

<div class="cc">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img src="../../_static/cc-sa-by.png" />  Copyright 2021 - 2023, Concordium Software ApS
  </a>
</div>
  <div id="cookie-consent" class="consent">
    <p>This website only aggregates and analyzes the actions you take here if you allow cookies. If you do not allow cookies, it protects your privacy, but also prevents the owner from learning from your actions and creating a better experience for you and other users.</p><p>Note that if you opt in and you clear your cookies, delete the opt-in cookie, or if you change computers or Web browsers, you will need to perform the opt-in procedure again.</p>
    <button onclick="consentGranted()">Allow</button>
    <button onclick="consentDenied()">Decline</button>
    <a href="https://concordium.com/privacy-policy/">Privacy policy</a>
</div>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];

// Save the choice in a cookie
function storeChoice(granted) {
  document.cookie = "cookie-consent=" + granted
}

// Look for a cookie storing the previous choice of the user.
// Returns undefined if no choice was stored, otherwise a boolean for whether the
// user gave consent.
function loadChoice() {
  if (!document.cookie.includes("cookie-consent=")) {
      return undefined;
  }
  return document.cookie.includes("cookie-consent=true")
}

// Removes the cookie consent banner
function removeCookieConsentBanner() {
  document.getElementById("cookie-consent").remove()
}

// Called by the cookie consent banner if granted permission
function consentGranted() {
  storeChoice(true)
  _paq.push(['setCookieConsentGiven']);
  removeCookieConsentBanner()
}

// Called by the cookie consent banner if denied permission
function consentDenied() {
  storeChoice(true)
  removeCookieConsentBanner()
}

const stored = loadChoice();
if (stored) {
 consentGranted()
}

_paq.push(['requireCookieConsent']);
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);

(function() {
    var u="https://concordium.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/concordium.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();

  // remember tracking consent was given for all subsequent page views and visits
_paq.push(['rememberCookieConsentGiven']);

</script>

  </body>
</html>
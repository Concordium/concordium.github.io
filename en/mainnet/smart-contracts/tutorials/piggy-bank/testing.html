


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing the piggy bank smart contract &#8212; Concordium  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/tippy.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script loading_method="defer" src="https://unpkg.com/@popperjs/core@2"></script>
    <script loading_method="defer" src="https://unpkg.com/tippy.js@6"></script>
    <script loading_method="defer" src="../../../_static/tippy/smart-contracts/tutorials/piggy-bank/testing.06b25aaa-1b82-4f20-9381-39764e5116df.js"></script>
    <link rel="shortcut icon" href="../../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Deploying the piggy bank smart contract" href="deploying.html" />
    <link rel="prev" title="Writing the piggy bank smart contract" href="writing.html" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" />

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    <style>
.navbar-brand img {
    max-height: 200px;
    width: auto;
}
</style>

<div>
    <a href="https://developer.concordium.software/">
        <img class="logo" src="../../../_static/concordium-logo-dark.svg" />
    </a>
</div>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <style>
body {margin:0;}

.navbar-menu {
  position: relative;
  margin-left: 190px;
  background: none;
}

.navbar-light {
    background: #ededed!important;
    box-shadow: none;
}

.navbar-menu a {
  float: left;
  display: inline;
  text-align: center;
  color: var(--font-color);
  font-size: 15px;
}

/* Dropdown Button */
.dropbtn {
  background: none;
  color: black;
  font-size: 16px;
  font-weight: 600;
  padding-left: 20px;
  padding-right: 20px;
  border: none;
  font-family: inherit; /* Important for vertical align on mobile phones */
  margin: 0; /* Important for vertical align on mobile phones */
}

/* The dropdown container */
.dropdown {
    float: left;
  }

  /* Dropdown content (hidden by default) */
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
  }

  /* Links inside the dropdown */
  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  /* Show the dropdown menu on hover */
  .dropdown:hover .dropdown-content {
    display: block;
  }

/* Large devices (laptops/desktops, 992px to 768px ) */
@media only screen and (max-width: 1178px) {
  .navbar-menu {
    display: none;}

}
</style>
<div class="navbar-menu w3-hide-medium w3-hide-small">
  <div class="dropdown">
    <button class="dropbtn">Monitor</button>
    <div class="dropdown-content">
      <a href="https://ccdscan.io/" target="_blank">CCDScan</a>
      <a href="https://dashboard.mainnet.concordium.software" target="_blank">Mainnet dashboard</a>
      <a href="https://dashboard.testnet.concordium.com" target="_blank">Testnet dashboard</a>
      <a href="https://status.mainnet.concordium.software" target="_blank">Mainnet status page</a>
      <a href="https://status.testnet.concordium.software" target="_blank">Testnet status page</a>
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn">Learn</button>
    <div class="dropdown-content">
      <a href="../../../net/concepts/id-accounts.html">Identities</a>
      <a href="../../../net/installation/downloads.html">Accounts</a>
      <a href="../../../net/guides/wallet-lp.html">Wallets</a>
      <a href="../../../net/resources/glossary.html">Glossary</a>
      <a href="https://academy.concordium.software/ccd-academy/getting-started" target="_blank">Academy</a>
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn">Build</button>
    <div class="dropdown-content">
      <a href="../../general/introduction.html">Smart contracts</a>
      <a href="../../../net/web3-id/index.html">Use ID</a>
      <a href="../../../net/guides/low-code-nft-marketplace/introduction.html">Low-code NFT marketplace</a>
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn">Discover</button>
    <div class="dropdown-content">
      <a href="https://medium.com/concordium" target="_blank">Blogs</a>
      <a href="../../../net/guides/dapp-examples.html">Example dApps</a>
      <a href="https://proposals.concordium.software/index.html" target="_blank">Concordium Standards</a>
    </div>
  </div>
  <div class="dropdown">
    <button class="dropbtn">Connect</button>
    <div class="dropdown-content">
      <a class="nav-link nav-external" href="https://support.concordium.software/latest" target="_blank">Discourse</a>
      <a href="mailto:support@concordium.software">Contact support</a>
      <a class="nav-link nav-external" href="https://github.com/Concordium" target="_blank">GitHub</a>
      <a class="nav-link nav-external" href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" target="_blank">YouTube</a>
    </div>
  </div>
</div>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/Concordium" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="mailto:support@concordium.software" rel="noopener" target="_blank" title="Support"><span><i class="fas fa-envelope"></i></span>
            <label class="sr-only">Support</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://support.concordium.software/latest" rel="noopener" target="_blank" title="Discourse"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="list-caption">
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Releases and Installation
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/installation/downloads.html">
     Downloads
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/installation/verification-instructions.html">
       Verification instructions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/release-notes/release-notes-lp.html">
     Release notes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Concordium Basics
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/learn-about-concordium.html">
     Learn about Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/concepts/id-accounts.html">
       Identities
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/company-identities.html">
         Company identity creation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/manage-accounts.html">
       Accounts
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/glossary.html">
       Glossary of Concordium Terms
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/wallets-lp.html">
     Concordium wallets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/guides/setup-wallets-lp.html">
       Set up a wallet
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/browser-wallet/setup-browser-wallet.html">
         Set up the Concordium Wallet for Web
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet-gen2/setup-mobile-wallet.html">
         Set up the Concordium Wallet for Mobile
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/overview-desktop.html">
         Set up the Desktop Wallet
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/guides/manage-wallets-lp.html">
       Manage wallets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/create-identity.html">
         Create an identity
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/create-account.html">
         Create an account
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/send-ccd-wallets.html">
         Send CCD
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/browser-wallet/connect-app.html">
         Connect dApps to wallets
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/tokens.html">
         Tokens in the wallet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/shield-ccd-wallets.html">
         Shield and unshield CCD on an account
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/export-key.html">
         Export a private key
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/recovery.html">
         Backup and recovery
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet/share-address-mw.html">
         Find and share your account address
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet/change-passcode-mw.html">
         Update your passcode and biometric settings
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/scheduled-release.html">
         Scheduled releases
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/address-book.html">
         Manage address book
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/transaction-report.html">
         Create a transaction report
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/transaction-log-filter.html">
         Apply a transaction log filter in the Desktop Wallet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/update-application.html">
         Update the Desktop Wallet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/accounts-desktop.html">
         Desktop Wallet navigation and settings
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/reset-data.html">
         Reset desktop wallet data
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/overview-shared-accounts.html">
         Shared accounts with multiple credentials in Desktop Wallet
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/guides/wallet-faqs.html">
       Wallet FAQs
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/deciding-wallet.html">
         Deciding between the wallets
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet-gen2/faq.html">
         Concordium Wallet for Mobile FAQ
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/browser-wallet/browser-wallet-faq.html">
         Concordium Wallet for Web FAQ
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/how-to-earn.html">
     How to earn with Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/concepts/concepts-baker.html">
       Bakers
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/baker-pool.html">
         Baker management
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet/add-baker-mw.html">
         Add baker
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet/update-baker-mw.html">
         Change baker options
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/baker-windows.html">
         Run a baker node on Windows
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/baker-macos.html">
         Run a baker node on macOS
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/baker-ubuntu.html">
         Run a baker node on Ubuntu
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/baker-docker.html">
         Run a baker node on Docker
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/become-baker.html">
         Become a baker using the Concordium Client
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/concepts/concepts-delegation.html">
       Delegation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
      <label for="toctree-checkbox-12">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/add-delegation.html">
         Delegate to a baker pool or passive delegation
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/update-delegation.html">
         Update delegation to a baker pool or passive delegation
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/remove-delegation.html">
         Remove delegation to a baker pool or passive delegation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/snippets/delegation-faq.html">
       Delegation and baking FAQ
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Develop on Concordium
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/developer-page.html">
     Developer resources
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/sdks-apis.html">
       SDKs and APIs
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/dapp-examples.html">
       dApp examples
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/dashboards.html">
       Dashboards and Status Pages
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/developer-tools.html">
       Auxiliary Tools
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/grpc2.html">
       gRPC V2 documentation
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/grpc.html">
       gRPC documentation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/nodes/node-requirements.html">
     Run a node on Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/ubuntu.html">
       Ubuntu nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node-ubuntu.html">
         Run a node on a server with Ubuntu on Mainnet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/run-node-ubuntu.html">
         Run a node on a server with Ubuntu on Testnet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-ubuntu.html">
         Troubleshoot a node on a server with Ubuntu
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/macos.html">
       MacOS nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node-macos.html">
         Run and manage a node on macOS
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-macos.html">
         Troubleshoot a node on MacOS
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/windows.html">
       Windows nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
      <label for="toctree-checkbox-18">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node-windows.html">
         Run and manage a node on Windows
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/node-runner-service-configuration.html">
         Concordium Windows node runner service configuration
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-windows.html">
         Troubleshoot a node running on Windows
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/docker.html">
       Docker nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
      <label for="toctree-checkbox-19">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node.html">
         Run a node with Docker
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-docker.html">
         Troubleshoot a node on a server with Docker
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/references/concordium-client.html">
     Concordium Client
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/transactions.html">
       Concordium Client transactions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/query-node.html">
       Querying a node
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/run-local-chain.html">
     Run a local chain
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/low-code-nft-marketplace/introduction.html">
     Concordium low-code NFT framework
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
    <label for="toctree-checkbox-21">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/low-code-nft-marketplace/marketplace.html">
       Low code NFT marketplace
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/low-code-nft-marketplace/minting-tool.html">
       Low-code NFT minting tool
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/resources/ccd-scan.html">
     CCDScan
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
    <label for="toctree-checkbox-22">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-blocks.html">
       CCDScan Blocks overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-transactions.html">
       CCDScan Transactions overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-accounts.html">
       CCDScan Accounts overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-staking.html">
       CCDScan Staking overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-nodes.html">
       CCDScan Nodes overview
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Use Concordium's ID Layer
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/web3-id/index.html">
     Identity on Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
    <label for="toctree-checkbox-24">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/web3-id/wallet.html">
       Web3 ID in the Concordium Wallet for Web
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/web3-id/issuer.html">
       Web3 ID issuers
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/create-proofs.html">
       Create proofs
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/web3-id/concordia.html">
       Concordia
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Smart Contracts v1
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../general/introduction.html">
     Introduction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
    <label for="toctree-checkbox-26">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/contract-module.html">
       Smart contract modules
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/contract-instances.html">
       Smart contract instances
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/contract-schema.html">
       Smart contract schemas
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/develop-contracts.html">
       Developing smart contracts in Rust
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../guides/quick-start.html">
     Quick start guide
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../best-practices/index.html">
     Best practices
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
    <label for="toctree-checkbox-27">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../best-practices/development.html">
       Development best practices
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../guides/contract-dev-guides.html">
     Contract development guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
    <label for="toctree-checkbox-28">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/setup-tools.html">
       Install tools for development
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/setup-contract.html">
       Setting up a smart contract project
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/compile-module.html">
       Compile a Rust smart contract module
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/custom-errors.html">
       Return custom errors
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/local-simulate.html">
       Locally simulate contract functions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/build-schema.html">
       Build a contract schema
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/no-std.html">
       Build using
       <code class="docutils literal notranslate">
        <span class="pre">
         no_std
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/fallback-entrypoints.html">
       Fallback entrypoints
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/upgradeable-contract.html">
       Make a contract upgradeable
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/json-params.html">
       Work with the JSON parameters
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../guides/contract-testing-guides.html">
     Contract testing guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
    <label for="toctree-checkbox-29">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/unit-test-contract.html">
       Unit test a contract in Rust
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/integration-test-contract.html">
       Integration test a contract in Rust
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../guides/on-chain-index.html">
     On-chain guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
    <label for="toctree-checkbox-30">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/deploy-module.html">
       Deploy a smart contract module
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/initialize-contract.html">
       Initialize a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/interact-instance.html">
       Interact with a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/inspect-instance.html">
       Inspect a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/invoke-instance.html">
       Invoke a smart contract instance
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../references/index.html">
     References
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
    <label for="toctree-checkbox-31">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/crypto-primitives.html">
       Cryptographic primitives
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/host-fns.html">
       Contract host functions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/local-settings.html">
       Local settings
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/references-on-chain.html">
       References on-chain
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/schema-json.html">
       Schema JSON representation
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/simulate-context.html">
       Simulation contexts
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts">
       Rust contract examples (repo)
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/">
       concordium-std
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../onboarding-guide-ethereum-developers/faq.html">
     Ethereum developer onboarding
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../onboarding-guide-solana-developers/overview.html">
     Solana developer onboarding
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
    <label for="toctree-checkbox-32">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../onboarding-guide-solana-developers/faq.html">
       FAQ
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Tutorials
   </span>
  </p>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-33">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current nav bd-sidenav">
   <li class="toctree-l1 current active has-children">
    <a class="reference internal" href="../index.html">
     Smart contract tutorials
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/>
    <label for="toctree-checkbox-34">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l2">
      <a class="reference internal" href="../setup-env.html">
       Setup the development environment
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../counter/counter-contract.html">
       Counter
      </a>
     </li>
     <li class="toctree-l2 current active has-children">
      <a class="reference internal" href="index.html">
       PiggyBank
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/>
      <label for="toctree-checkbox-35">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l3">
        <a class="reference internal" href="writing.html">
         Writing the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3 current active">
        <a class="current reference internal" href="#">
         Testing the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="deploying.html">
         Deploying the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="frontend.html">
         Setting up a front end
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../wCCD/index.html">
       wCCD
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/>
      <label for="toctree-checkbox-36">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-introduction.html">
         Understanding the wCCD token protocol
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-interacting.html">
         Interacting with the wCCD token protocol
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-front-end-set-up.html">
         Setting up the front end
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-full-dApp.html">
         Running your first full dApp
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../voting/index.html">
       The Voting dApp
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/>
      <label for="toctree-checkbox-37">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../voting/voting-sc.html">
         Writing a voting smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../voting/voting-dapp.html">
         Setting up the front-end
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../nft-minting/index.html">
       Mint an NFT
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/>
      <label for="toctree-checkbox-38">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-minting/upload-nft.html">
         Upload the NFT
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-minting/build-smart-contract.html">
         Intialize, build, and deploy the smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-minting/mint-xfer.html">
         Mint and transfer the NFT
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../sft-minting/index.html">
       Mint a semi-fungible token
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" type="checkbox"/>
      <label for="toctree-checkbox-39">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../sft-minting/setup.html">
         Setup the development environment
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../sft-minting/build-smart-contract.html">
         Smart contract modifications
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../sft-minting/mint-xfer.html">
         Mint and transfer semi-fungible token
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../fungible-tokens/index.html">
       Mint fungible tokens
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" type="checkbox"/>
      <label for="toctree-checkbox-40">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../fungible-tokens/smart-contract.html">
         Smart contract implementation for fungible tokens
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../fungible-tokens/mint-xfer.html">
         Mint, transfer, and burn fungible tokens
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../nft-marketplace/index.html">
       NFT marketplace smart contract tutorial
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" type="checkbox"/>
      <label for="toctree-checkbox-41">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-marketplace/smart-contract.html">
         Build and deploy the smart contract
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../eSealing/index.html">
       eSealing
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" type="checkbox"/>
      <label for="toctree-checkbox-42">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../eSealing/eSealing_dapp.html">
         Exploring the eSealing dapp
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../sponsoredTransactions/index.html">
       Sponsored Transactions
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" type="checkbox"/>
      <label for="toctree-checkbox-43">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../sponsoredTransactions/sponsoredTransactionsSmartContract.html">
         Exploring the sponsored Transactions Smart Contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../sponsoredTransactions/sponsoredTransactionsFrontendAndBackend.html">
         Exploring the sponsored Transactions dApp
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../sponsoredTransactions/walletConnect.html">
         Wallet Connect
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../smartContractUpgrade/index.html">
       Smart Contract Upgrade
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" type="checkbox"/>
      <label for="toctree-checkbox-44">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../smartContractUpgrade/smartContractUpgrade.html">
         Native upgradability
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/gallery/index.html">
     Using ID tutorial
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" type="checkbox"/>
    <label for="toctree-checkbox-45">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/gallery/gallery-backend.html">
       Writing the verifying backend
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/gallery/gallery-frontend.html">
       Interacting with a wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/gallery/gallery-setup.html">
       Setting up the front end
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Smart Contracts v0
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-46">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../smart-contracts-v0/sc-v0-rollup.html">
     V0 smart contract documentation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" type="checkbox"/>
    <label for="toctree-checkbox-47">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../smart-contracts-v0/general/introduction.html">
       Introduction and general guides
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" type="checkbox"/>
      <label for="toctree-checkbox-48">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/general/contract-module.html">
         Smart contract modules
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/general/contract-instances.html">
         Smart contract instances
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/general/contract-schema.html">
         Smart contract schemas
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/general/develop-contracts.html">
         Developing smart contracts in Rust
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../smart-contracts-v0/tutorials/piggy-bank/index.html">
       Tutorials
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" type="checkbox"/>
      <label for="toctree-checkbox-49">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/tutorials/piggy-bank/writing.html">
         Writing the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/tutorials/piggy-bank/testing.html">
         Testing the piggy bank smart contract
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/contract-dev-guides.html">
       Contract development guides
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" type="checkbox"/>
      <label for="toctree-checkbox-50">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/setup-tools.html">
         Install tools for development
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/setup-contract.html">
         Setting up a smart contract project
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/compile-module.html">
         Compile a Rust smart contract module
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/unit-test-contract.html">
         Unit test a contract in Rust
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/custom-errors.html">
         Return custom errors
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/local-simulate.html">
         Locally simulate contract functions
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/build-schema.html">
         Build a contract schema
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/no-std.html">
         Build using
         <code class="docutils literal notranslate">
          <span class="pre">
           no_std
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/on-chain-index.html">
       On-chain guides
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" type="checkbox"/>
      <label for="toctree-checkbox-51">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/deploy-module.html">
         Deploy a smart contract module
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/initialize-contract.html">
         Initialize a smart contract instance
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/interact-instance.html">
         Interact with a smart contract instance
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/guides/inspect-instance.html">
         Inspect a smart contract instance
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../smart-contracts-v0/references/index.html">
       References
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" type="checkbox"/>
      <label for="toctree-checkbox-52">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/references/schema-json.html">
         Schema JSON representation
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/references/simulate-context.html">
         Simulation contexts
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/references/host-fns.html">
         Contract host functions
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/references/references-on-chain.html">
         References on-chain
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../smart-contracts-v0/references/local-settings.html">
         Local settings
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts">
         Rust contract examples (repo)
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference external" href="https://docs.rs/concordium-std/2.0.0/concordium_std/">
         concordium-std
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Legal
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-53">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/terms-and-conditions.html">
     Terms and conditions
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/terms-and-conditions-dw.html">
     Terms and Conditions for Concordium Desktop Wallet
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/terms-and-conditions-mw.html">
     Terms and Conditions for Concordium Legacy Wallet (previously Concordium Mobile Wallet)
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/terms-and-conditions-concordia.html">
     About Concordia
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/third-party-licenses.html">
     Third Party Licenses
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/third-party-notices.html">
     Third-party Software and Hardware Notices
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/bw-licenses.html">
     Concordium Wallet for Web Third Party Licenses
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/dw-licenses.html">
     Concordium Desktop Wallet Third Party Licenses
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/ar-idp-contact.html">
     Contact Anonymity Revokers and Identity Providers
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparation">
   Preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-the-testing-library">
   Adding the testing library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-a-test-module">
   Add a test module
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-instantiation-of-a-piggy-bank">
   Testing instantiation of a piggy bank
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-inserting-ccd-into-a-piggy-bank">
   Test inserting CCD into a piggy bank
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-smashing-a-piggy-bank">
   Test smashing a piggy bank
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-cause-of-rejection">
   Testing cause of rejection
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/Concordium/concordium.github.io/edit/mainnet/source/mainnet/smart-contracts/tutorials/piggy-bank/testing.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="testing-the-piggy-bank-smart-contract">
<span id="piggy-bank-testing"></span><h1>Testing the piggy bank smart contract<a class="headerlink" href="#testing-the-piggy-bank-smart-contract" title="Permalink to this headline">#</a></h1>
<p>This is the second <a class="reference internal" href="index.html#piggy-bank"><span class="std std-ref">part of a tutorial</span></a> on smart contract
development.
So far you have written a piggy bank smart contract in the <a class="reference external" href="https://www.rust-lang.org/">Rust</a> programming
language.
This part will focus on how you can write integration-tests for your piggy bank smart
contract using the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a> library.
The library simulates part of a blockchain <em>locally</em> to allow you to create one or more contracts and interact with them in the tests.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The reader is assumed to have basic knowledge of what a blockchain and smart
contract is, and some experience with <a class="reference external" href="https://www.rust-lang.org/">Rust</a>.</p>
</div>
<div class="section" id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">#</a></h2>
<p>Before you start, make sure to have the necessary tooling to build Rust
contracts. The guide <a class="reference internal" href="../setup-env.html#setup-env"><span class="std std-ref">Setup the development environment</span></a> shows you how to do this.
Also, make sure to have a text editor setup to write Rust.</p>
<p>Since you are going to extend the smart contract code written in the <a class="reference internal" href="writing.html#piggy-bank-writing"><span class="std std-ref">previous
part</span></a>, either follow the previous part or copy the complete
example code for part 1 from <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/blob/main/examples/piggy-bank/part1/src/lib.rs">GitHub</a>.</p>
<p>You are now ready to write tests for your smart contract!</p>
</div>
<div class="section" id="adding-the-testing-library">
<h2>Adding the testing library<a class="headerlink" href="#adding-the-testing-library" title="Permalink to this headline">#</a></h2>
<p>Start by adding the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a> library to the <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> located in the project root.
You should add it under the section <code class="docutils literal notranslate"><span class="pre">[dev-dependencies]</span></code>, which are dependencies only needed during development, as it is only needed during testing.
The library requires the Rust edition <code class="docutils literal notranslate"><span class="pre">2021</span></code> or greater, which you must also set:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[package]</span>
<span class="c1"># ...</span>
<span class="n">edition</span> <span class="o">=</span> <span class="s">&quot;2021&quot;</span>

<span class="k">[dev-dependencies]</span>
<span class="n">concordium-smart-contract-testing</span> <span class="o">=</span> <span class="s">&quot;3.0&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="add-a-test-module">
<h2>Add a test module<a class="headerlink" href="#add-a-test-module" title="Permalink to this headline">#</a></h2>
<p>Since a smart contract module is a regular Rust library, you can test it as
one would test any library and add integration tests in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder.</p>
<p>Create the folder <code class="docutils literal notranslate"><span class="pre">tests</span></code> in the root of your project and add the file <code class="docutils literal notranslate"><span class="pre">tests.rs</span></code> inside it.</p>
<p>Import the testing library and your contract at the top of the file.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">concordium_smart_contract_testing</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">piggy_bank_part2</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Now you can start adding tests to this module.</p>
</div>
<div class="section" id="testing-instantiation-of-a-piggy-bank">
<h2>Testing instantiation of a piggy bank<a class="headerlink" href="#testing-instantiation-of-a-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>The first test is to verify that the piggy bank contract can be initialized correctly.
Writing it also teaches you the basics of using the testing library.</p>
<p>Start by creating three constants that you will use in most of the upcoming test cases.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports omitted for brevity</span>

<span class="k">const</span><span class="w"> </span><span class="n">ACC_ADDR_OWNER</span>: <span class="nc">AccountAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">ACC_ADDR_OTHER</span>: <span class="nc">AccountAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">1</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">ACC_INITIAL_BALANCE</span>: <span class="nc">Amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_ccd</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The first two are account addresses and the last one is the initial balance that both accounts will have.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You created the account addresses using an array of 32 bytes, which is
how account addresses are represented on the Concordium blockchain.
These byte arrays can also be represented as a base58check encoding, but for
testing it is usually more convenient to specify addresses directly in bytes.</p>
</div>
<p>Next, create the init test:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="fm">todo!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Tests in Rust are regular functions, and the <code class="docutils literal notranslate"><span class="pre">#[test]</span></code> attribute tells the test runner to include the function when running <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">test</span></code> or <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span></code>.</p>
<p>The primary construct used for testing is the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html"><code class="docutils literal notranslate"><span class="pre">Chain</span></code></a> type, which you should only create one of per test.
It represents the blockchain and has methods for creating accounts and deploying and working with contracts.</p>
<p>Use the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.new"><code class="docutils literal notranslate"><span class="pre">Chain::new</span></code></a> method for creating a chain with default settings and save it to the <em>mutable</em> variable <code class="docutils literal notranslate"><span class="pre">chain</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The next step is to create two <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Account.html"><code class="docutils literal notranslate"><span class="pre">Account</span></code></a> entities and add them to the <code class="docutils literal notranslate"><span class="pre">chain</span></code>.
The simplest way to create an account is with <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Account.html#method.new"><code class="docutils literal notranslate"><span class="pre">Account::new</span></code></a>, which takes an <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a> and a total balance of the account.
Once constructed, use the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.create_account"><code class="docutils literal notranslate"><span class="pre">create_account</span></code></a> method to add it to the chain.
This step is important, as simply constructing an <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Account.html"><code class="docutils literal notranslate"><span class="pre">Account</span></code></a> does not make the chain aware of it.</p>
<p>Use the addresses and initial balance defined as constants:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Account</span>::<span class="n">new</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_INITIAL_BALANCE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Account</span>::<span class="n">new</span><span class="p">(</span><span class="n">ACC_ADDR_OTHER</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_INITIAL_BALANCE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">chain</span><span class="p">.</span><span class="n">create_account</span><span class="p">(</span><span class="n">account_owner</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">chain</span><span class="p">.</span><span class="n">create_account</span><span class="p">(</span><span class="n">account_other</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The balances of the accounts matter when using the testing library, as the cost of transactions, for example deploying a smart contract, will be deducted from the balance of the account sending the transaction.</p>
<p>With the accounts created, you are ready to load and deploy the smart contract module.
In <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a> you test the compiled smart contract module, which is the exact same module that can be deployed on the blockchain.
Use <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span></code>, which you installed in preparation for this tutorial, to compile the piggy bank to <a class="reference external" href="https://webassembly.org/">WebAssembly (Wasm)</a>.</p>
<p>Open a terminal and use <code class="docutils literal notranslate"><span class="pre">cd</span></code>, short for <em>change directory</em>, to go into the root of your piggy bank project.
Then compile your contract with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>cargo concordium build --out piggy_bank_part2.wasm.v1
</pre></div>
</div>
<p>This produces the Wasm module <code class="docutils literal notranslate"><span class="pre">piggy_bank_part2.wasm.v1</span></code> in the root of your project, unless you have any typos or bugs in your code.
If that is the case, try to fix them using the helpful error messages from the compiler or go back to the end of part 1 and copy the full contract code again.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the tests run against the compiled Wasm module, there is a risk of accidentally using an outdated Wasm module.
To circumvent this, cargo concordiums test command both builds and tests you contract, which ensures that you always test the newest version of your code.
By default it places the compiled Wasm module in the <code class="docutils literal notranslate"><span class="pre">target/</span></code> folder, but you can specify where you want it placed, so the location is easy to specify in your tests.
To do so, use the <code class="docutils literal notranslate"><span class="pre">--out</span></code> parameter when testing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>cargo concordium <span class="nb">test</span> --out piggy_bank_part2.wasm.v1
</pre></div>
</div>
<p>Please note that the test command only builds your module in cargo concordium version 2.9.0+.
Also note that for the highest assurance of correctness, you should <em>deploy the exact module</em> that you also tested.</p>
</div>
<p>Going back to your test case, use the function <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/fn.module_load_v1.html"><code class="docutils literal notranslate"><span class="pre">module_load_v1</span></code></a> to load the module.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// .. lines omitted for brevity.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;piggy_bank_part2.wasm.v1&quot;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Module is valid and exists&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/fn.module_load_v1.html"><code class="docutils literal notranslate"><span class="pre">module_load_v1</span></code></a> attempts to load a module from disk, which might be missing or invalid, and it thus returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code> type.
You can use <code class="docutils literal notranslate"><span class="pre">unwrap</span></code>, or <code class="docutils literal notranslate"><span class="pre">expect</span></code>, to extract the actual module from the <code class="docutils literal notranslate"><span class="pre">Result</span></code>.
Both methods will panic if the <code class="docutils literal notranslate"><span class="pre">Result</span></code> actually contains the <code class="docutils literal notranslate"><span class="pre">Err</span></code> variant, which in turn will make the test case fail.
The remainder of this tutorial uses <code class="docutils literal notranslate"><span class="pre">expect</span></code> as it allows you to provide a contextual message that is shown on panics.</p>
<p>The next step is to deploy the module to our test chain (<code class="docutils literal notranslate"><span class="pre">chain</span></code>) with the method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.module_deploy_v1"><code class="docutils literal notranslate"><span class="pre">module_deploy_v1</span></code></a>.</p>
<p>Since this is a transaction, you must provide an account address of the <code class="docutils literal notranslate"><span class="pre">sender</span></code>, which will pay for the cost of the transaction.
You must also provide a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> with a number of keys.
This mimics the behavior on the real chain, where one or more keys must sign a transaction.
The only observable difference between using one or more keys is the cost of the transaction, where each extra key increases the cost slightly.
In this tutorial, you will always use a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> with one key as that is the most common scenario.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// .. lines omitted for brevity.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;piggy_bank_part2.wasm.v1&quot;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Module is valid and exists&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">module_deploy_v1</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">module</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Deploying valid module should succeed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Since deployment can fail, for example if the account doesnt have sufficient CCD to cover the cost, the method returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, which is unwrapped with <code class="docutils literal notranslate"><span class="pre">expect</span></code>.
The returned struct has information about the energy used, transaction fee, and a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/type.ModuleReference.html"><code class="docutils literal notranslate"><span class="pre">ModuleReference</span></code></a> that you use for initializing contracts.</p>
<p>With the module deployed, you are ready to initialize a contract with the chain method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_init"><code class="docutils literal notranslate"><span class="pre">contract_init</span></code></a>.
The method has the following parameters:</p>
<ul class="simple">
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> to sign the transaction.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a>, which pays for the transaction.</p></li>
<li><p>A maximum <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Energy.html"><code class="docutils literal notranslate"><span class="pre">Energy</span></code></a> that the contract initialization can use.</p></li>
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/type.ModuleReference.html"><code class="docutils literal notranslate"><span class="pre">ModuleReference</span></code></a>, which you got from the deployment above.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedContractName.html"><code class="docutils literal notranslate"><span class="pre">OwnedContractName</span></code></a>, that specifies which contract in the module you want to initialize.
Contract names are prefixed with <code class="docutils literal notranslate"><span class="pre">init_</span></code> on the chain to distinguish them from receive functions (entrypoints).
You constuct it with either <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedContractName.html#method.new"><code class="docutils literal notranslate"><span class="pre">OwnedContractName::new</span></code></a>, which checks the validity and returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedContractName.html#method.new_unchecked"><code class="docutils literal notranslate"><span class="pre">OwnedContractName::new_unchecked</span></code></a>, which performs no checking.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html"><code class="docutils literal notranslate"><span class="pre">OwnedParameter</span></code></a>, which is a wrapper over a byte array that you construct with one of the following methods:</p>
<ul>
<li><p><a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.from_serial"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::from_serial</span></code></a>, which serializes the input and checks that the parameter size is valid,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TryFrom::&lt;Vec&lt;u8&gt;&gt;::try_from(..)</span></code>, which also checks the parameter size,</p></li>
<li><p>or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.empty"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::empty</span></code></a>, which always succeeds.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Amount.html"><code class="docutils literal notranslate"><span class="pre">Amount</span></code></a> to send to the contract.</p></li>
</ul>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// .. lines omitted for brevity.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">initialization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_init</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">InitContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">mod_ref</span>: <span class="nc">deployment</span><span class="p">.</span><span class="n">module_reference</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">init_name</span>: <span class="nc">OwnedContractName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;init_PiggyBank&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">param</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Initialization should always succeed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Initialization can fail for several different reasons, and thus returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, which is unwrapped with <code class="docutils literal notranslate"><span class="pre">expect</span></code>.
The returned struct contains information about the energy used, transaction fee, contract events (logs) produced, and a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a> that you use for updating and interacting with the contract.</p>
<p>While the deployment and initialization in themselves act as a test, you can also check that the balance starts out as zero.
Use the method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_balance"><code class="docutils literal notranslate"><span class="pre">contract_balance</span></code></a> with the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a> from the <code class="docutils literal notranslate"><span class="pre">initialization</span></code> struct to do so:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports and constants omitted for brevity</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// .. lines omitted for brevity.</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_balance</span><span class="p">(</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">Amount</span>::<span class="n">zero</span><span class="p">()),</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Piggy bank is not initialized with balance of zero&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_balance"><code class="docutils literal notranslate"><span class="pre">contract_balance</span></code></a> returns an <code class="docutils literal notranslate"><span class="pre">Option&lt;Amount&gt;</span></code>, as the contract queried might not exist.</p>
<p>The remaining test cases will call methods on an initialized contract.
To avoid duplicating code across the test cases, you will <em>refactor</em> nearly all of <code class="docutils literal notranslate"><span class="pre">test_init</span></code> into a separate helper function, <code class="docutils literal notranslate"><span class="pre">setup_chain_and_contract</span></code>, which you will use in the tests.</p>
<p>After the refactoring, you end up with the following test for initializing a piggy bank:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">concordium_smart_contract_testing</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">piggy_bank_part2</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">ACC_ADDR_OWNER</span>: <span class="nc">AccountAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">ACC_ADDR_OTHER</span>: <span class="nc">AccountAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">1</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">ACC_INITIAL_BALANCE</span>: <span class="nc">Amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_ccd</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">setup_chain_and_contract</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">Chain</span><span class="p">,</span><span class="w"> </span><span class="n">ContractInitSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">chain</span><span class="p">.</span><span class="n">create_account</span><span class="p">(</span><span class="n">Account</span>::<span class="n">new</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_INITIAL_BALANCE</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">chain</span><span class="p">.</span><span class="n">create_account</span><span class="p">(</span><span class="n">Account</span>::<span class="n">new</span><span class="p">(</span><span class="n">ACC_ADDR_OTHER</span><span class="p">,</span><span class="w"> </span><span class="n">ACC_INITIAL_BALANCE</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span>::<span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;piggy_bank_part2.wasm.v1&quot;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Module is valid and exists&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">module_deploy_v1</span><span class="p">(</span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"> </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Deploying valid module should succeed&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">initialization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_init</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">InitContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">mod_ref</span>: <span class="nc">deployment</span><span class="p">.</span><span class="n">module_reference</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">init_name</span>: <span class="nc">OwnedContractName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;init_PiggyBank&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">param</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Initialization should always succeed&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setup_chain_and_contract</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_balance</span><span class="p">(</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">Amount</span>::<span class="n">zero</span><span class="p">()),</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Piggy bank is not initialized with balance of zero&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Run the test to check that it compiles and succeeds.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>cargo concordium <span class="nb">test</span> --out piggy_bank_part2.wasm.v1
</pre></div>
</div>
<p>Note that the command recompiles the Wasm module and replaces the old module in the same location due to the <code class="docutils literal notranslate"><span class="pre">--out</span></code> parameter.</p>
</div>
<div class="section" id="test-inserting-ccd-into-a-piggy-bank">
<h2>Test inserting CCD into a piggy bank<a class="headerlink" href="#test-inserting-ccd-into-a-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>Next, you should test the different functions for interacting with a piggy bank.
You will start by testing the <code class="docutils literal notranslate"><span class="pre">insert</span></code> entrypoint on an intact piggy bank contract.</p>
<p>Create a new test case named <code class="docutils literal notranslate"><span class="pre">test_insert_intact</span></code>, and use the helper method <code class="docutils literal notranslate"><span class="pre">create_chain_and_contract</span></code> from the previous section to get a chain with two accounts and an initialized piggy bank contract.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_chain_and_contract</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that you must mark the <code class="docutils literal notranslate"><span class="pre">chain</span></code> variable as mutable, since contract updates mutate it.</p>
<p>Now, you are ready to update the contract with the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> method, which has parameters similar to <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_init"><code class="docutils literal notranslate"><span class="pre">contract_init</span></code></a>:</p>
<ul class="simple">
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> to sign the transaction.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">invoker</span></code> of type <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a>, which pays for the transaction.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">sender</span></code> of type <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/enum.Address.html"><code class="docutils literal notranslate"><span class="pre">Address</span></code></a>, which can either be an <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a> or a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a>.</p>
<ul>
<li><p>The main utility of the parameter is that it allows you to test internal calls in your contracts directly.</p></li>
<li><p>For example, if you have a more complex scenario where an account calls contract <code class="docutils literal notranslate"><span class="pre">A</span></code> which internally calls contract <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<ul>
<li><p>In this case you can test the complete integration by calling <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p></li>
<li><p>But you can also test <code class="docutils literal notranslate"><span class="pre">B</span></code> as its own unit by calling it directly and specifying <code class="docutils literal notranslate"><span class="pre">A</span></code> as the <code class="docutils literal notranslate"><span class="pre">sender</span></code>.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>A maximum <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Energy.html"><code class="docutils literal notranslate"><span class="pre">Energy</span></code></a> that the contract update can use.</p></li>
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a>, which you get from the initialization variable.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedReceiveName.html"><code class="docutils literal notranslate"><span class="pre">OwnedReceiveName</span></code></a>, that specifies which receive name in the module you want to initialize.</p>
<ul>
<li><p>A receive name is the contract name concatenated with the entrypoint name and a dot in between.</p></li>
<li><p>In this example, the contract <code class="docutils literal notranslate"><span class="pre">my_contract</span></code> and the entrypoint <code class="docutils literal notranslate"><span class="pre">my_entrypoint</span></code> combine to the receive name <code class="docutils literal notranslate"><span class="pre">my_contract.my_entrypoint</span></code>.</p></li>
<li><p>You construct it with either <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedReceiveName.html#method.new"><code class="docutils literal notranslate"><span class="pre">OwnedReceiveName::new</span></code></a>, which checks the format and returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedReceiveName.html#method.new_unchecked"><code class="docutils literal notranslate"><span class="pre">OwnedReceiveName::new_unchecked</span></code></a>, which performs no checks.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html"><code class="docutils literal notranslate"><span class="pre">OwnedParameter</span></code></a>, which is a wrapper over a byte array that you construct with one of the following methods:</p>
<ul>
<li><p><a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.from_serial"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::from_serial</span></code></a>, which serializes the input and checks that the parameter size is valid,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TryFrom::&lt;Vec&lt;u8&gt;&gt;::try_from(..)</span></code>, which also checks the parameter size,</p></li>
<li><p>or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.empty"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::empty</span></code></a>, which always succeeds.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Amount.html"><code class="docutils literal notranslate"><span class="pre">Amount</span></code></a> to send to the contract.</p></li>
</ul>
<p>Define the variable <code class="docutils literal notranslate"><span class="pre">insert_amount</span></code> with the amount of CCD you want to send to the contract.
Then update the contract with the <code class="docutils literal notranslate"><span class="pre">insert</span></code> receive function and pass in <code class="docutils literal notranslate"><span class="pre">insert_amount</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_chain_and_contract</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">insert_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_ccd</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">insert_amount</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.insert&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You can then verify the success of the update and the contract balance:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>

<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">update</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Inserting into intact piggy bank failed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_balance</span><span class="p">(</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">insert_amount</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Piggy bank balance does not match amount inserted&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>One test that is tempting to add is to check that the piggy bank remains intact
after inserting CCD into it.
However, there is no way for the immutable receive method <code class="docutils literal notranslate"><span class="pre">piggy_insert</span></code> to
mutate the state.
Trying to do so would result in an error from the Rust compiler.
By using immutable receive functions, it is possible to rule out certain error
cases at compile time, which means that you do not need tests for these
scenarios.
Along with performance, those are the two primary reasons for not making your
receive methods <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_std_derive/attr.receive.html#mutable-function-can-mutate-the-state"><code class="docutils literal notranslate"><span class="pre">mutable</span></code></a> unless strictly necessary.</p>
<p>The second test becomes:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>

<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_chain_and_contract</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">insert_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_ccd</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">insert_amount</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.insert&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">update</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Inserting into intact piggy bank failed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_balance</span><span class="p">(</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">insert_amount</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Piggy bank balance does not match amount inserted&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Again, verify that everything compiles and the tests succeed using <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span> <span class="pre">--out</span> <span class="pre">piggy_bank_part2.wasm.v1</span></code>.</p>
</div>
<div class="section" id="test-smashing-a-piggy-bank">
<h2>Test smashing a piggy bank<a class="headerlink" href="#test-smashing-a-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>Testing <code class="docutils literal notranslate"><span class="pre">smash</span></code> will follow the same pattern, but this time you will also use the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a> method to invoke the <code class="docutils literal notranslate"><span class="pre">view</span></code> receive function and check whether the state is smashed.</p>
<p>Start by creating a new test case, <code class="docutils literal notranslate"><span class="pre">test_smash_intact</span></code>, setup the chain and contract with the helper function, and update the contract by calling the <code class="docutils literal notranslate"><span class="pre">smash</span></code> entrypoint.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>
<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_chain_and_contract</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.smash&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Owner is allowed to smash intact piggy bank&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that you must use the <code class="docutils literal notranslate"><span class="pre">ACC_ADDR_OWNER</span></code> for the <code class="docutils literal notranslate"><span class="pre">sender</span></code> argument, since it is only the owner who can smash the piggy bank.</p>
<p>To check the <code class="docutils literal notranslate"><span class="pre">PiggyBankState</span></code>, you must invoke the <code class="docutils literal notranslate"><span class="pre">view</span></code> with the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a> method.
You could also use <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> for this purpose, as you are just interested in the return value, but the benefit of <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a> is that it <em>isnt</em> a transaction.
So it does not charge the account for calling it, and it does not save changes to contracts.
For seasoned Rust programmers, that is easily seen by its function signature, which takes an immutable reference to the chain (<code class="docutils literal notranslate"><span class="pre">&amp;self</span></code>), as opposed to the mutable reference (<code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">self</span></code>) used in the update method.
Also note that the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> parameter is not needed for the invoke method, as the signer is only needed for transactions.</p>
<p>Invoke the <code class="docutils literal notranslate"><span class="pre">view</span></code> function below the update:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>
<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">(){</span><span class="w"></span>

<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_invoke</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.view&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Invoking `view` should always succeed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The next step is to use the return value from (<code class="docutils literal notranslate"><span class="pre">invoke.return_value</span></code>), which is a byte array representing a tuple of <code class="docutils literal notranslate"><span class="pre">PiggyBankState</span></code> and <code class="docutils literal notranslate"><span class="pre">Amount</span></code>.
While it is possible to make assertions about the bytes directly, it is preferable to deserialize the bytes into structured Rust types.
There is a helper method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/fn.from_bytes.html"><code class="docutils literal notranslate"><span class="pre">from_bytes</span></code></a> for this exact purpose:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>
<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">(){</span><span class="w"></span>

<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span>: <span class="p">(</span><span class="n">PiggyBankState</span><span class="p">,</span><span class="w"> </span><span class="n">Amount</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">from_bytes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">invoke</span><span class="p">.</span><span class="n">return_value</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;View should always return a valid result&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Since deserialization might fail, <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/fn.from_bytes.html"><code class="docutils literal notranslate"><span class="pre">from_bytes</span></code></a> returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code> that is unwrapped here.
If you run the tests at this point, the compiler will complain about <code class="docutils literal notranslate"><span class="pre">PiggyBankState</span></code> being undeclared.
This is because types and functions in Rust are private by default.
To make the <code class="docutils literal notranslate"><span class="pre">PiggyBankState</span></code> public, edit the <code class="docutils literal notranslate"><span class="pre">lib.rs</span></code> file and add the <code class="docutils literal notranslate"><span class="pre">pub</span></code> keyword.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">PiggyBankState</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="w">   </span><span class="n">Intact</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">Smashed</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The change you just made does not affect the functionality of the contract, but when you make changes that do, it is essential to build the Wasm module again.
Otherwise, you will continue using the old Wasm module.
Recompiling the module occurs automatically when using <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span> <span class="pre">--out</span> <span class="pre">piggy_bank_part2.wasm.v1</span></code> and the command overwrites the old module in the same location due to the <code class="docutils literal notranslate"><span class="pre">--out</span></code> parameter.</p>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">state</span></code> and <code class="docutils literal notranslate"><span class="pre">balance</span></code> available, you can make assertions.
The contract should be smashed and have a balance of zero:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>
<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">(){</span><span class="w"></span>

<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Piggy bank is not smashed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">balance</span><span class="p">,</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Piggy bank has non-zero balance after being smashed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You can also check that the contract transferred all of its funds to the owner during the <code class="docutils literal notranslate"><span class="pre">update</span></code>.
The helper method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeSuccess.html#method.account_transfers"><code class="docutils literal notranslate"><span class="pre">account_transfers</span></code></a> returns an iterator over <code class="docutils literal notranslate"><span class="pre">(ContractAddress,</span> <span class="pre">Amount,</span> <span class="pre">AccountAddress)</span></code>, representing transfers from contracts to accounts.
Use the <code class="docutils literal notranslate"><span class="pre">collect</span></code> method to turn the iterator into a <code class="docutils literal notranslate"><span class="pre">Vec</span></code> to compare it.
Since you did not insert any CCD in this test case, the piggy bank should have made a transfer of zero CCD:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// .. Imports, constants, and other functions omitted for brevity.</span>
<span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">(){</span><span class="w"></span>

<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">update</span><span class="p">.</span><span class="n">account_transfers</span><span class="p">().</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="p">[(</span><span class="w"></span>
<span class="w">            </span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="w"></span>
<span class="w">        </span><span class="p">)],</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;The piggy bank made incorrect transfers when smashed&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The complete third test thus becomes:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setup_chain_and_contract</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.smash&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Owner is allowed to smash intact piggy bank&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_invoke</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OWNER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.view&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Invoking `view` should always succeed&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span>: <span class="p">(</span><span class="n">PiggyBankState</span><span class="p">,</span><span class="w"> </span><span class="n">Amount</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">from_bytes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">invoke</span><span class="p">.</span><span class="n">return_value</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;View should always return a valid result&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Piggy bank is not smashed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">balance</span><span class="p">,</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Piggy bank has non-zero balance after being smashed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">update</span><span class="p">.</span><span class="n">account_transfers</span><span class="p">().</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="p">[(</span><span class="w"></span>
<span class="w">            </span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OWNER</span><span class="w"></span>
<span class="w">        </span><span class="p">)],</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;The piggy bank made incorrect transfers when smashed&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Ensure everything compiles and the test succeeds using <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span> <span class="pre">--out</span> <span class="pre">piggy_bank_part2.wasm.v1</span></code>.</p>
</div>
<div class="section" id="testing-cause-of-rejection">
<h2>Testing cause of rejection<a class="headerlink" href="#testing-cause-of-rejection" title="Permalink to this headline">#</a></h2>
<p>You want to test that the piggy bank rejects in certain contexts, for example
when someone besides the owner of the smart contract tries to smash it.</p>
<p>The test should:</p>
<ul class="simple">
<li><p>Setup the chain and contract.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">piggy_smash</span></code> with the <code class="docutils literal notranslate"><span class="pre">ACC_ADDR_OTHER</span></code> account.</p></li>
<li><p>Check that the result is an error with <code class="docutils literal notranslate"><span class="pre">expect_err</span></code>.</p></li>
</ul>
<p>The test could look like this:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setup_chain_and_contract</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OTHER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OTHER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.smash&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect_err</span><span class="p">(</span><span class="s">&quot;Smashing should only succeed for the owner&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>One thing to notice is that the test is not ensuring <em>why</em> the contract
rejected; your piggy bank might reject for a wrong reason and this would be a
bug.
This is probably fine for a simple smart contract like your piggy bank, but for a
smart contract with more complex logic and many reasons for rejecting, it would
be better if you tested this as well.</p>
<p id="piggy-bank-smash-error">To solve this, introduce a <em>public</em> <code class="docutils literal notranslate"><span class="pre">SmashError</span></code> enum  to represent the different
reasons for rejection:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[derive(Debug, PartialEq, Eq, Serialize, Reject)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">SmashError</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">NotOwner</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">AlreadySmashed</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TransferError</span><span class="p">,</span><span class="w"> </span><span class="c1">// Should never occur, see details below.</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information about custom errors and deriving <code class="docutils literal notranslate"><span class="pre">Reject</span></code>, see <a class="reference internal" href="../../guides/custom-errors.html#custom-errors"><span class="std std-ref">Return custom errors</span></a>.</p>
</div>
<p>To use this error type, the function <code class="docutils literal notranslate"><span class="pre">piggy_smash</span></code> should return <code class="docutils literal notranslate"><span class="pre">Result&lt;A,</span>
<span class="pre">SmashError&gt;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ReceiveResult&lt;A&gt;</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[receive(contract = </span><span class="s">&quot;PiggyBank&quot;</span><span class="cp">, name = </span><span class="s">&quot;smash&quot;</span><span class="cp">, mutable)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">piggy_smash</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasReceiveContext</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">HasHost</span><span class="o">&lt;</span><span class="n">PiggyBankState</span><span class="p">,</span><span class="w"> </span><span class="n">StateApiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">SmashError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="w">   </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>and you also have to supply the <code class="docutils literal notranslate"><span class="pre">ensure!</span></code> macros with a second argument, which is
the error to produce:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[receive(contract = </span><span class="s">&quot;PiggyBank&quot;</span><span class="cp">, name = </span><span class="s">&quot;smash&quot;</span><span class="cp">, mutable)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">piggy_smash</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasReceiveContext</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">HasHost</span><span class="o">&lt;</span><span class="n">PiggyBankState</span><span class="p">,</span><span class="w"> </span><span class="n">StateApiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">SmashError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">owner</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">sender</span><span class="p">();</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="n">ensure</span><span class="o">!</span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">matches_account</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owner</span><span class="p">),</span><span class="w"> </span><span class="n">SmashError</span>::<span class="n">NotOwner</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">ensure</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">SmashError</span>::<span class="n">AlreadySmashed</span><span class="p">);</span><span class="w"></span>
</span>
<span class="w">    </span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state_mut</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">self_balance</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">transfer_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">invoke_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">);</span><span class="w"></span>
<span class="hll"><span class="w">    </span><span class="n">ensure</span><span class="o">!</span><span class="p">(</span><span class="n">transfer_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="n">SmashError</span>::<span class="n">TransferError</span><span class="p">);</span><span class="w"></span>
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">invoke_transfer</span></code> fails if the account does not exist, or if the contract
has insufficient funds. Neither case can occur in the contract since contracts
always have a valid owner and the amount it sends is the <code class="docutils literal notranslate"><span class="pre">self_balance</span></code>. But
you should still be able to represent this error and distinguish it from the two
other error types.</p>
<p>When updates and invokes fail, they return a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeError.html"><code class="docutils literal notranslate"><span class="pre">ContractInvokeError</span></code></a> struct, which has information about the transaction fee, energy usage, and also the <em>reason</em> why a contract call failed.
Some of the reasons include running out of energy, calling a contract that doesnt exist, etc., but only one variant, which is when the contract <em>rejects</em> on its own, contains the bytes returned by the contract.
The helper method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeError.html#method.return_value"><code class="docutils literal notranslate"><span class="pre">return_value</span></code></a> tries to extract the bytes from the contract rejection and returns an <code class="docutils literal notranslate"><span class="pre">Option&lt;Vec&lt;u8&gt;&gt;</span></code>.
With the bytes available, you can use the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/fn.from_bytes.html"><code class="docutils literal notranslate"><span class="pre">from_bytes</span></code></a> method and assert why the update failed:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">return_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_err</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">return_value</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Contract should reject and thus return bytes&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">error</span>: <span class="nc">SmashError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from_bytes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">return_value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Contract should return a `SmashError` in serialized form&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">error</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">SmashError</span>::<span class="n">NotOwner</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Contract did not fail due to a NotOwner error&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Finally, you can also check whether the <code class="docutils literal notranslate"><span class="pre">ACC_ADDR_OTHER</span></code> account was charged correctly for the transaction.
Use the method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.account_balance_available"><code class="docutils literal notranslate"><span class="pre">account_balance_available</span></code></a> and check that it has the original balance minus the transaction fee for the update transaction.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>

<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="n">account_balance_available</span><span class="p">(</span><span class="n">ACC_ADDR_OTHER</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">ACC_INITIAL_BALANCE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">update_err</span><span class="p">.</span><span class="n">transaction_fee</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;The invoker account was incorrectly charged&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.account_balance_available"><code class="docutils literal notranslate"><span class="pre">account_balance_available</span></code></a> returns an <code class="docutils literal notranslate"><span class="pre">Option&lt;Amount&gt;</span></code> as the queried account might not exist.</p>
<p>The final test thus becomes:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="p">,</span><span class="w"> </span><span class="n">initialization</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setup_chain_and_contract</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">Signer</span>::<span class="n">with_one_key</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">ACC_ADDR_OTHER</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">ACC_ADDR_OTHER</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">Energy</span>::<span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">amount</span>: <span class="nc">Amount</span>::<span class="n">zero</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">address</span>: <span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">receive_name</span>: <span class="nc">OwnedReceiveName</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;PiggyBank.smash&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"></span>
<span class="w">                </span><span class="n">message</span>: <span class="nc">OwnedParameter</span>::<span class="n">empty</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect_err</span><span class="p">(</span><span class="s">&quot;Smashing should only succeed for the owner&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">return_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_err</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">return_value</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Contract should reject and thus return bytes&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">error</span>: <span class="nc">SmashError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from_bytes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">return_value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Contract should return a `SmashError` in serialized form&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">error</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">SmashError</span>::<span class="n">NotOwner</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Contract did not fail due to a NotOwner error&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="n">account_balance_available</span><span class="p">(</span><span class="n">ACC_ADDR_OTHER</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">ACC_INITIAL_BALANCE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">update_err</span><span class="p">.</span><span class="n">transaction_fee</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;The invoker account was incorrectly charged&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This concludes the testing part of this tutorial.</p>
<p>But if you are eager to test all scenarios for the piggy bank, you can try to write the following extra tests using the techniques you just learned:</p>
<ul class="simple">
<li><p>Test that inserting into a piggy bank with state <code class="docutils literal notranslate"><span class="pre">Smashed</span></code> results in an error.</p></li>
<li><p>Test that smashing a piggy bank with state <code class="docutils literal notranslate"><span class="pre">Smashed</span></code> results in an <code class="docutils literal notranslate"><span class="pre">AlreadySmashed</span></code> error.</p></li>
<li><p>Test that the <code class="docutils literal notranslate"><span class="pre">ACC_ADDR_OWNER</span></code> account pays for <em>all</em> transaction fees and amounts inserted in a given test.</p>
<ul>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">test_insert_intact</span></code> test case, this means that transaction fees for deploying, initializing, and updating the contract, plus the amount inserted.</p></li>
<li><p>To test the deployment cost, the <code class="docutils literal notranslate"><span class="pre">setup_chain_and_contract</span></code> function method must return some additional data.
Can you figure out which?</p></li>
</ul>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information on testing, see <a class="reference internal" href="../../guides/integration-test-contract.html#integration-test-contract"><span class="std std-ref">Integration test a contract in Rust</span></a>.</p>
</div>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="writing.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Writing the piggy bank smart contract</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="deploying.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deploying the piggy bank smart contract</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>

  <style>
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }

    .cc a {
      display: inline-block;
      text-align: left;
      padding: 16px;
      color: black;
      font-size: 8px;
    }
</style>

<div class="cc">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img src="../../../_static/cc-sa-by.png" />  Copyright 2021 - 2023, Concordium Software ApS
  </a>
</div>
  <div id="cookie-consent" class="consent">
    <p>This website only aggregates and analyzes the actions you take here if you allow cookies. If you do not allow cookies, it protects your privacy, but also prevents the owner from learning from your actions and creating a better experience for you and other users.</p><p>Note that if you opt in and you clear your cookies, delete the opt-in cookie, or if you change computers or Web browsers, you will need to perform the opt-in procedure again.</p>
    <button onclick="consentGranted()">Allow</button>
    <button onclick="consentDenied()">Decline</button>
    <a href="https://concordium.com/privacy-policy/">Privacy policy</a>
</div>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];

// Save the choice in a cookie
function storeChoice(granted) {
  document.cookie = "cookie-consent=" + granted
}

// Look for a cookie storing the previous choice of the user.
// Returns undefined if no choice was stored, otherwise a boolean for whether the
// user gave consent.
function loadChoice() {
  if (!document.cookie.includes("cookie-consent=")) {
      return undefined;
  }
  return document.cookie.includes("cookie-consent=true")
}

// Removes the cookie consent banner
function removeCookieConsentBanner() {
  document.getElementById("cookie-consent").remove()
}

// Called by the cookie consent banner if granted permission
function consentGranted() {
  storeChoice(true)
  _paq.push(['setCookieConsentGiven']);
  removeCookieConsentBanner()
}

// Called by the cookie consent banner if denied permission
function consentDenied() {
  storeChoice(true)
  removeCookieConsentBanner()
}

const stored = loadChoice();
if (stored) {
 consentGranted()
}

_paq.push(['requireCookieConsent']);
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);

(function() {
    var u="https://concordium.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/concordium.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();

  // remember tracking consent was given for all subsequent page views and visits
_paq.push(['rememberCookieConsentGiven']);

</script>

  </body>
</html>
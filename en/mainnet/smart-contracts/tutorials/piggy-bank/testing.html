


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing the piggy bank smart contract &#8212; Concordium  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <link rel="shortcut icon" href="../../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Deploying the piggy bank smart contract" href="deploying.html" />
    <link rel="prev" title="Writing the piggy bank smart contract" href="writing.html" />
<link href="../../../_static/style.css" rel="stylesheet" type="text/css">

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/concordium-logo-dark.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
body {margin:0;}

.navbar-menu {
  position: fixed;
  background-color: var(--bg-color);
}

.navbar-menu a {
  display: inline;
  text-align: left;
  padding: 16px;
  color: var(--font-color);
  font-size: 15px;
}
/* Large devices (laptops/desktops, 992px to 768px ) */
@media only screen and (max-width: 1178px) {
  .navbar-menu {
    display: none;}

}
</style>
<body>

<div class="navbar-menu w3-hide-medium w3-hide-small">
  <a href="../../../net/installation/downloads.html">Install</a>
  <a href="../../../net/guides/learn-about-concordium.html">Learn</a>
  <a href="../../../net/nodes/node-requirements.html">Run a node</a>
  <a href="../../../net/guides/deciding-wallet.html">Wallets</a>
  <a href="../../../net/guides/how-to-earn.html">Earn</a>
  <a href="../../../net/guides/developer-page.html">Develop</a>
  <a href="../../general/introduction.html">Smart Contracts</a>
  <a href="../../../net/guides/create-proofs.html">Use ID</a>
</div>
</body>
</html>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/Concordium" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="mailto:support@concordium.software" rel="noopener" target="_blank" title="Support"><span><i class="fas fa-envelope"></i></span>
            <label class="sr-only">Support</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://support.concordium.software/latest" rel="noopener" target="_blank" title="Discourse"><img src="../../../_static/discourse-brands.svg" class="icon-link-image" alt="Discourse"/></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="mailto:documentation@concordium.com" rel="noopener" target="_blank" title="Feedback"><span><i class="fas fa-bullhorn"></i></span>
            <label class="sr-only">Feedback</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="list-caption">
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Installation
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/installation/downloads.html">
     Downloads - Mainnet
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/installation/downloads-testnet.html">
     Downloads - Testnet
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/installation/verification-instructions.html">
     Verification instructions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Learn
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/learn-about-concordium.html">
     Learn about Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/concepts/id-accounts.html">
       Identities
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/company-identities.html">
         Company identity creation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/manage-accounts.html">
       Accounts
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/glossary.html">
       Glossary of Concordium Terms
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Concordium Wallets
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/deciding-wallet.html">
     Deciding between the wallets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/concepts/concepts-transactions.html">
       Transactions overview
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/wallet-faqs.html">
     Wallet FAQs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/mobile-wallet-gen2/faq.html">
       Concordium Wallet for Mobile FAQ
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/browser-wallet/browser-wallet-faq.html">
       Concordium Wallet for Web FAQ
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/browser-wallet/setup-browser-wallet.html">
     Set up the Concordium Wallet for Web
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/mobile-wallet-gen2/setup-mobile-wallet.html">
     Set up the Concordium Wallet for Mobile
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/mobile-wallet/setup-mobile-wallet.html">
     Set up the Concordium Legacy Wallet
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/create-identity.html">
     Create an identity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/change-identity-name.html">
       Change identity name
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/create-account.html">
     Create an account
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/change-account-name.html">
       Change account name
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/send-ccd-wallets.html">
     Send CCD
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/browser-wallet/connect-app.html">
     Connect dApps to wallets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/proofs.html">
       Proofs and revealing information
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/tokens.html">
     Tokens in the wallet
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/shield-ccd-wallets.html">
     Shield and unshield CCD on an account
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/shielded-transfer.html">
       Make a shielded transfer on an account
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/export-import.html">
     Make a backup of identities, accounts, and addresses
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/export-key.html">
     Export a private key
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/recover-wallet.html">
     Recover your Wallet
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/mobile-wallet/share-address-mw.html">
     Find and share your account address
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/mobile-wallet/change-passcode-mw.html">
     Update your passcode and biometric settings
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/mobile-wallet/inspect-release-schedule-mw.html">
     Inspect a release schedule
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/address-book.html">
     Manage address book
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/desktop-wallet/index.html">
     Desktop Wallet
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/guides/overview-desktop.html">
       Set up the Desktop Wallet
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/install-ledger-app.html">
         Set up the LEDGER device and install the Concordium LEDGER App
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/desktop-wallet/accounts-desktop.html">
       Use the Desktop Wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/desktop-wallet/single-sign-schedule.html">
       Transfer CCD with a schedule in Desktop Wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/desktop-wallet/transaction-log-filter.html">
       Apply a transaction log filter in the Desktop Wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/desktop-wallet/update-application.html">
       Update the Desktop Wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/desktop-wallet/reset-data.html">
       Reset desktop wallet data
      </a>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/guides/overview-shared-accounts.html">
       Shared accounts with multiple credentials in Desktop Wallet
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/create-credentials-file.html">
         Create a credentials file
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/multi-credentials.html">
         Add credentials to an account
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/multisig-simple-transfer.html">
         Create a multi-signature CCD transfer in the Desktop Wallet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/multisig-transfer.html">
         Create a scheduled transfer in the Desktop Wallet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/sign-transaction.html">
         Sign a transaction proposal
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/desktop-wallet/proposed-transactions.html">
         View transaction proposals
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Earn with Concordium
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/how-to-earn.html">
     How to earn with Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/concepts/concepts-baker.html">
       Bakers
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/baker-pool.html">
         Baker management
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet/add-baker-mw.html">
         Add baker
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/mobile-wallet/update-baker-mw.html">
         Change baker options
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/baker-windows.html">
         Run a baker node on Windows
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/baker-macos.html">
         Run a baker node on macOS
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/baker-ubuntu.html">
         Run a baker node on Ubuntu
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/baker-docker.html">
         Run a baker node on Docker
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/become-baker.html">
         Become a baker using the Concordium Client
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/concepts/concepts-delegation.html">
       Delegation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
      <label for="toctree-checkbox-18">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/add-delegation.html">
         Delegate to a baker pool or passive delegation
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/update-delegation.html">
         Update delegation to a baker pool or passive delegation
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/remove-delegation.html">
         Remove delegation to a baker pool or passive delegation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/snippets/delegation-faq.html">
       Delegation and baking FAQ
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Develop on Concordium
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/developer-page.html">
     Developer resources
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/sdks-apis.html">
       SDKs and APIs
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/dapp-examples.html">
       dApp examples
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/dashboards.html">
       Dashboards and Status Pages
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/developer-tools.html">
       Auxiliary Tools
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/grpc2.html">
       gRPC V2 documentation
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/grpc.html">
       gRPC documentation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/nodes/node-requirements.html">
     Run a node on Concordium
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
    <label for="toctree-checkbox-21">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/ubuntu.html">
       Ubuntu nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
      <label for="toctree-checkbox-22">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node-ubuntu.html">
         Run a node on a server with Ubuntu on Mainnet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/run-node-ubuntu.html">
         Run a node on a server with Ubuntu on Testnet
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-ubuntu.html">
         Troubleshoot a node on a server with Ubuntu
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/macos.html">
       MacOS nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
      <label for="toctree-checkbox-23">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node-macos.html">
         Run and manage a node on macOS
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-macos.html">
         Troubleshoot a node on MacOS
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/windows.html">
       Windows nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
      <label for="toctree-checkbox-24">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node-windows.html">
         Run and manage a node on Windows
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/node-runner-service-configuration.html">
         Concordium Windows node runner service configuration
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-windows.html">
         Troubleshoot a node running on Windows
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../../../net/nodes/docker.html">
       Docker nodes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
      <label for="toctree-checkbox-25">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/guides/run-node.html">
         Run a node with Docker
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../../../net/nodes/troubleshoot-docker.html">
         Troubleshoot a node on a server with Docker
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/references/concordium-client.html">
     Concordium Client
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
    <label for="toctree-checkbox-26">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/transactions.html">
       Concordium Client transactions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/references/query-node.html">
       Querying a node
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Use Concordium's ID Layer
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-27">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/create-proofs.html">
     Use ID: Create proofs
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/guides/gallery/index.html">
     The gallery with ID authentication
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
    <label for="toctree-checkbox-28">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/gallery/gallery-backend.html">
       Writing the verifying backend
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/gallery/gallery-frontend.html">
       Interacting with a wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/guides/gallery/gallery-setup.html">
       Setting up the front end
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Smart Contracts v1
   </span>
  </p>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-29">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../general/introduction.html">
     Introduction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
    <label for="toctree-checkbox-30">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/contract-module.html">
       Smart contract modules
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/contract-instances.html">
       Smart contract instances
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/contract-schema.html">
       Smart contract schemas
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../general/develop-contracts.html">
       Developing smart contracts in Rust
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../guides/quick-start.html">
     Quick start guide
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../best-practices/index.html">
     Best practices
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
    <label for="toctree-checkbox-31">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../best-practices/development.html">
       Development best practices
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 current active has-children">
    <a class="reference internal" href="../index.html">
     Tutorials
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
    <label for="toctree-checkbox-32">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l2">
      <a class="reference internal" href="../setup-env.html">
       Setup the development environment
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../counter/counter-contract.html">
       Counter
      </a>
     </li>
     <li class="toctree-l2 current active has-children">
      <a class="reference internal" href="index.html">
       PiggyBank
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/>
      <label for="toctree-checkbox-33">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l3">
        <a class="reference internal" href="writing.html">
         Writing the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3 current active">
        <a class="current reference internal" href="#">
         Testing the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="deploying.html">
         Deploying the piggy bank smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="frontend.html">
         Setting up a front end
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../wCCD/index.html">
       wCCD
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/>
      <label for="toctree-checkbox-34">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-introduction.html">
         Understanding the wCCD token protocol
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-interacting.html">
         Interacting with the wCCD token protocol
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-front-end-set-up.html">
         Setting up the front end
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../wCCD/wCCD-full-dApp.html">
         Running your first full dApp
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../nft-minting/index.html">
       Mint an NFT
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/>
      <label for="toctree-checkbox-35">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-minting/upload-nft.html">
         Upload the NFT
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-minting/build-smart-contract.html">
         Intialize, build, and deploy the smart contract
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-minting/mint-xfer.html">
         Mint and transfer the NFT
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../sft-minting/index.html">
       Mint a semi-fungible token
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/>
      <label for="toctree-checkbox-36">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../sft-minting/setup.html">
         Setup the development environment
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../sft-minting/build-smart-contract.html">
         Smart contract modifications
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../sft-minting/mint-xfer.html">
         Mint and transfer semi-fungible token
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../fungible-tokens/index.html">
       Mint and burn fungible tokens
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/>
      <label for="toctree-checkbox-37">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../fungible-tokens/smart-contract.html">
         Smart contract implementation for fungible tokens
        </a>
       </li>
       <li class="toctree-l3">
        <a class="reference internal" href="../fungible-tokens/mint-xfer.html">
         Mint, transfer, and burn fungible tokens
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../nft-marketplace/index.html">
       NFT marketplace tutorial
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/>
      <label for="toctree-checkbox-38">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../nft-marketplace/smart-contract.html">
         Build and deploy the smart contract
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l2 has-children">
      <a class="reference internal" href="../eSealing/index.html">
       eSealing
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" type="checkbox"/>
      <label for="toctree-checkbox-39">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l3">
        <a class="reference internal" href="../eSealing/eSealing_dapp.html">
         Exploring the eSealing dapp
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../guides/contract-dev-guides.html">
     Contract development guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" type="checkbox"/>
    <label for="toctree-checkbox-40">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/setup-tools.html">
       Install tools for development
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/setup-contract.html">
       Setting up a smart contract project
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/compile-module.html">
       Compile a Rust smart contract module
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/unit-test-contract.html">
       Unit test a contract in Rust
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/custom-errors.html">
       Return custom errors
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/local-simulate.html">
       Locally simulate contract functions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/build-schema.html">
       Build a contract schema
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/no-std.html">
       Build using
       <code class="docutils literal notranslate">
        <span class="pre">
         no_std
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/fallback-entrypoints.html">
       Fallback entrypoints
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/upgradeable-contract.html">
       Make a contract upgradeable
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../guides/on-chain-index.html">
     On-chain guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" type="checkbox"/>
    <label for="toctree-checkbox-41">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/deploy-module.html">
       Deploy a smart contract module
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/initialize-contract.html">
       Initialize a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/interact-instance.html">
       Interact with a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/inspect-instance.html">
       Inspect a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../guides/invoke-instance.html">
       Invoke a smart contract instance
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../references/index.html">
     References
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" type="checkbox"/>
    <label for="toctree-checkbox-42">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/crypto-primitives.html">
       Cryptographic primitives
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/host-fns.html">
       Contract host functions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/local-settings.html">
       Local settings
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/references-on-chain.html">
       References on-chain
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/schema-json.html">
       Schema JSON representation
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../references/simulate-context.html">
       Simulation contexts
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts">
       Rust contract examples (repo)
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/">
       concordium-std
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../onboarding-guide-ethereum-developers/index.html">
     Ethereum developer onboarding
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" type="checkbox"/>
    <label for="toctree-checkbox-43">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../onboarding-guide-ethereum-developers/faq.html">
       FAQs
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../onboarding-guide-solana-developers/index.html">
     Solana developer onboarding
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" type="checkbox"/>
    <label for="toctree-checkbox-44">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../onboarding-guide-solana-developers/overview.html">
       Overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../onboarding-guide-solana-developers/faq.html">
       FAQs
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Smart Contracts v0
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-45">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../smart-contracts-v0/general/introduction.html">
     Introduction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" type="checkbox"/>
    <label for="toctree-checkbox-46">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/general/contract-module.html">
       Smart contract modules
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/general/contract-instances.html">
       Smart contract instances
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/general/contract-schema.html">
       Smart contract schemas
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/general/develop-contracts.html">
       Developing smart contracts in Rust
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../smart-contracts-v0/tutorials/piggy-bank/index.html">
     Tutorials
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" type="checkbox"/>
    <label for="toctree-checkbox-47">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/tutorials/piggy-bank/writing.html">
       Writing the piggy bank smart contract
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/tutorials/piggy-bank/testing.html">
       Testing the piggy bank smart contract
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../smart-contracts-v0/guides/contract-dev-guides.html">
     Contract development guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" type="checkbox"/>
    <label for="toctree-checkbox-48">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/setup-tools.html">
       Install tools for development
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/setup-contract.html">
       Setting up a smart contract project
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/compile-module.html">
       Compile a Rust smart contract module
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/unit-test-contract.html">
       Unit test a contract in Rust
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/custom-errors.html">
       Return custom errors
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/local-simulate.html">
       Locally simulate contract functions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/build-schema.html">
       Build a contract schema
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/no-std.html">
       Build using
       <code class="docutils literal notranslate">
        <span class="pre">
         no_std
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../smart-contracts-v0/guides/on-chain-index.html">
     On-chain guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" type="checkbox"/>
    <label for="toctree-checkbox-49">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/deploy-module.html">
       Deploy a smart contract module
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/initialize-contract.html">
       Initialize a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/interact-instance.html">
       Interact with a smart contract instance
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/guides/inspect-instance.html">
       Inspect a smart contract instance
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../smart-contracts-v0/references/index.html">
     References
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" type="checkbox"/>
    <label for="toctree-checkbox-50">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/references/schema-json.html">
       Schema JSON representation
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/references/simulate-context.html">
       Simulation contexts
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/references/host-fns.html">
       Contract host functions
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/references/references-on-chain.html">
       References on-chain
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../smart-contracts-v0/references/local-settings.html">
       Local settings
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts">
       Rust contract examples (repo)
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference external" href="https://docs.rs/concordium-std/2.0.0/concordium_std/">
       concordium-std
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Low-code NFT marketplace
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-51">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/low-code-nft-marketplace/introduction.html">
     Concordium low-code NFT framework
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/low-code-nft-marketplace/marketplace.html">
     Low code MFT marketplace
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/guides/low-code-nft-marketplace/minting-tool.html">
     Low-code NFT minting tool
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l0 has-children">
  <p aria-level="2" class="caption" role="heading">
   <span class="caption-text">
    Resources
   </span>
  </p>
  <input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" type="checkbox"/>
  <label class="label-parts" for="toctree-checkbox-52">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="nav bd-sidenav">
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/resources/ccd-scan.html">
     CCDScan
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" type="checkbox"/>
    <label for="toctree-checkbox-53">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-blocks.html">
       CCDScan Blocks overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-transactions.html">
       CCDScan Transactions overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-accounts.html">
       CCDScan Accounts overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-staking.html">
       CCDScan Staking overview
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/ccd-scan-nodes.html">
       CCDScan Nodes overview
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/release-notes-mainnet.html">
     Release notes - Mainnet
    </a>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/release-notes.html">
     Release Notes - Testnet
    </a>
   </li>
   <li class="toctree-l1 has-children">
    <a class="reference internal" href="../../../net/resources/legal.html">
     Legal
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-54" name="toctree-checkbox-54" type="checkbox"/>
    <label for="toctree-checkbox-54">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/terms-and-conditions-dw.html">
       Terms and Conditions for Concordium Desktop Wallet
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/terms-and-conditions-mw-gen2.html">
       Terms and Conditions for Concordium Wallet for Mobile
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/terms-and-conditions-mw.html">
       Terms and Conditions for Concordium Legacy Wallet (previously Concordium Mobile Wallet)
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/terms-and-conditions-bw.html">
       Terms and Conditions for Concordium Wallet for Web
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/third-party-licenses.html">
       Third Party Licenses
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/third-party-notices.html">
       Third-party Software and Hardware Notices
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/bw-licenses.html">
       Concordium Wallet for Web Third Party Licenses
      </a>
     </li>
     <li class="toctree-l2">
      <a class="reference internal" href="../../../net/resources/dw-licenses.html">
       Concordium Desktop Wallet Third Party Licenses
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l1">
    <a class="reference internal" href="../../../net/resources/ar-idp-contact.html">
     Contact Anonymity Revokers and Identity Providers
    </a>
   </li>
  </ul>
 </li>
</ul>
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparation">
   Preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-a-test-module">
   Add a test module
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-instantiation-of-a-piggy-bank">
   Testing instantiation of a piggy bank
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-inserting-ccd-into-a-piggy-bank">
   Test inserting CCD into a piggy bank
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-smashing-a-piggy-bank">
   Test smashing a piggy bank
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-cause-of-rejection">
   Testing cause of rejection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compiling-and-running-tests-in-wasm">
   Compiling and running tests in Wasm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-the-piggy-bank">
   Simulating the piggy bank
  </a>
 </li>
</ul>

</nav>
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="testing-the-piggy-bank-smart-contract">
<span id="piggy-bank-testing"></span><h1>Testing the piggy bank smart contract<a class="headerlink" href="#testing-the-piggy-bank-smart-contract" title="Permalink to this headline">#</a></h1>
<p>This is the second <a class="reference internal" href="index.html#piggy-bank"><span class="std std-ref">part of a tutorial</span></a> on smart contract
development.
So far you have written a piggy bank smart contract in the <a class="reference external" href="https://www.rust-lang.org/">Rust</a> programming
language.
This part will focus on how you can write unit tests for your piggy bank smart
contract and how to setup and locally simulate an invocation of a smart
contract.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The reader is assumed to have basic knowledge of what a blockchain and smart
contract is, and some experience with <a class="reference external" href="https://www.rust-lang.org/">Rust</a>.</p>
</div>
<div class="section" id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">#</a></h2>
<p>Before you start, make sure to have the necessary tooling to build Rust
contracts. The guide <a class="reference internal" href="../setup-env.html#setup-env"><span class="std std-ref">Setup the development environment</span></a> shows you how to do this.
Also, make sure to have a text editor setup to write Rust.</p>
<p>Since you are going to extend the smart contract code written in the <a class="reference internal" href="writing.html#piggy-bank-writing"><span class="std std-ref">previous
part</span></a>, either follow the previous part or copy the complete
example code for part 1 from <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/blob/main/examples/piggy-bank/part1/src/lib.rs">GitHub</a>.</p>
<p>You are now ready to write unit tests for your smart contract!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To request CCDs for testing, use the buttons in the Concordium Wallets when running Testnet.</p>
</div>
</div>
<div class="section" id="add-a-test-module">
<h2>Add a test module<a class="headerlink" href="#add-a-test-module" title="Permalink to this headline">#</a></h2>
<p>Since a smart contract module is written as a Rust library, you can test it as
one would test any library and write unit-tests as part of the Rust module.</p>
<p>At the bottom of the <code class="docutils literal notranslate"><span class="pre">lib.rs</span></code> file containing our code, make sure you have the
following starting point:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// PiggyBank contract code up here</span>

<span class="cp">#[cfg(test)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">tests</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This is your test module, which is a common pattern for writing unit tests in
Rust, so the above code will not be explained here.</p>
<p>Test the contract functions just as if they were regular functions by
calling the functions you have annotated with <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/attr.init.html"><code class="docutils literal notranslate"><span class="pre">#[init]</span></code></a> and <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/attr.receive.html"><code class="docutils literal notranslate"><span class="pre">#[receive]</span></code></a>.</p>
<p>But in order to call them, you will need to first construct the arguments.
Luckily <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/index.html"><code class="docutils literal notranslate"><span class="pre">concordium-std</span></code></a> contains a submodule <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/index.html"><code class="docutils literal notranslate"><span class="pre">test_infrastructure</span></code></a> with
stubs for this, so first bring everything from the submodule into scope.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[cfg(test)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">tests</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="hll"><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">test_infrastructure</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Now you can start adding tests to this module.</p>
</div>
<div class="section" id="testing-instantiation-of-a-piggy-bank">
<h2>Testing instantiation of a piggy bank<a class="headerlink" href="#testing-instantiation-of-a-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>The first test to add is to verify a piggy bank is set up with the correct
state.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="fm">todo!</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>As mentioned above, you test the initialization by calling the function
<code class="docutils literal notranslate"><span class="pre">piggy_init</span></code> directly.
To construct its arguments, you use <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/type.TestInitContext.html"><code class="docutils literal notranslate"><span class="pre">TestInitContext</span></code></a>, which provides a
placeholder for the context, and <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/type.TestStateBuilder.html"><code class="docutils literal notranslate"><span class="pre">TestStateBuilder</span></code></a>, which provides a
state builder for the test state. While the contract doesn’t use the state
builder, it still needs the argument supplied.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestInitContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">state_builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>Just as the name suggests, the test context is empty and if any of the getter
functions are called, it will make sure to fail the test, which should be fine
for now since the piggy bank is not reading anything from the context.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As you will see later with the <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/type.TestReceiveContext.html"><code class="docutils literal notranslate"><span class="pre">TestReceiveContext</span></code></a>, these placeholders have
setter functions, allowing us to partially specify the context.</p>
</div>
<p>Now you can call <code class="docutils literal notranslate"><span class="pre">piggy_init</span></code> and get a result containing the initial state.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">state_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">state_builder</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>First, you want the test to fail if the contract did not result in an
initial state:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_result</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Contract initialization results in error.&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Next, you assert the state is correctly set to <code class="docutils literal notranslate"><span class="pre">Intact</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="n">state</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="s">&quot;Piggy bank state should be intact after initialization.&quot;</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Putting it all together, you end up with the following test for initializing a
piggy bank:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// PiggyBank contract code up here</span>

<span class="cp">#[cfg(test)]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">tests</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">test_infrastructure</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cp">#[test]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestInitContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">state_builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">state_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">state_builder</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_result</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Contract initialization results in error.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">state</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">&quot;Piggy bank state should be intact after initialization.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Run the test to check that it compiles and succeeds.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>cargo <span class="nb">test</span>
</pre></div>
</div>
</div>
<div class="section" id="test-inserting-ccd-into-a-piggy-bank">
<h2>Test inserting CCD into a piggy bank<a class="headerlink" href="#test-inserting-ccd-into-a-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>Next, you should test the different functions for interacting with a piggy bank.
This works similarly to how you test init functions, in that you construct test
versions of the arguments.
For receive functions that means constructing <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/type.TestReceiveContext.html"><code class="docutils literal notranslate"><span class="pre">TestReceiveContext</span></code></a> and
<a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/struct.TestHost.html"><code class="docutils literal notranslate"><span class="pre">TestHost</span></code></a>, the latter of which expects the initial contract state.</p>
<p>To test <code class="docutils literal notranslate"><span class="pre">piggy_insert</span></code> you also need to provide some amount of CCD:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>When calling <code class="docutils literal notranslate"><span class="pre">piggy_insert</span></code> you get back a result with a return value as
opposed to the initial state that you get from <code class="docutils literal notranslate"><span class="pre">piggy_init</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The test then checks whether the result was ok:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Inserting CCD results in error&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>One test that is tempting to add is to check that the piggy bank remains intact
after inserting CCD into it:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;Piggy bank state should still be intact.&quot;</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>However, there is no way for the immutable receive method <code class="docutils literal notranslate"><span class="pre">piggy_insert</span></code> to
mutate the state.
Trying to do so would result in an error from the Rust compiler.
By using immutable receive functions, it is possible to rule out certain error
cases at compile time, which means that you do not need tests for these
scenarios.
Along with performance, those are the two primary reasons for not making your
receive methods <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_std_derive/attr.receive.html#mutable-function-can-mutate-the-state"><code class="docutils literal notranslate"><span class="pre">mutable</span></code></a> unless strictly necessary.</p>
<p>The second test becomes:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Inserting CCD results in error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Again, you should verify everything compiles and the tests succeeds using <code class="docutils literal notranslate"><span class="pre">cargo</span>
<span class="pre">test</span></code>.</p>
<p>Next, you could add a test to check that inserting into a piggy bank with state
<code class="docutils literal notranslate"><span class="pre">Smashed</span></code> results in an error. You have been through everything needed to
do this, and can do this exercise on your own.</p>
</div>
<div class="section" id="test-smashing-a-piggy-bank">
<h2>Test smashing a piggy bank<a class="headerlink" href="#test-smashing-a-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>Testing <code class="docutils literal notranslate"><span class="pre">piggy_smash</span></code> will follow the same pattern, but this time you will need
to populate the context since this function uses the context for getting the
contract owner, the sender of the message triggering the function.
You also need to set the balance on the host.</p>
<p>If you only supply the function with an empty context it will fail, so instead
define the context as mutable:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>Create an <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a> to represent the owner and use the setter
<code class="docutils literal notranslate"><span class="pre">set_owner</span></code> implemented on <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/type.TestReceiveContext.html"><code class="docutils literal notranslate"><span class="pre">TestReceiveContext</span></code></a>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="n">ctx</span><span class="p">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You created the account address using an array of 32 bytes, which is
how account addresses are represented on the Concordium blockchain.
These byte arrays can also be represented as a base58check encoding, but for
testing it is usually more convenient to specify addresses directly in bytes.</p>
</div>
<p>Next, set the sender to be the same address as the owner using <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/type.TestReceiveContext.html#method.set_sender"><code class="docutils literal notranslate"><span class="pre">set_sender</span></code></a>.
Since the sender can be a contract instance as well, you must wrap the owner
address in the <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/enum.Address.html"><code class="docutils literal notranslate"><span class="pre">Address</span></code></a> type:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="n">ctx</span><span class="p">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Lastly, you need to create a <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/struct.TestHost.html"><code class="docutils literal notranslate"><span class="pre">TestHost</span></code></a> with the state and set the balance of the piggy bank
instance using <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/struct.TestHost.html#method.set_self_balance"><code class="docutils literal notranslate"><span class="pre">set_self_balance</span></code></a>.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="n">host</span><span class="p">.</span><span class="n">set_self_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Now that you have the test context setup, call the contract function
<code class="docutils literal notranslate"><span class="pre">piggy_smash</span></code> and inspect the result and state as you did
in the previous tests.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_smash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w"></span>

<span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Smashing intact piggy bank results in error.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state</span><span class="p">(),</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Piggy bank should be smashed.&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>You should also test whether the contract transferred all of its CCD to the
owner.
<a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/struct.TestHost.html"><code class="docutils literal notranslate"><span class="pre">TestHost</span></code></a> has a number of helper functions for checking the results of
actions it performed.
This includes the <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure/struct.TestHost.html#method.get_transfers"><code class="docutils literal notranslate"><span class="pre">get_transfers</span></code></a> function, which returns a list of
transactions in the form of <code class="docutils literal notranslate"><span class="pre">(AccountAddress,</span> <span class="pre">Amount)</span></code> pairs.
In this case, it should be a single transaction:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span><span class="p">.</span><span class="n">get_transfers</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">[(</span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)],</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;Smashing did not produce the correct transfers.&quot;</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The complete third test thus becomes:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span><span class="p">.</span><span class="n">set_self_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_smash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Smashing intact piggy bank results in error.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state</span><span class="p">(),</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Piggy bank should be smashed.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">host</span><span class="p">.</span><span class="n">get_transfers</span><span class="p">(),</span><span class="w"></span>
<span class="w">        </span><span class="p">[(</span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)],</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;Smashing did not produce the correct transfers.&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Ensure everything compiles and the test succeeds using <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">test</span></code>.</p>
<p>Next, you could add a test to check that the <code class="docutils literal notranslate"><span class="pre">piggy_view</span></code> method returns the
correct state and balance. Again, you have been through everything needed to do
this, and can do this exercise on your own.</p>
</div>
<div class="section" id="testing-cause-of-rejection">
<h2>Testing cause of rejection<a class="headerlink" href="#testing-cause-of-rejection" title="Permalink to this headline">#</a></h2>
<p>You want to test that the piggy bank rejects in certain contexts, for example
when someone besides the owner of the smart contract tries to smash it.</p>
<p>The test should:</p>
<ul class="simple">
<li><p>Make a context where the sender and owner are two different accounts.</p></li>
<li><p>Set the state to be intact.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">piggy_smash</span></code>.</p></li>
<li><p>Check that the result is an error.</p></li>
</ul>
<p>The test could look like this:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">1</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]));</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span><span class="p">.</span><span class="n">set_self_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_smash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_err</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Contract is expected to fail.&quot;</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>One thing to notice is that the test is not ensuring <em>why</em> the contract
rejected; your piggy bank might reject for a wrong reason and this would be a
bug.
This is probably fine for a simple smart contract like your piggy bank, but for a
smart contract with more complex logic and many reasons for rejecting, it would
be better if you tested this as well.</p>
<p id="piggy-bank-smash-error">To solve this, introduce a <code class="docutils literal notranslate"><span class="pre">SmashError</span></code> enum  to represent the different
reasons for rejection:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[derive(Debug, PartialEq, Eq, Serial, Reject)]</span><span class="w"></span>
<span class="k">enum</span> <span class="nc">SmashError</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">NotOwner</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">AlreadySmashed</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TransferError</span><span class="p">,</span><span class="w"> </span><span class="c1">// Should never occur, see details below.</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information about custom errors and deriving <code class="docutils literal notranslate"><span class="pre">Reject</span></code>, see <a class="reference internal" href="../../guides/custom-errors.html#custom-errors"><span class="std std-ref">Return custom errors</span></a>.</p>
</div>
<p>To use this error type, the function <code class="docutils literal notranslate"><span class="pre">piggy_smash</span></code> should return <code class="docutils literal notranslate"><span class="pre">Result&lt;A,</span>
<span class="pre">SmashError&gt;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ReceiveResult&lt;A&gt;</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[receive(contract = </span><span class="s">&quot;PiggyBank&quot;</span><span class="cp">, name = </span><span class="s">&quot;smash&quot;</span><span class="cp">, mutable)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">piggy_smash</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasReceiveContext</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">HasHost</span><span class="o">&lt;</span><span class="n">PiggyBankState</span><span class="p">,</span><span class="w"> </span><span class="n">StateApiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">SmashError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="w">   </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>and you also have to supply the <code class="docutils literal notranslate"><span class="pre">ensure!</span></code> macros with a second argument, which is
the error to produce:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[receive(contract = </span><span class="s">&quot;PiggyBank&quot;</span><span class="cp">, name = </span><span class="s">&quot;smash&quot;</span><span class="cp">, mutable)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">piggy_smash</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasReceiveContext</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">HasHost</span><span class="o">&lt;</span><span class="n">PiggyBankState</span><span class="p">,</span><span class="w"> </span><span class="n">StateApiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">SmashError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">owner</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">sender</span><span class="p">();</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="n">ensure</span><span class="o">!</span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">matches_account</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owner</span><span class="p">),</span><span class="w"> </span><span class="n">SmashError</span>::<span class="n">NotOwner</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">ensure</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">SmashError</span>::<span class="n">AlreadySmashed</span><span class="p">);</span><span class="w"></span>
</span>
<span class="w">    </span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state_mut</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">self_balance</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">transfer_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">invoke_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">);</span><span class="w"></span>
<span class="hll"><span class="w">    </span><span class="n">ensure</span><span class="o">!</span><span class="p">(</span><span class="n">transfer_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="n">SmashError</span>::<span class="n">TransferError</span><span class="p">);</span><span class="w"></span>
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">invoke_transfer</span></code> fails if the account does not exist, or if the contract
has insufficient funds. Neither case can occur in the contract since contracts
always have a valid owner and the amount it sends is the <code class="docutils literal notranslate"><span class="pre">self_balance</span></code>. But
you should still be able to represent this error and distinguish it from the two
other error types.</p>
<p>You can now check which error was produced in the test:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">1</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]));</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">host</span><span class="p">.</span><span class="n">set_self_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_smash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">SmashError</span>::<span class="n">NotOwner</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Expected to fail with error NotOwner.&quot;</span><span class="p">);</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is up to the reader to test whether smashing a piggy bank that has
already been smashed results in the correct error.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For more information on unit testing, see <a class="reference internal" href="../../guides/unit-test-contract.html#unit-test-contract"><span class="std std-ref">Unit test a contract in Rust</span></a>.</p>
</div>
</div>
<div class="section" id="compiling-and-running-tests-in-wasm">
<h2>Compiling and running tests in Wasm<a class="headerlink" href="#compiling-and-running-tests-in-wasm" title="Permalink to this headline">#</a></h2>
<p>When running <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">test</span></code> your contract module and tests are compiled targeting
your native platform, but on the Concordium blockchain a smart contract module
is in <a class="reference external" href="https://webassembly.org/">Wasm</a>.
Therefore, it is preferable to compile the tests targeting Wasm and run the tests
using a Wasm interpreter instead.
Luckily, the <code class="docutils literal notranslate"><span class="pre">cargo-concordium</span></code> tool contains such an interpreter, and
it is the same interpreter shipped with the official nodes on the Concordium
blockchain.</p>
<p>Before you can run tests in Wasm, you have to replace <code class="docutils literal notranslate"><span class="pre">#[cfg(test)]</span></code> at the
top of your test module with <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/attr.concordium_cfg_test.html"><code class="docutils literal notranslate"><span class="pre">#[concordium_cfg_test]</span></code></a> and all the <code class="docutils literal notranslate"><span class="pre">#[test]</span></code>
macros with <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/attr.concordium_test.html"><code class="docutils literal notranslate"><span class="pre">#[concordium_test]</span></code></a>.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// PiggyBank contract code up here</span>

<span class="hll"><span class="cp">#[concordium_cfg_test]</span><span class="w"></span>
</span><span class="k">mod</span> <span class="nn">tests</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">test_infrastructure</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="cp">#[concordium_test]</span><span class="w"></span>
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="cp">#[concordium_test]</span><span class="w"></span>
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="cp">#[concordium_test]</span><span class="w"></span>
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="hll"><span class="w">    </span><span class="cp">#[concordium_test]</span><span class="w"></span>
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You also need to modify the tests a bit. Usually a test in <a class="reference external" href="https://www.rust-lang.org/">Rust</a> is failed
by panicking with an error message, but when compiling to Wasm this error
message is lost.
Instead you need generate code reporting the error back to the host who is
running the Wasm. To do so, <code class="docutils literal notranslate"><span class="pre">concordium-std</span></code> provides replacements:</p>
<ul class="simple">
<li><p>A call to <code class="docutils literal notranslate"><span class="pre">panic!</span></code> should be replaced with <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/macro.fail.html"><code class="docutils literal notranslate"><span class="pre">fail!</span></code></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">expect</span></code> and <code class="docutils literal notranslate"><span class="pre">expect_err</span></code> function should be replaced with
<a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/trait.ExpectReport.html#tymethod.expect_report"><code class="docutils literal notranslate"><span class="pre">expect_report</span></code></a> and <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/trait.ExpectErrReport.html#tymethod.expect_err_report"><code class="docutils literal notranslate"><span class="pre">expect_err_report</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">assert</span></code> and <code class="docutils literal notranslate"><span class="pre">assert_eq</span></code> should be replaced with <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/macro.claim.html"><code class="docutils literal notranslate"><span class="pre">claim!</span></code></a> and <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/macro.claim_eq.html"><code class="docutils literal notranslate"><span class="pre">claim_eq!</span></code></a>
respectively.</p></li>
</ul>
<p>All of these macros are wrappers, which behave the same as their counterpart
except when you build your smart contract for testing in Wasm using
<code class="docutils literal notranslate"><span class="pre">cargo-concordium</span></code>. This means you can still run tests for targeting native
using <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">test</span></code>.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// PiggyBank contract code up here</span>

<span class="cp">#[concordium_cfg_test]</span><span class="w"></span>
<span class="k">mod</span> <span class="nn">tests</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">use</span><span class="w"> </span><span class="n">test_infrastructure</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="cp">#[concordium_test]</span><span class="w"></span>
<span class="w">   </span><span class="k">fn</span> <span class="nf">test_init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestInitContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">state_builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>

<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">state_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">state_builder</span><span class="p">);</span><span class="w"></span>

<span class="hll"><span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_result</span><span class="p">.</span><span class="n">expect_report</span><span class="p">(</span><span class="s">&quot;Contract initialization failed.&quot;</span><span class="p">);</span><span class="w"></span>
</span>
<span class="hll"><span class="w">       </span><span class="n">claim_eq</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
</span><span class="w">           </span><span class="n">state</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="s">&quot;Piggy bank state should be intact after initialization.&quot;</span><span class="w"></span>
<span class="w">       </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="cp">#[concordium_test]</span><span class="w"></span>
<span class="w">   </span><span class="k">fn</span> <span class="nf">test_insert_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span><span class="w"></span>

<span class="hll"><span class="w">       </span><span class="n">claim</span><span class="o">!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Inserting CCD results in error&quot;</span><span class="p">);</span><span class="w"></span>
</span><span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="cp">#[concordium_test]</span><span class="w"></span>
<span class="w">   </span><span class="k">fn</span> <span class="nf">test_smash_intact</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="w">       </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="n">host</span><span class="p">.</span><span class="n">set_self_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span><span class="w"></span>

<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_smash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w"></span>

<span class="hll"><span class="w">       </span><span class="n">claim</span><span class="o">!</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Smashing intact piggy bank results in error.&quot;</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="w">       </span><span class="n">claim_eq</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">host</span><span class="p">.</span><span class="n">state</span><span class="p">(),</span><span class="w"> </span><span class="n">PiggyBankState</span>::<span class="n">Smashed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Piggy bank should be smashed.&quot;</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="w">       </span><span class="n">claim_eq</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
</span><span class="w">           </span><span class="n">host</span><span class="p">.</span><span class="n">get_transfers</span><span class="p">(),</span><span class="w"></span>
<span class="w">           </span><span class="p">[(</span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)],</span><span class="w"></span>
<span class="w">           </span><span class="s">&quot;Smashing did not produce the correct transfers.&quot;</span><span class="w"></span>
<span class="w">       </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="cp">#[concordium_test]</span><span class="w"></span>
<span class="w">   </span><span class="k">fn</span> <span class="nf">test_smash_intact_not_owner</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestReceiveContext</span>::<span class="n">empty</span><span class="p">();</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]);</span><span class="w"></span>
<span class="w">       </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_owner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Address</span>::<span class="n">Account</span><span class="p">(</span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">1</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="p">]));</span><span class="w"></span>
<span class="w">       </span><span class="n">ctx</span><span class="p">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHost</span>::<span class="n">new</span><span class="p">(</span><span class="n">PiggyBankState</span>::<span class="n">Intact</span><span class="p">,</span><span class="w"> </span><span class="n">TestStateBuilder</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amount</span>::<span class="n">from_micro_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="n">host</span><span class="p">.</span><span class="n">set_self_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span><span class="w"></span>

<span class="w">       </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">piggy_smash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">host</span><span class="p">);</span><span class="w"></span>

<span class="hll"><span class="w">       </span><span class="n">claim_eq</span><span class="o">!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">SmashError</span>::<span class="n">NotOwner</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Expected to fail with error NotOwner.&quot;</span><span class="p">);</span><span class="w"></span>
</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Compiling and running the tests in Wasm can be done using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>cargo concordium <span class="nb">test</span>
</pre></div>
</div>
<p>This will make a special test build of your smart contract module, exporting all
of your tests as functions, and it will then run each of these functions catching
the reported errors.
This should succeed if everything is set up correctly. Otherwise, compare your
code with the one found on <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/blob/main/examples/piggy-bank/part2/src/lib.rs">GitHub</a>.</p>
</div>
<div class="section" id="simulating-the-piggy-bank">
<h2>Simulating the piggy bank<a class="headerlink" href="#simulating-the-piggy-bank" title="Permalink to this headline">#</a></h2>
<p>So far the tests you have written are in <a class="reference external" href="https://www.rust-lang.org/">Rust</a> and have to be compiled alongside
the smart contract module in a test build. This is fine for unit testing, but
this test build is not the actual module that you intend to deploy on the
Concordium blockchain.</p>
<p>You should also test the smart contract wasm module meant for deployment, and you
can use the simulate feature of <code class="docutils literal notranslate"><span class="pre">cargo-concordium</span></code>. It takes a smart contract
wasm module and uses the Wasm interpreter to run a smart contract function in a
given context. For a reference of the context, see <a class="reference internal" href="../../references/simulate-context.html#simulate-context"><span class="std std-ref">Simulation contexts</span></a>.</p>
<p>For more on how to run simulations, see <a class="reference internal" href="../../guides/local-simulate.html#local-simulate"><span class="std std-ref">Locally simulate contract functions</span></a>.</p>
<p>To continue with the tutorial click <a class="reference internal" href="deploying.html#piggy-bank-deploying"><span class="std std-ref">here</span></a>.</p>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="writing.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Writing the piggy bank smart contract</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="deploying.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deploying the piggy bank smart contract</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>

<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {margin:0px;}
    
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }
    
    .cc a {
      display: inline-block;
      text-align: left;
      padding: 16px;
      color: black;
      font-size: 8px;
    }
    
</style>
<body>
    
    <div class="cc">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/">
            <img src="../../../_static/cc-sa-by.png" />  Copyright 2021 - 2023, Concordium Software ApS
        </a>
    </div>
  </body>

  </body>
</html>
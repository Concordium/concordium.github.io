


<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Integration tests &#8212; Concordium  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=19c83c19" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/tippy.css?v=124524c4" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=716d1818"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script defer="defer" src="https://unpkg.com/@popperjs/core@2"></script>
    <script defer="defer" src="https://unpkg.com/tippy.js@6"></script>
    <script defer="defer" src="../../../_static/tippy/docs/smart-contracts/guides/integration-test-contract.92ef2c95-5742-4b8e-93a4-93c0089a8e38.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/smart-contracts/guides/integration-test-contract';</script>
    <link rel="canonical" href="https://docs.concordium.com/en/mainnet/docs/smart-contracts/guides/integration-test-contract.html" />
    <link rel="icon" href="../../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Deploy a smart contract module" href="deploy-module.html" />
    <link rel="prev" title="Unit testing" href="unit-test-contract.html" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">Learn how to build with Protocol Level Tokens (PLTs). Read more about PLTs on the <a href="https://www.concordium.com/article/smart-money-starts-here-concordiums-protocol-level-tokens" target="_blank">Concordium website</a> or dive into our <a href="https://docs.concordium.com/en/mainnet/docs/plt/index.html">developer documentation</a>.</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item"><style>
.navbar-brand img {
    max-height: 200px;
    width: auto;
}
</style>

<div>
    <a href="https://developer.concordium.software/">
        <img class="logo light-logo" src="../../../_static/concordium-logo-dark.svg" />
        <img class="logo dark-logo" src="../../../_static/concordium-logo.svg" />
    </a>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../index.html">
    Docs
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/index.html">
    Community
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://discord.com/invite/GpKGE2hCFx" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-youtube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/@concordium" title="Medium" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-medium fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Medium</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../index.html">
    Docs
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/index.html">
    Community
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://discord.com/invite/GpKGE2hCFx" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-youtube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/@concordium" title="Medium" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-medium fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Medium</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Concordium Protocol</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../protocol/concordium-protocol.html">What is the Concordium Protocol</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../protocol/identity.html">Identity</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/principles-of-privacy.html">Principles of privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/user-processes.html">User processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/identity-disclosure-processes.html">Identity disclosure processes</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/manage-accounts.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/key-derivation-and-usage.html">Key derivation and usage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../protocol/transactions.html">Transactions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/transaction%20lifecycle.html">Transaction lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/transaction-fees.html">Transaction fees</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/consensus-mechanisms.html">Consensus mechanisms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/concepts-baker.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/concepts-delegation.html">Delegation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Protocol Level Tokens</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../plt/index.html">What are Protocol-Level Tokens (PLTs)?</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../plt/setup-guide/index.html">Get started with PLTs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../plt/setup-guide/browser-wallet.html">Set up Browser Wallet for DevNet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/setup-guide/devnet-connection.html">Connect to DevNet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/setup-guide/identity-creation.html">Create a DevNet identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/setup-guide/account-creation.html">Create a DevNet account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/setup-guide/request-ccd.html">Request test CCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/setup-guide/request-plt.html">Request PLT issuance</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../plt/operations/index.html">Operations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../plt/examples/index.html">Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../plt/examples/concordium-client.html">Concordium Client CLI Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/examples/web-sdk.html">Web SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plt/examples/rust-sdk.html">Rust SDK</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Smart Contracts</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">QuickStart</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction.html">What is a smart contract?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contract-lifecycle.html">Life cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contract-module.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contract-instances.html">Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contract-schema.html">Contract schemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../develop-contracts.html">Using Rust</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="build-contract.html">Build</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup-contract.html">Set up a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="compile-module.html">Module Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-errors.html">Custom errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-schema.html">Build a contract schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="no-std.html">Using <code class="docutils literal notranslate"><span class="pre">no_std</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="fallback-entrypoints.html">Fallback entrypoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgradeable-contract.html">Upgradeability Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="json-params.html">JSON parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrate-contracts.html">Migrate contracts for <code class="docutils literal notranslate"><span class="pre">concordium-std</span></code> 8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="factory-pattern.html">Factory pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-test-contract.html">Unit testing</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Integration tests</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="deploy-module.html">Deploy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="initialize-contract.html">Initialize</a></li>
<li class="toctree-l2"><a class="reference internal" href="interact-instance.html">Interact</a></li>
<li class="toctree-l2"><a class="reference internal" href="inspect-instance.html">Inspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="invoke-instance.html">Invoke</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../best-practices/index.html">Best practices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../best-practices/development.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../best-practices/costs.html">Cost reduction</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../references/index.html">References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../references/crypto-primitives.html">Cryptographic primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/host-fns.html">Contract host functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/local-settings.html">Local settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/references-on-chain.html">References on-chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/schema-json.html">Schema JSON representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/simulate-context.html">Simulation contexts</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts">Rust contract examples (repo)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/">concordium-std</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Network</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/baker-pool.html">Validator Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/validation-with-wallets.html">Validation with Concordium wallets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/become-validator.html">Validation with the Concordium Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/add-baker-mw.html">Add a validator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/import-validator-keys.html">Import validator keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/update-baker-mw.html">Change validator options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/suspend-unsuspend-validator.html">Suspend/Unsuspend a validator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/stop-validator.html">Stop a validator</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/nodes/node-requirements.html">Run a Concordium Node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../network/nodes/run-node-ubuntu/index.html">Run a node on Ubuntu</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-ubuntu/run-node-ubuntu.html">Install and manage a node on Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-ubuntu/advanced-node-configuration-on-ubuntu.html">Advanced node configuration on Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-ubuntu/troubleshoot-node-ubuntu.html">Troubleshoot a node on Ubuntu</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../network/nodes/run-node-macos/index.html">Run a Node on macOS</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-macos/run-node-macos.html">Install and manage a node on macOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-macos/advanced-node-configuration-on-macos.html">Advanced node configuration on macOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-macos/troubleshoot-macos.html">Troubleshoot a node on macOS</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../network/nodes/run-node-windows/index.html">Run a node on Windows</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-windows/run-node-windows.html">Install and manage a node on Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-windows/advanced-node-configuration-on-windows.html">Advanced node configuration on Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-windows/node-runner-service-configuration.html">Concordium Windows node runner service configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-windows/troubleshoot-windows.html">Troubleshoot a node on Windows</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../network/nodes/run-node-docker/index.html">Run a node using Docker</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-docker/run-node-docker.html">Install and manage a node on Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-docker/advanced-node-configuration-on-docker.html">Advanced node configuration on Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-docker/troubleshoot-docker.html">Troubleshoot a node in Docker</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../network/nodes/run-node-aws/index.html">Run a node on AWS</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../network/nodes/run-node-aws/run-node-aws.html">Run a node on Amazon Web Services (AWS)</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/web3-id/index.html">Use Concordium's ID layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/web3-id/issuer.html">Web3 ID issuers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/web3-id/identity-provider-interfaces.html">Wallet identity provider interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/create-proofs.html">Create proofs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/guides/run-local-chain.html">Run a local chain</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/indexers/intro.html">Indexers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/indexers/subquery.html">SubQuery</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Help &amp; FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../installation/downloads.html">Downloads</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation/verification-instructions.html">Verification instructions</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/release-notes-lp.html">Release notes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../guides/wallets-lp.html">Concordium wallets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/wallet-faqs.html">Wallet FAQs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guides/deciding-wallet.html">Deciding between the wallets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/cryptox-faq.html">CryptoX Concordium Wallet FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../browser-wallet/browser-wallet-faq.html">Concordium Wallet for Web FAQ</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/setup-wallets-lp.html">Set up a wallet</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guides/setup-cryptox-wallet.html">Set up the CryptoX Concordium Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../browser-wallet/setup-browser-wallet.html">Set up the Concordium Wallet for Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/overview-desktop.html">Set up the Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/ledger-tutorial.html">Use your Ledger Device with Concordium Desktop Wallet</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/manage-wallets-lp.html">Wallet activities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/create-identity.html">Create an identity</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guides/change-identity-name.html">Change identity name</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/create-account.html">Create an account</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guides/change-account-name.html">Change account name</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/recovery.html">Backup and recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/change-passcode-mw.html">Update your passcode and biometric settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/address-book.html">Manage address book</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/transaction-report.html">Create a transaction report</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/show-seed-phrase.html">Show seed phrase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/show-wallet-private-key.html">Show wallet private key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/import-export-file.html">Import/export file wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/wallet.html">Web3 ID in the Concordium Wallet for Web</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/account-activities-lp.html">Account activities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guides/send-ccd-wallets.html">Send CCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/share-address-mw.html">Find and share your account address</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../browser-wallet/connect-app.html">Connect dApps to wallets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guides/proofs.html">Proofs and revealing information</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/tokens.html">Tokens in the wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/shield-ccd-wallets.html">Unshield CCD on an account</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/scheduled-release.html">Scheduled releases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/single-sign-schedule.html">Transfer CCD with a schedule in Desktop Wallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mobile-wallet/inspect-release-schedule-mw.html">Inspect a release schedule</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/export-account-private-key.html">Export account private key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/export-transaction-logs.html">Export transaction logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/add-delegation.html">Delegate to a staking pool or passive delegation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/remove-delegation.html">Remove delegation to a staking pool or passive delegation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/update-delegation.html">Update delegation to a staking pool or passive delegation</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../desktop-wallet/dw-lp.html">Desktop Wallet</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/single-sign-schedule.html">Transfer CCD with a schedule in Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/transaction-log-filter.html">Apply a transaction log filter in the Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/update-application.html">Update the Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/accounts-desktop.html">Desktop Wallet navigation and settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/reset-data.html">Reset desktop wallet data</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/overview-shared-accounts.html">Shared accounts with multiple credentials in Desktop Wallet</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/create-credentials-file.html">Create a credentials file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guides/multi-credentials.html">Add credentials to an account</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/multisig-simple-transfer.html">Create a multi-signature CCD transfer in the Desktop Wallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guides/multisig-transfer.html">Create a scheduled transfer in the Desktop Wallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/sign-transaction.html">Sign a transaction proposal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/proposed-transactions.html">View transaction proposals</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides/cryptox-terms.html">End User License Terms for CryptoX Concordium Wallet</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../help-and-faq/faqs.html">FAQs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/delegation-faq.html">Delegation and validation FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/onboarding-guide-ethereum-developers/faq.html">FAQ for Ethereum developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/onboarding-guide-solana-developers/faq.html">FAQ for Solana developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/onboarding-guide-solana-developers/overview.html">Onboarding for Solana developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/set-up-doc-env-MacOs.html">Set up Concordium documentation environment on MacOs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/style-guide.html">Concordium documentation style guide</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference external" href="https://proposals.concordium.software/index.html">Concordium Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/glossary.html">Glossary of Concordium terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/exchangeOnBoarding.html">Exchange Onboarding Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Governance Committee Voting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../voting/gc-voting.html">Concordium Governance Committee elections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/coordinator.html">Election coordinator tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/voting.html">How to vote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/guardians.html">Guardians</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/verify-election-result.html">Verify election result</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="integration-tests">
<span id="integration-test-contract"></span><h1>Integration tests<a class="headerlink" href="#integration-tests" title="Link to this heading">#</a></h1>
<p>This guide describes how to write <em>integration tests</em> in Rust for your smart contracts using the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/">Concordium smart contract testing library</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unit testing your contracts with the <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/test_infrastructure"><code class="docutils literal notranslate"><span class="pre">test_infrastructure</span></code></a> has been deprecated in favor of <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_smart-contract-testing"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a>.
To migrate your contracts and tests see <a class="reference internal" href="migrate-contracts.html#migrate-contracts-for-std-8-1"><span class="std std-ref">Migrate contracts for concordium-std 8.1</span></a>.
You can read the <a class="reference internal" href="unit-test-contract.html#unit-test-contract"><span class="std std-ref">old documentation for unit testing here</span></a> if you are not ready to migrate your contracts.</p>
</div>
<p>The library allows you to test individual contracts in isolation, but, notably, also interactions between multiple contracts.
When running the tests, they are executed locally on the exact contract code that is deployed on the chain, and using the same execution engine that the nodes use.
V0 smart contracts are not supported, but all V1 smart contract features are, including upgrades, and it is also possible to see the energy usage of your contracts.
This allows you to refactor and optimize your contracts for speed and efficiency with greater ease and confidence.</p>
<p>The high-level process of adding integration tests to your existing smart contract project is as follows:</p>
<ol class="arabic">
<li><p>Add the testing library to your <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> file and use Rust edition <code class="docutils literal notranslate"><span class="pre">2021</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">package</span><span class="p p-Indicator">]</span>
<span class="c1"># ...</span>
<span class="l l-Scalar l-Scalar-Plain">edition = &quot;2021&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[dev-dependencies]</span>
<span class="l l-Scalar l-Scalar-Plain">concordium-smart-contract-testing = &quot;1.0&quot;</span>
</pre></div>
</div>
<p>By putting it under <code class="docutils literal notranslate"><span class="pre">dev-dependencies</span></code>, it is only included for tests.
You must use edition <code class="docutils literal notranslate"><span class="pre">2021</span></code> or greater as that is a requirement for the testing library.</p>
</li>
<li><p>Write tests in files residing in <code class="docutils literal notranslate"><span class="pre">my-project/tests/</span></code>.
Example content:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">concordium_smart_contract_testing</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;concordium-out/module.wasm.v1&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where you specify the path to the Wasm file built in the next step.</p>
</li>
<li><p>Run your tests with <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span> <span class="pre">--out</span> <span class="pre">concordium-out/module.wasm.v1</span></code>
This command also builds the Wasm module and outputs the Wasm module to the specified path.</p></li>
</ol>
<p>With a high-level understanding of the workflow, you are ready to write the actual tests.
Each section below covers part of a typical integration test.</p>
<section id="creating-a-chain">
<h2>Creating a chain<a class="headerlink" href="#creating-a-chain" title="Link to this heading">#</a></h2>
<p>The primary construct used for testing is the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html"><code class="docutils literal notranslate"><span class="pre">Chain</span></code></a> type, which you should only create one of per test.
It represents the blockchain and has methods for creating accounts and deploying and working with contracts.</p>
<p>Use the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.new"><code class="docutils literal notranslate"><span class="pre">Chain::new</span></code></a> method to create a chain with default settings.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also create a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html"><code class="docutils literal notranslate"><span class="pre">Chain</span></code></a> with custom values for exchange rates and the block time using a builder pattern where you configure a number of options and finish off by calling the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ChainBuilder.html#method.build"><code class="docutils literal notranslate"><span class="pre">build</span></code></a> method.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">builder</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Specify a block time.</span>
<span class="w">        </span><span class="p">.</span><span class="n">block_time</span><span class="p">(</span><span class="n">Timestamp</span><span class="p">::</span><span class="n">from_timestamp_millis</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// Specify the Euro to energy exchange rate.</span>
<span class="w">        </span><span class="p">.</span><span class="n">euro_per_energy</span><span class="p">(</span><span class="n">ExchangeRate</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">50000</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// Specify the microCCD to Euro exchange rate.</span>
<span class="w">        </span><span class="p">.</span><span class="n">micro_ccd_per_euro</span><span class="p">(</span><span class="n">ExchangeRate</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="mi">50000</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// Try to build the Chain using the configured parameters.</span>
<span class="w">        </span><span class="p">.</span><span class="n">build</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// The parameters might be invalid, so it returns a `Result` which is unwrapped.</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is even possible to connect to an external Concordium node and get the exchange rates or block time from it.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">builder</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Connect to the public testnet node on its gRPCv2 port 20000.</span>
<span class="w">        </span><span class="p">.</span><span class="n">external_node_connection</span><span class="p">(</span><span class="n">Endpoint</span><span class="p">::</span><span class="n">from_static</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;http://grpc.testnet.concordium.com:20000&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">        </span><span class="c1">// Specify which block to use for queries. If omitted, the last final block will be used.</span>
<span class="w">        </span><span class="p">.</span><span class="n">external_query_block</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;b22466d87a273be64df283f8db0435aab945b2dd54f4df07b82fd02418be0c96&quot;</span>
<span class="w">                </span><span class="p">.</span><span class="n">parse</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Specify that the exchange rates and block time should</span>
<span class="w">        </span><span class="c1">// be set to match the queried values from the node.</span>
<span class="w">        </span><span class="p">.</span><span class="n">euro_per_energy_from_external</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">micro_ccd_per_euro_from_external</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">block_time_from_external</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Try to build the Chain using the configured parameters.</span>
<span class="w">        </span><span class="p">.</span><span class="n">build</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// The parameters might be invalid, so it returns a `Result` which is unwrapped.</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When getting values from an external node, it will use the same block for all the queries.
The block will either be the one you specify with <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ChainBuilder.html#method.external_query_block"><code class="docutils literal notranslate"><span class="pre">external_query_block</span></code></a> or the last final block at the time.
Also note that you can mix and match configuration options, for example by specifying your own block time while using the microCCD to Euro exchange rate from an external node.
You can find all the configuration options including examples in the documentation for <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ChainBuilder.html"><code class="docutils literal notranslate"><span class="pre">ChainBuilder</span></code></a>.</p>
</section>
<section id="creating-accounts">
<h2>Creating accounts<a class="headerlink" href="#creating-accounts" title="Link to this heading">#</a></h2>
<p>The next step is to create one or more <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Account.html"><code class="docutils literal notranslate"><span class="pre">Account</span></code></a> entities and add them to the chain.</p>
<p>Accounts have multiple constructors that allow you to specify more details.
The simplest one is <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Account.html#method.new"><code class="docutils literal notranslate"><span class="pre">Account::new</span></code></a>, which takes an <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a> and a total balance of the account.
Once constructed, use the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.create_account"><code class="docutils literal notranslate"><span class="pre">create_account</span></code></a> method to add it to the chain.
This step is important, as simply constructing an <code class="docutils literal notranslate"><span class="pre">Account</span></code> does not make the chain aware of it.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="mi">32</span><span class="p">]);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Account</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">account_address</span><span class="p">,</span><span class="w"> </span><span class="n">Amount</span><span class="p">::</span><span class="n">from_ccd</span><span class="p">(</span><span class="mi">123</span><span class="p">));</span>
<span class="w">    </span><span class="n">chain</span><span class="p">.</span><span class="n">create_account</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The account address is <code class="docutils literal notranslate"><span class="pre">[0u8;32]</span></code>, which is a Rust shorthand for creating a byte array with all zeroes.
Also note that account addresses are aliases of one another if they match on the first 29 bytes.
Creating accounts <code class="docutils literal notranslate"><span class="pre">[0u8;32]</span></code>, <code class="docutils literal notranslate"><span class="pre">[1u8;32]</span></code>, <code class="docutils literal notranslate"><span class="pre">[3u8;32]</span></code>, etc. will ensure that they aren’t aliases, which is what you want in most cases.
It is important to set an appropriate balance for the account, as executing transactions, for example deploying modules, on the chain deducts CCD from the account’s balance, and running out of CCD gives you an error.
You can check the account balance with <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.account_balance_available"><code class="docutils literal notranslate"><span class="pre">account_balance_available</span></code></a> after each of the transactions you execute in the following sections to see that the transaction fees are subtracted from the balance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is also possible to use real account addresses from the chain, which are shown in base58 encoding, but still represent 32 bytes.
For example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">my_chain_account</span><span class="p">:</span><span class="w"> </span><span class="nc">AccountAddress</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="s">&quot;3kBx2h5Y2veb4hZgAJWPrr8RyQESKm5TjzF3ti1QQ4VSYLwK1G&quot;</span><span class="p">.</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</pre></div>
</div>
</div>
</section>
<section id="deploy-modules">
<h2>Deploy modules<a class="headerlink" href="#deploy-modules" title="Link to this heading">#</a></h2>
<p>Deploying smart contract modules is a two-step process.
First, you load the module with the function <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/fn.module_load_v1.html"><code class="docutils literal notranslate"><span class="pre">module_load_v1</span></code></a>, then you deploy it to the chain with the method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.module_deploy_v1"><code class="docutils literal notranslate"><span class="pre">module_deploy_v1</span></code></a>.
Loading as a separate step allows you to reuse the loaded module across multiple tests for efficiency.</p>
<p>The module to load must be a <code class="docutils literal notranslate"><span class="pre">wasm</span></code> module compiled with <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">build</span></code> or, if using cargo concordium version 2.9.0+, <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span> <span class="pre">--out</span> <span class="pre">path/to/wasm/module</span></code>.
Using the test command is ideal, as that will both compile the module <em>and</em> run the tests.
By compiling the module every time, you ensure that the tests run on the newest version of your code.
For example, for <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">concordium</span> <span class="pre">test</span> <span class="pre">--embed-schema</span> <span class="pre">--out</span> <span class="pre">my_module.wasm.v1</span></code>, you write:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;my_module.wasm.v1&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Loading a module can fail in multiple ways, for example because it is missing or corrupt, so the function returns <code class="docutils literal notranslate"><span class="pre">Result</span></code>, which you <code class="docutils literal notranslate"><span class="pre">unwrap</span></code> here because you know it will succeed.
If it doesn’t succeed, the test will fail and you can fix your mistake.
You can also use <code class="docutils literal notranslate"><span class="pre">.expect(&quot;Loading</span> <span class="pre">module</span> <span class="pre">should</span> <span class="pre">succeed&quot;)</span></code> instead to provide better error messages on failures, but the remainder of this guide will use <code class="docutils literal notranslate"><span class="pre">unwrap</span></code> for brevity.</p>
<p>With the module loaded, you are ready to deploy it.
Since this is a transaction, it involves an account that pays for the cost.
Additionally, you must specify a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> with a number of keys.
This mimics the behavior on the real chain, where one or more keys must sign a transaction.
The only observable difference between using one or more keys is the cost of the transaction, where each extra key increases the cost slightly.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="mi">32</span><span class="p">]);</span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;my_module.wasm.v1&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span>
<span class="w">        </span><span class="p">.</span><span class="n">module_deploy_v1</span><span class="p">(</span>
<span class="w">            </span><span class="n">Signer</span><span class="p">::</span><span class="n">with_one_key</span><span class="p">(),</span>
<span class="w">            </span><span class="n">account_address</span><span class="p">,</span>
<span class="w">            </span><span class="n">module</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since deployment can fail, for example if the account doesn’t have sufficient CCD to cover the cost, the method returns <code class="docutils literal notranslate"><span class="pre">Result</span></code>, which is unwrapped.
The struct returned has information about the energy used, transaction fee, and a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/type.ModuleReference.html"><code class="docutils literal notranslate"><span class="pre">ModuleReference</span></code></a> that you use for initializing contracts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are familiar with the <a class="reference external" href="https://docs.rs/anyhow/latest/anyhow/">anyhow crate</a>, you can use it to replace <code class="docutils literal notranslate"><span class="pre">unwrap</span></code> / <code class="docutils literal notranslate"><span class="pre">expect</span></code> with the more ergonomic <code class="docutils literal notranslate"><span class="pre">?</span></code> operator.
For example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="hll"><span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">anyhow</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="mi">32</span><span class="p">]);</span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity</span>
<span class="hll"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module_load_v1</span><span class="p">(</span><span class="s">&quot;my_module.wasm.v1&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span>
<span class="w">        </span><span class="p">.</span><span class="n">module_deploy_v1</span><span class="p">(</span>
<span class="w">            </span><span class="n">Signer</span><span class="p">::</span><span class="n">with_one_key</span><span class="p">(),</span>
<span class="w">            </span><span class="n">account_address</span><span class="p">,</span>
<span class="hll"><span class="w">            </span><span class="n">module</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="initialize-contracts">
<h2>Initialize contracts<a class="headerlink" href="#initialize-contracts" title="Link to this heading">#</a></h2>
<p>With the module deployed, you are ready to initialize a contract with the chain method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_init"><code class="docutils literal notranslate"><span class="pre">contract_init</span></code></a>.
The method has the following parameters:</p>
<ul class="simple">
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> to sign the transaction.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a>, which pays for the transaction.</p></li>
<li><p>A maximum <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Energy.html"><code class="docutils literal notranslate"><span class="pre">Energy</span></code></a> that the contract initialization can use.</p></li>
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/type.ModuleReference.html"><code class="docutils literal notranslate"><span class="pre">ModuleReference</span></code></a>, which you got from the deployment section above.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedContractName.html"><code class="docutils literal notranslate"><span class="pre">OwnedContractName</span></code></a> that specifies which contract in the module you want to initialize.
Contract names are prefixed with <code class="docutils literal notranslate"><span class="pre">init_</span></code> on the chain to distinguish them from receive functions (entrypoints).
You constuct it with either <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedContractName.html#method.new"><code class="docutils literal notranslate"><span class="pre">OwnedContractName::new</span></code></a>, which checks the validity and returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedContractName.html#method.new_unchecked"><code class="docutils literal notranslate"><span class="pre">OwnedContractName::new_unchecked</span></code></a>, which performs no checking.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html"><code class="docutils literal notranslate"><span class="pre">OwnedParameter</span></code></a>, which is a wrapper over a byte array that you construct with one of the following methods:</p>
<ul>
<li><p><a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.from_serial"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::from_serial</span></code></a>, which serializes the input and checks that the parameter size is valid,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TryFrom::&lt;Vec&lt;u8&gt;&gt;::try_from(..)</span></code>, which also checks the parameter size,</p></li>
<li><p>or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.empty"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::empty</span></code></a>, which always succeeds.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Amount.html"><code class="docutils literal notranslate"><span class="pre">Amount</span></code></a> to send to the contract.</p></li>
</ul>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">initialization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_init</span><span class="p">(</span>
<span class="w">            </span><span class="n">Signer</span><span class="p">::</span><span class="n">with_one_key</span><span class="p">(),</span>
<span class="w">            </span><span class="n">account_address</span><span class="p">,</span>
<span class="w">            </span><span class="n">Energy</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span>
<span class="w">            </span><span class="n">InitContractPayload</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">mod_ref</span><span class="p">:</span><span class="w"> </span><span class="nc">deployment</span><span class="p">.</span><span class="n">module_reference</span><span class="p">,</span>
<span class="w">                </span><span class="n">init_name</span><span class="p">:</span><span class="w"> </span><span class="nc">OwnedContractName</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;init_my_contract&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">                </span><span class="n">param</span><span class="p">:</span><span class="w"> </span><span class="nc">OwnedParameter</span><span class="p">::</span><span class="n">from_serial</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&quot;my_param&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
<span class="w">                </span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="nc">Amount</span><span class="p">::</span><span class="n">zero</span><span class="p">(),</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Initialization can fail for several different reasons, and thus returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, which is unwrapped.
The struct returned contains information about the energy used, transaction fee, contract events (logs) produced, and a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a> that you use for updating the contract in the next section.</p>
</section>
<section id="update-contract-entrypoints">
<h2>Update contract entrypoints<a class="headerlink" href="#update-contract-entrypoints" title="Link to this heading">#</a></h2>
<p>With the contract initialized, you are ready to update it with the chain method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a>, which has the following parameters:</p>
<ul class="simple">
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Signer.html"><code class="docutils literal notranslate"><span class="pre">Signer</span></code></a> to sign the transaction.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">invoker</span></code> of type <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a>, which pays for the transaction.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">sender</span></code> of type <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/enum.Address.html"><code class="docutils literal notranslate"><span class="pre">Address</span></code></a>, which can either be an <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.AccountAddress.html"><code class="docutils literal notranslate"><span class="pre">AccountAddress</span></code></a> or a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a>.</p>
<ul>
<li><p>The main utility of the parameter is that it allows you to test internal calls in your contracts directly.</p></li>
<li><p>For example, if you have a more complex scenario where an account calls contract <code class="docutils literal notranslate"><span class="pre">A</span></code> which internally calls contract <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<ul>
<li><p>In this case you can test the complete integration by calling <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p></li>
<li><p>But you can also test <code class="docutils literal notranslate"><span class="pre">B</span></code> as its own unit by calling it directly and specifying <code class="docutils literal notranslate"><span class="pre">A</span></code> as the <code class="docutils literal notranslate"><span class="pre">sender</span></code>.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>A maximum <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Energy.html"><code class="docutils literal notranslate"><span class="pre">Energy</span></code></a> that the contract update can use.</p></li>
<li><p>A <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractAddress.html"><code class="docutils literal notranslate"><span class="pre">ContractAddress</span></code></a>, which you got from the initialization section above.</p></li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedReceiveName.html"><code class="docutils literal notranslate"><span class="pre">OwnedReceiveName</span></code></a> that specifies which receive name in the module you want to initialize.</p>
<ul>
<li><p>A “receive name” is the contract name concatenated with the entrypoint name and a dot in between.</p></li>
<li><p>In this example, the contract <code class="docutils literal notranslate"><span class="pre">my_contract</span></code> and the entrypoint <code class="docutils literal notranslate"><span class="pre">my_entrypoint</span></code> combine to become the receive name <code class="docutils literal notranslate"><span class="pre">my_contract.my_entrypoint</span></code>.</p></li>
<li><p>You construct it with either <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedReceiveName.html#method.new"><code class="docutils literal notranslate"><span class="pre">OwnedReceiveName::new</span></code></a>, which checks the format and returns a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedReceiveName.html#method.new_unchecked"><code class="docutils literal notranslate"><span class="pre">OwnedReceiveName::new_unchecked</span></code></a>, which performs no checks.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html"><code class="docutils literal notranslate"><span class="pre">OwnedParameter</span></code></a>, which is a wrapper over a byte array that you construct with one of the following methods:</p>
<ul>
<li><p><a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.from_serial"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::from_serial</span></code></a>, which serializes the input and checks that the parameter size is valid,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TryFrom::&lt;Vec&lt;u8&gt;&gt;::try_from(..)</span></code>, which also checks the parameter size,</p></li>
<li><p>or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.OwnedParameter.html#method.empty"><code class="docutils literal notranslate"><span class="pre">OwnedParameter::empty</span></code></a>, which always succeeds.</p></li>
</ul>
</li>
<li><p>An <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Amount.html"><code class="docutils literal notranslate"><span class="pre">Amount</span></code></a> to send to the contract.</p></li>
</ul>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span>
<span class="w">            </span><span class="n">Signer</span><span class="p">::</span><span class="n">with_one_key</span><span class="p">(),</span>
<span class="w">            </span><span class="n">account_address</span><span class="p">,</span>
<span class="w">            </span><span class="n">Address</span><span class="p">::</span><span class="n">Account</span><span class="p">(</span><span class="n">account_address</span><span class="p">),</span>
<span class="w">            </span><span class="n">Energy</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span>
<span class="w">                </span><span class="n">receive_name</span><span class="p">:</span><span class="w"> </span><span class="nc">OwnedReceiveName</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;my_contract.my_entrypoint&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">                </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="nc">OwnedParameter</span><span class="p">::</span><span class="n">from_serial</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">42</span><span class="k">u8</span><span class="p">).</span><span class="n">unwrap</span><span class="p">(),</span>
<span class="w">                </span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="nc">Amount</span><span class="p">::</span><span class="n">from_ccd</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Updates can also fail, and thus return a <code class="docutils literal notranslate"><span class="pre">Result</span></code>, which is unwrapped here.
The struct returned on success contains information about the energy used, the transaction fee, the return value from the entrypoint, a vector of <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/enum.ContractTraceElement.html"><code class="docutils literal notranslate"><span class="pre">ContractTraceElement</span></code></a>, whether the contract state has changed, and the contract’s new balance.
The trace elements describe calls to other contracts, transfers to accounts, module upgrades, and whether each of these actions succeeded or not.</p>
<p>A method related to <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> is <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a>, which also executes an entrypoint, but without it being a transaction.</p>
</section>
<section id="invoke-contract-entrypoints">
<h2>Invoke contract entrypoints<a class="headerlink" href="#invoke-contract-entrypoints" title="Link to this heading">#</a></h2>
<p>The method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a> is similar to <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> in that it allows you to execute contract entrypoints.
The difference is that an invoke is <em>not a transaction and is not persisted</em>, so contract states, account balances, etc. remain unchanged after the call.
For seasoned Rust programmers, that is easily seen by its function signature, which takes an immutable reference to the chain (<code class="docutils literal notranslate"><span class="pre">&amp;self</span></code>), as opposed to the mutable reference (<code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">self</span></code>) used in the update method.
The primary purpose of <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a> is to get the return value of an entrypoint.</p>
<p>It has all the same parameters as a contract update, except for the <code class="docutils literal notranslate"><span class="pre">signer</span></code>, which is only needed for transactions.
While the result of the invocation isn’t saved on the chain, all the entities referred, e.g. contracts and accounts, must still exist in the <code class="docutils literal notranslate"><span class="pre">chain</span></code>.</p>
<p>In this example, you get the result of calling the entrypoint called <code class="docutils literal notranslate"><span class="pre">my_view</span></code> with the contract itself as the <code class="docutils literal notranslate"><span class="pre">sender</span></code>.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">my_test</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">// .. Lines omitted for brevity.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span>
<span class="w">        </span><span class="p">.</span><span class="n">contract_invoke</span><span class="p">(</span>
<span class="w">            </span><span class="n">account_address</span><span class="p">,</span>
<span class="w">            </span><span class="n">Address</span><span class="p">::</span><span class="n">Contract</span><span class="p">(</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">),</span>
<span class="w">            </span><span class="n">Energy</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span>
<span class="w">            </span><span class="n">UpdateContractPayload</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="nc">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span>
<span class="w">                </span><span class="n">receive_name</span><span class="p">:</span><span class="w"> </span><span class="nc">OwnedReceiveName</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;my_contract.my_view&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">                </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="nc">OwnedParameter</span><span class="p">::</span><span class="n">empty</span><span class="p">(),</span>
<span class="w">                </span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="nc">Amount</span><span class="p">::</span><span class="n">zero</span><span class="p">(),</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This concludes the introduction to the primary methods on the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html"><code class="docutils literal notranslate"><span class="pre">Chain</span></code></a> type.
Next section covers how to access the common data needed for assertions in smart contract integration tests.</p>
</section>
<section id="data-for-assertions">
<h2>Data for assertions<a class="headerlink" href="#data-for-assertions" title="Link to this heading">#</a></h2>
<p>This section covers how to get the data most commonly used for assertions in smart contract integration tests.</p>
<section id="return-values">
<h3>Return values<a class="headerlink" href="#return-values" title="Link to this heading">#</a></h3>
<p>Both <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> and <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a> have return values when they succeed, or if they fail in a specific way.
On success, you can access the return value directly, for example <code class="docutils literal notranslate"><span class="pre">update.return_value</span></code>, which is a byte array, <code class="docutils literal notranslate"><span class="pre">Vec&lt;u8&gt;</span></code>.
But the methods can fail in multiple ways, for example if the contract runs out of energy or it panics, and the return value is only available when the contract rejects on its own.
The helper method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeError.html#method.return_value"><code class="docutils literal notranslate"><span class="pre">return_value</span></code></a> on the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeError.html"><code class="docutils literal notranslate"><span class="pre">ContractInvokeError</span></code></a> struct tries to extract the return value and returns an <code class="docutils literal notranslate"><span class="pre">Option&lt;Vec&lt;u8&gt;&gt;</span></code>.
It is common to deserialize the return values into structered data and thus both the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeSuccess.html#method.parse_return_value">success</a> and <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeError.html#method.parse_return_value">error</a> types have helper methods called <code class="docutils literal notranslate"><span class="pre">parse_return_value</span></code>, which returns a <code class="docutils literal notranslate"><span class="pre">Result&lt;T,</span> <span class="pre">ParseError&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">T</span></code> is the type you want to parse.
For example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="c1">// .. Creation of accounts and contracts omitted for brevity.</span>

<span class="c1">// On success:</span>
<span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="o">..</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">returned_string</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">.</span><span class="n">parse_return_value</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">returned_string</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;My expected string&quot;</span><span class="p">);</span>

<span class="c1">// On error:</span>
<span class="kd">let</span><span class="w"> </span><span class="n">update_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="o">..</span><span class="p">).</span><span class="n">unwrap_err</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">returned_contract_error</span><span class="p">:</span><span class="w"> </span><span class="nc">MyContractError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_error</span><span class="p">.</span><span class="n">parse_return_value</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">returned_contract_error</span><span class="p">,</span><span class="w"> </span><span class="n">MyContractError</span><span class="p">::</span><span class="n">NotOwner</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="balances">
<h3>Balances<a class="headerlink" href="#balances" title="Link to this heading">#</a></h3>
<p>You can query the balance of accounts and contracts with the <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html"><code class="docutils literal notranslate"><span class="pre">Chain</span></code></a>.
Since accounts can stake part of their balance and also receive transfers with a schedule, their balance has three parts.</p>
<ul class="simple">
<li><p>The total balance, part of which might be staked or locked.</p></li>
<li><p>The staked amount of CCD.</p></li>
<li><p>The locked amount which is unreleased, but can be used for staking.</p></li>
</ul>
<p>The method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.account_balance"><code class="docutils literal notranslate"><span class="pre">account_balance</span></code></a> returns all three elements, and the method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.account_balance_available"><code class="docutils literal notranslate"><span class="pre">account_balance_available</span></code></a> returns only the amount of CCD available for making transactions and transfers, i.e. the part which isn’t staked and/or locked.</p>
<p>Contracts only have one balance which you can query with <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_balance"><code class="docutils literal notranslate"><span class="pre">contract_balance</span></code></a>.</p>
<p>All the balance methods return an <code class="docutils literal notranslate"><span class="pre">Option</span></code> as the account or contract might not exist.</p>
<p>Example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="c1">// .. Creation of accounts and contracts omitted for brevity.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">account_balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">account_balance_available</span><span class="p">(</span><span class="n">account_address</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">contract_balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_balance</span><span class="p">(</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">);</span>

<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">account_balance</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Amount</span><span class="p">::</span><span class="n">from_ccd</span><span class="p">(</span><span class="mi">111</span><span class="p">)));</span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">contract_balance</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Amount</span><span class="p">::</span><span class="n">from_ccd</span><span class="p">(</span><span class="mi">22</span><span class="p">)));</span>
</pre></div>
</div>
</section>
<section id="contract-trace-elements">
<h3>Contract trace elements<a class="headerlink" href="#contract-trace-elements" title="Link to this heading">#</a></h3>
<p>The contract trace elements describe the contract calls, transfers to accounts, module upgrades, and the success of these during a <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a>.</p>
<p>The struct returned on success from these calls has an <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeSuccess.html#method.effective_trace_elements"><code class="docutils literal notranslate"><span class="pre">effective_trace_elements</span></code></a> method which returns a list of all the <em>effective</em> elements in the order that they occurred.
To understand what <em>effective</em> refers to, an example is useful:</p>
<ul class="simple">
<li><p>Contract <code class="docutils literal notranslate"><span class="pre">A</span></code> calls contract <code class="docutils literal notranslate"><span class="pre">B</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">B</span></code> then calls contract <code class="docutils literal notranslate"><span class="pre">C</span></code></p></li>
<li><p>Then <code class="docutils literal notranslate"><span class="pre">B</span></code> fails</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">A</span></code> returns successfully</p></li>
</ul>
<p>In this case, the internal call from <code class="docutils literal notranslate"><span class="pre">B</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code> is not <em>effective</em> as it has no effect; the only thing that matters for the outcome is that <code class="docutils literal notranslate"><span class="pre">B</span></code> failed and everything <code class="docutils literal notranslate"><span class="pre">B</span></code> did is rolled back as if it never occurred.
However, in a testing and debugging scenario, it can be useful to see <em>all</em> the calls, effective or not.
To do this, the returned struct has a field called <code class="docutils literal notranslate"><span class="pre">trace_elements</span></code>, which is a list of <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/enum.DebugTraceElement.html"><code class="docutils literal notranslate"><span class="pre">DebugTraceElement</span></code></a>.
Debug trace elements include information about the failed traces, e.g. the call from <code class="docutils literal notranslate"><span class="pre">B</span></code> to <code class="docutils literal notranslate"><span class="pre">C</span></code> in the example above, along with additional information such as the energy used when each element was produced.</p>
<p>Multiple helper methods exist for extracting information from the debug trace elements. To view the effective trace elements grouped per contract address, use the method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeSuccess.html#method.trace_elements"><code class="docutils literal notranslate"><span class="pre">trace_elements</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="c1">// .. Creation of accounts and contracts omitted for brevity.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="o">..</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">elements_per_contract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">.</span><span class="n">trace_elements</span><span class="p">();</span>

<span class="c1">// No events occured for contract &lt;123, 0&gt;.</span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">elements_per_contract</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ContractAddress</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="mi">0</span><span class="p">))),</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span>
<span class="c1">// Check that the contract was updated.</span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">elements_per_contract</span><span class="p">[</span><span class="o">&amp;</span><span class="n">initialization</span><span class="p">.</span><span class="n">contract_address</span><span class="p">],</span><span class="w"> </span><span class="p">[</span>
<span class="w">     </span><span class="n">ContractTraceElement</span><span class="p">::</span><span class="n">Updated</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="nc">InstanceUpdatedEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="n">address</span><span class="p">:</span><span class="w">          </span><span class="nc">contract_address</span><span class="p">,</span>
<span class="w">             </span><span class="n">amount</span><span class="p">:</span><span class="w">           </span><span class="nc">Amount</span><span class="p">::</span><span class="n">zero</span><span class="p">(),</span>
<span class="w">             </span><span class="n">receive_name</span><span class="p">:</span><span class="w">     </span><span class="nc">OwnedReceiveName</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="s">&quot;my_contract.my_entrypoint&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span>
<span class="w">             </span><span class="n">contract_version</span><span class="p">:</span><span class="w"> </span><span class="nc">concordium_base</span><span class="p">::</span><span class="n">smart_contracts</span><span class="p">::</span><span class="n">WasmVersion</span><span class="p">::</span><span class="n">V1</span><span class="p">,</span>
<span class="w">             </span><span class="n">instigator</span><span class="p">:</span><span class="w">       </span><span class="nc">Address</span><span class="p">::</span><span class="n">Account</span><span class="p">(</span><span class="n">account_address</span><span class="p">),</span>
<span class="w">             </span><span class="n">message</span><span class="p">:</span><span class="w">          </span><span class="nc">OwnedParameter</span><span class="p">::</span><span class="n">empty</span><span class="p">(),</span>
<span class="w">             </span><span class="n">events</span><span class="p">:</span><span class="w">           </span><span class="nb">Vec</span><span class="p">::</span><span class="n">new</span><span class="p">(),</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Writing out all the fields in the trace elements can be cumbersome, so using a <code class="docutils literal notranslate"><span class="pre">matches!</span></code> macro can be beneficial, as it allows you to use the pattern matching syntax for extracting only that parts you need.</p>
<p>This example checks that the correct types of trace elements are there (<code class="docutils literal notranslate"><span class="pre">Interrupted</span></code>, <code class="docutils literal notranslate"><span class="pre">Upgraded</span></code>, <code class="docutils literal notranslate"><span class="pre">Resumed</span></code>, <code class="docutils literal notranslate"><span class="pre">Updated</span></code>), and that the module references of the upgrade are correct.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="fm">assert!</span><span class="p">(</span><span class="fm">matches!</span><span class="p">(</span><span class="n">update</span><span class="p">.</span><span class="n">trace_elements</span><span class="p">[</span><span class="o">..</span><span class="p">],</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="n">ContractTraceElement</span><span class="p">::</span><span class="n">Interrupted</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">ContractTraceElement</span><span class="p">::</span><span class="n">Upgraded</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">ContractTraceElement</span><span class="p">::</span><span class="n">Resumed</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">ContractTraceElement</span><span class="p">::</span><span class="n">Updated</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">old_module_reference</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">new_module_reference</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="transfers-to-accounts">
<h3>Transfers to accounts<a class="headerlink" href="#transfers-to-accounts" title="Link to this heading">#</a></h3>
<p>One of the trace elements from the previous section, <code class="docutils literal notranslate"><span class="pre">Transferred</span></code>, describes a transfer from an contract to an account.
With the helper method <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.ContractInvokeSuccess.html#method.account_transfers"><code class="docutils literal notranslate"><span class="pre">account_transfers</span></code></a>, you can get an iterator over all transfers to accounts in the order that they occured in a single call of <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_update"><code class="docutils literal notranslate"><span class="pre">contract_update</span></code></a> or <a class="reference external" href="https://docs.rs/concordium-smart-contract-testing/latest/concordium_smart_contract_testing/struct.Chain.html#method.contract_invoke"><code class="docutils literal notranslate"><span class="pre">contract_invoke</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Chain</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="c1">// .. Creation of accounts and contracts omitted for brevity.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">contract_update</span><span class="p">(</span><span class="o">..</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// Collect the iterator into a vector.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">account_transfers</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Transfer</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">.</span><span class="n">account_transfers</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span>

<span class="c1">// Check that a single transfer of 10 CCD occurred.</span>
<span class="fm">assert_eq!</span><span class="p">(</span>
<span class="w">    </span><span class="n">account_transfers</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">Transfer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">from</span><span class="p">:</span><span class="w"> </span><span class="nc">ContractAddress</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="nc">Amount</span><span class="p">::</span><span class="n">from_ccd</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">    </span><span class="n">to</span><span class="p">:</span><span class="w"> </span><span class="nc">AccountAddress</span><span class="p">([</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="mi">32</span><span class="p">]),</span>
<span class="p">}]);</span>
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><style>
  legend {
    font-size: 12px;
    font-weight:bold ;
  }

  label {
    font-size: 12px;
  }
</style>

<fieldset>
  <legend>Was this article helpful?</legend>
  <input type="radio" id="Yes" name="rating" value="Yes" onclick="_paq.push(['trackEvent', 'Rating', 'ClickYes', 'Yes']);">
  <label for="Yes">Yes</label>
  <input type="radio" id="No" name="rating" value="No" onclick="_paq.push(['trackEvent', 'Rating', 'ClickNo', 'No']);">
  <label for="No">No</label>
</fieldset>

<!-- Matomo Tag Manager -->
<script>
  var _mtm = window._mtm = window._mtm || [];
  _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
  (function() {
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='https://cdn.matomo.cloud/concordium.matomo.cloud/container_8ZIoCz8b.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Tag Manager --></div>
  
</div>
                </footer>
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="unit-test-contract.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Unit testing</p>
      </div>
    </a>
    <a class="right-next"
       href="deploy-module.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deploy a smart contract module</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-chain">Creating a chain</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-accounts">Creating accounts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deploy-modules">Deploy modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-contracts">Initialize contracts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-contract-entrypoints">Update contract entrypoints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#invoke-contract-entrypoints">Invoke contract entrypoints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-for-assertions">Data for assertions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#return-values">Return values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#balances">Balances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contract-trace-elements">Contract trace elements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transfers-to-accounts">Transfers to accounts</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/Concordium/concordium.github.io/edit/main/source/mainnet/docs/smart-contracts/guides/integration-test-contract.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  

  <p class="copyright">
    
      © Copyright 2021 - 2025, Concordium Software ApS.
      <br/>
    
  </p>

  <style>
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }

    .cc a {
      display: inline-block;
      text-align: left;
      padding-left: 16px;
      padding-bottom: 8px;
      color: black;
      font-size: 8px;
    }
</style>

<div class="cc">
  <a text-decoration=none href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img src="../../../_static/cc-sa-by.png" />
  </a>
  <a text-decoration=none href="../../../net/guides/legal.html" >
    Legal information
  </a>
</div>
  <div id="cookie-consent" class="consent">
    <p>This website only aggregates and analyzes the actions you take here if you allow cookies. If you do not allow cookies, it protects your privacy, but also prevents the owner from learning from your actions and creating a better experience for you and other users.</p><p>Note that if you opt in and you clear your cookies, delete the opt-in cookie, or if you change computers or Web browsers, you will need to perform the opt-in procedure again.</p>
    <button onclick="consentGranted()">Allow</button>
    <button onclick="consentDenied()">Decline</button>
    <a href="https://concordium.com/privacy-policy/">Privacy policy</a>
</div>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];

// Save the choice in a cookie
function storeChoice(granted) {
  document.cookie = "cookie-consent=" + granted
}

// Look for a cookie storing the previous choice of the user.
// Returns undefined if no choice was stored, otherwise a boolean for whether the
// user gave consent.
function loadChoice() {
  if (!document.cookie.includes("cookie-consent=")) {
      return undefined;
  }
  return document.cookie.includes("cookie-consent=true")
}

// Removes the cookie consent banner
function removeCookieConsentBanner() {
  document.getElementById("cookie-consent").remove()
}

// Called by the cookie consent banner if granted permission
function consentGranted() {
  storeChoice(true)
  _paq.push(['setCookieConsentGiven']);
  removeCookieConsentBanner()
}

// Called by the cookie consent banner if denied permission
function consentDenied() {
  storeChoice(true)
  removeCookieConsentBanner()
}

const stored = loadChoice();
if (stored) {
 consentGranted()
}

_paq.push(['requireCookieConsent']);
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);

(function() {
    var u="https://concordium.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/concordium.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();

  // remember tracking consent was given for all subsequent page views and visits
_paq.push(['rememberCookieConsentGiven']);

</script>


<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/4771748.js"></script>
<!-- End of HubSpot Embed Code -->

  </body>
</html>
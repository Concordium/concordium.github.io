


<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Migrate contracts for concordium-std 8.1 &#8212; Concordium  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=53c713d1" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/tippy.css?v=6175c28d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=716d1818"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script defer="defer" src="https://unpkg.com/@popperjs/core@2"></script>
    <script defer="defer" src="https://unpkg.com/tippy.js@6"></script>
    <script defer="defer" src="../../_static/tippy/smart-contracts/guides/migrate-contracts.6eae4899-b417-4b15-9083-f43904054b3e.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'smart-contracts/guides/migrate-contracts';</script>
    <link rel="icon" href="../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item"><style>
.navbar-brand img {
    max-height: 200px;
    width: auto;
}
</style>

<div>
    <a href="https://developer.concordium.software/">
        <img class="logo" src="../../_static/concordium-logo-dark.svg" />
    </a>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/index.html">
                        Docs
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tools/index.html">
                        Tools
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/concordium" title="Medium" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-medium fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Medium</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://academy.concordium.software/ccd-academy/getting-started" title="Academy" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-graduation-cap fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Academy</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/index.html">
                        Docs
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tools/index.html">
                        Tools
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-youtube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/concordium" title="Medium" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-medium fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Medium</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://academy.concordium.software/ccd-academy/getting-started" title="Academy" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-graduation-cap fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Academy</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Migrate contracts for <code class="docutils literal notranslate"><span class="pre">concordium-std</span></code> 8.1</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Migrate...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="migrate-contracts-for-concordium-std-8-1">
<span id="migrate-contracts-for-std-8-1"></span><h1>Migrate contracts for <code class="docutils literal notranslate"><span class="pre">concordium-std</span></code> 8.1<a class="headerlink" href="#migrate-contracts-for-concordium-std-8-1" title="Link to this heading">#</a></h1>
<p>With the <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std"><code class="docutils literal notranslate"><span class="pre">concordium_std</span></code></a> version <code class="docutils literal notranslate"><span class="pre">8.1</span></code> release, writing and reading smart contracts is easier than ever before.
The new version of the standard library reduces the need for generics and traits in your init and receive methods.
These generics and traits were there to support testing with the <a class="reference external" href="https://docs.rs/concordium-std/8.1/concordium_std/test_infrastructure"><code class="docutils literal notranslate"><span class="pre">test_infrastructure</span></code></a>, which has been deprecated in favor of the <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_smart-contract-testing"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a> library.</p>
<p>This guide shows you how to migrate your contract code to use the simpler concrete types and use fewer generics.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should only migrate your contract code if you are also ready to migrate all your tests, that invoke init or receive methods directly, to use the <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_smart-contract-testing"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a> library.</p>
</div>
<section id="migrating-init-methods">
<h2>Migrating <code class="docutils literal notranslate"><span class="pre">init</span></code> methods<a class="headerlink" href="#migrating-init-methods" title="Link to this heading">#</a></h2>
<p>To migrate a typical <code class="docutils literal notranslate"><span class="pre">init</span></code> method you must change the following:</p>
<ul class="simple">
<li><p>Remove the generic parameter <code class="docutils literal notranslate"><span class="pre">&lt;S:</span> <span class="pre">HasStateApi&gt;</span></code> on the init method</p></li>
<li><p>Replace the trait <code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasInitContext</span></code> with the concrete type <code class="docutils literal notranslate"><span class="pre">&amp;InitContext</span></code></p></li>
<li><p>Remove the generic parameter <code class="docutils literal notranslate"><span class="pre">&lt;S&gt;</span></code> on the <code class="docutils literal notranslate"><span class="pre">StateBuilder</span></code></p></li>
</ul>
<p>Here is an example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="sd">/// Before</span>
<span class="cp">#[init(contract = </span><span class="s">&quot;contract_before&quot;</span><span class="cp">)]</span>
<span class="k">fn</span> <span class="nf">init_before</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasInitContext</span><span class="p">,</span>
<span class="w">    </span><span class="n">state_builder</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StateBuilder</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">InitResult</span><span class="o">&lt;</span><span class="n">State</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>

<span class="sd">/// After</span>
<span class="cp">#[init(contract = </span><span class="s">&quot;contract_after&quot;</span><span class="cp">)]</span>
<span class="hll"><span class="k">fn</span> <span class="nf">init_after</span><span class="p">(</span><span class="w">                        </span><span class="c1">// `&lt;S: HasStateApi&gt;` removed</span>
</span><span class="hll"><span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">InitContext</span><span class="p">,</span><span class="w">                </span><span class="c1">// `impl` and `Has` removed</span>
</span><span class="hll"><span class="w">    </span><span class="n">state_builder</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StateBuilder</span><span class="p">,</span><span class="w"> </span><span class="c1">// `&lt;S&gt;` removed</span>
</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">InitResult</span><span class="o">&lt;</span><span class="n">State</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="migrating-receive-methods">
<h2>Migrating <code class="docutils literal notranslate"><span class="pre">receive</span></code> methods<a class="headerlink" href="#migrating-receive-methods" title="Link to this heading">#</a></h2>
<p>To migrate a typical <code class="docutils literal notranslate"><span class="pre">receive</span></code> method you must change the following:</p>
<ul class="simple">
<li><p>Remove the generic parameter <code class="docutils literal notranslate"><span class="pre">&lt;S:</span> <span class="pre">HasStateApi&gt;</span></code> on the receive method</p></li>
<li><p>Replace the trait <code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasReceiveContext</span></code> with the concrete type <code class="docutils literal notranslate"><span class="pre">&amp;ReceiveContext</span></code></p></li>
<li><p>Replace the trait <code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasHost&lt;..&gt;</span></code> with the concrete type <code class="docutils literal notranslate"><span class="pre">&amp;Host</span></code></p></li>
<li><p>Remove the generic parameter <code class="docutils literal notranslate"><span class="pre">StateApiType</span> <span class="pre">=</span> <span class="pre">S</span></code> on the <code class="docutils literal notranslate"><span class="pre">Host</span></code></p></li>
</ul>
<p>Here is an example:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="sd">/// Before</span>
<span class="cp">#[receive(contract = </span><span class="s">&quot;my_contract&quot;</span><span class="cp">, name = </span><span class="s">&quot;my_receive&quot;</span><span class="cp">)]</span>
<span class="k">fn</span> <span class="nf">receive_before</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasReceiveContext</span><span class="p">,</span>
<span class="w">    </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasHost</span><span class="o">&lt;</span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">StateApiType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ReceiveResult</span><span class="o">&lt;</span><span class="n">MyReturnValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>

<span class="sd">/// After</span>
<span class="cp">#[receive(contract = </span><span class="s">&quot;my_contract&quot;</span><span class="cp">, name = </span><span class="s">&quot;my_receive&quot;</span><span class="cp">)]</span>
<span class="hll"><span class="k">fn</span> <span class="nf">receive_after</span><span class="p">(</span><span class="w">           </span><span class="c1">// `&lt;S: HasStateApi&gt;` removed</span>
</span><span class="hll"><span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">ReceiveContext</span><span class="p">,</span><span class="w">   </span><span class="c1">// `impl` and `Has` removed</span>
</span><span class="hll"><span class="w">    </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="nc">Host</span><span class="o">&lt;</span><span class="n">State</span><span class="o">&gt;</span><span class="p">,</span><span class="w">     </span><span class="c1">// `impl Has` and `, StateApiType = S removed</span>
</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ReceiveResult</span><span class="o">&lt;</span><span class="n">MyReturnValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">todo!</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="migrating-advanced-state-types">
<h2>Migrating advanced state types<a class="headerlink" href="#migrating-advanced-state-types" title="Link to this heading">#</a></h2>
<p>If your contract state directly, or indirectly, contains one or more advanced state types, i.e., <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/struct.StateMap.html"><code class="docutils literal notranslate"><span class="pre">StateMap</span></code></a>, <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/struct.StateSet.html"><code class="docutils literal notranslate"><span class="pre">StateSet</span></code></a>, or <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/struct.StateBox.html"><code class="docutils literal notranslate"><span class="pre">StateBox</span></code></a>, then you also need to make a small adjustment.
The advanced state types are generic over not only the types stored, such as the keys and values in a map but also over a type that implements the <a class="reference external" href="https://docs.rs/concordium-std/8.0.0/concordium_std/trait.HasStateApi.html"><code class="docutils literal notranslate"><span class="pre">HasStateApi</span></code></a> trait.
This is because the deprecated <a class="reference external" href="https://docs.rs/concordium-std/8.1/concordium_std/test_infrastructure"><code class="docutils literal notranslate"><span class="pre">test_infrastructure</span></code></a> used a different implementation of the underlying contract state, i.e., a different implementation of <a class="reference external" href="https://docs.rs/concordium-std/8.0.0/concordium_std/trait.HasStateApi.html"><code class="docutils literal notranslate"><span class="pre">HasStateApi</span></code></a>, than the Concordium nodes do.
But <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_smart-contract-testing"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a> uses the exact same state implementation as the nodes do and it is therefore possible to specify the concrete type, <a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/type.StateApi.html"><code class="docutils literal notranslate"><span class="pre">StateApi</span></code></a>, as the default.</p>
<p>Until the <a class="reference external" href="https://docs.rs/concordium-std/8.1/concordium_std/test_infrastructure"><code class="docutils literal notranslate"><span class="pre">test_infrastructure</span></code></a> module is completely removed, the libraries will still support it, and thus the generic parameter <code class="docutils literal notranslate"><span class="pre">S</span></code> must still be present.</p>
<p>To migrate an advanced state type you must change the following:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">StateApi</span></code> as the default type for the generic parameters that must implement <a class="reference external" href="https://docs.rs/concordium-std/8.0.0/concordium_std/trait.HasStateApi.html"><code class="docutils literal notranslate"><span class="pre">HasStateApi</span></code></a> (typically named <code class="docutils literal notranslate"><span class="pre">S</span></code>)</p></li>
<li><p>Remove the generic type parameter for the <a class="reference external" href="https://docs.rs/concordium-std/8.0.0/concordium_std/trait.HasStateApi.html"><code class="docutils literal notranslate"><span class="pre">HasStateApi</span></code></a> type where you use your state type, e.g., <code class="docutils literal notranslate"><span class="pre">MyState</span></code> instead of <code class="docutils literal notranslate"><span class="pre">MyState&lt;S&gt;</span></code></p></li>
</ul>
<p>Here is an example of the change you must make:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="sd">/// Before</span>
<span class="k">struct</span> <span class="nc">MyState</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">my_map</span>: <span class="nc">StateMap</span><span class="o">&lt;</span><span class="n">AccountAddress</span><span class="p">,</span><span class="w"> </span><span class="n">TokenCount</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[init(contract = </span><span class="s">&quot;contract_before&quot;</span><span class="cp">)]</span>
<span class="k">fn</span> <span class="nf">init_before</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nc">HasStateApi</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">HasInitContext</span><span class="p">,</span>
<span class="w">    </span><span class="n">state_builder</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StateBuilder</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">InitResult</span><span class="o">&lt;</span><span class="n">MyState</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">MyState</span><span class="p">{</span><span class="w"> </span><span class="n">my_map</span>: <span class="nc">state_builder</span><span class="p">.</span><span class="n">new_map</span><span class="p">()</span><span class="w"> </span><span class="p">})</span>
<span class="p">}</span>

<span class="sd">/// After</span>
<span class="hll"><span class="k">struct</span> <span class="nc">MyState</span><span class="o">&lt;</span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StateApi</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="n">my_map</span>: <span class="nc">StateMap</span><span class="o">&lt;</span><span class="n">AccountAddress</span><span class="p">,</span><span class="w"> </span><span class="n">TokenCount</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[init(contract = </span><span class="s">&quot;contract_before&quot;</span><span class="cp">)]</span>
<span class="k">fn</span> <span class="nf">init_before</span><span class="p">(</span>
<span class="w">    </span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">InitContext</span><span class="p">,</span>
<span class="w">    </span><span class="n">state_builder</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StateBuilder</span><span class="p">,</span>
<span class="hll"><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">InitResult</span><span class="o">&lt;</span><span class="n">MyState</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">MyState</span><span class="p">{</span><span class="w"> </span><span class="n">my_map</span>: <span class="nc">state_builder</span><span class="p">.</span><span class="n">new_map</span><span class="p">()</span><span class="w"> </span><span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="reference-material-for-migrating-types-and-tests">
<h2>Reference material for migrating types and tests<a class="headerlink" href="#reference-material-for-migrating-types-and-tests" title="Link to this heading">#</a></h2>
<p>The examples above show how to migrate most contracts, but for advanced contracts, there may be more types to migrate.
The list below shows how to achieve that.
It also includes types already described above:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasInitContext</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;InitContext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasReceiveContext</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;ReceiveContext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">StateBuilder&lt;S&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">StateBuilder</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasHost&lt;MyState,</span> <span class="pre">StateApiType</span> <span class="pre">=</span> <span class="pre">S&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;Host&lt;MyState&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">impl</span> <span class="pre">HasHost&lt;MyState,</span> <span class="pre">StateApiType</span> <span class="pre">=</span> <span class="pre">S&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">Host&lt;MyState&gt;</span></code></p></li>
<li><p>When using the <code class="docutils literal notranslate"><span class="pre">low_level</span></code> attribute:</p>
<ul>
<li><p>On inits: <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">impl</span> <span class="pre">HasStateApi</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">StateApi</span></code></p></li>
<li><p>On receives: <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">impl</span> <span class="pre">Host&lt;S&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">LowLevelHost</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">MyState&lt;S&gt;</span> <span class="pre">{</span> <span class="pre">my_map:</span> <span class="pre">StateMap&lt;_,_,</span> <span class="pre">S&gt;</span> <span class="pre">}</span></code> becomes <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">MyState&lt;S</span> <span class="pre">=</span> <span class="pre">StateApi&gt;</span> <span class="pre">{</span> <span class="pre">my_map:</span> <span class="pre">StateMap&lt;_,</span> <span class="pre">_,</span> <span class="pre">S&gt;</span> <span class="pre">}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasCryptoPrimitives</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;CryptoPrimitives</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;impl</span> <span class="pre">HasChainMetadata</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;ChainMetadata</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">impl</span> <span class="pre">HasLogger</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&amp;mut</span> <span class="pre">Logger</span></code></p></li>
</ul>
<p>To migrate your tests, read the how-to guide <a class="reference internal" href="integration-test-contract.html#integration-test-contract"><span class="std std-ref">Integration test a contract in Rust</span></a>.
You can also refer to the <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/pull/347">pull request</a>, where our example contracts were rewritten.
This shows both the removal of generics and how to migrate tests from using <a class="reference external" href="https://docs.rs/concordium-std/8.1/concordium_std/test_infrastructure"><code class="docutils literal notranslate"><span class="pre">test_infrastructure</span></code></a> to <a class="reference external" href="https://docs.rs/concordium-std-derive/latest/concordium_smart-contract-testing"><code class="docutils literal notranslate"><span class="pre">concordium-smart-contract-testing</span></code></a>.</p>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><style>
  legend {
    font-size: 12px;
    font-weight:bold ;
  }

  label {
    font-size: 12px;
  }
</style>

<fieldset>
  <legend>Was this article helpful?</legend>
  <input type="radio" id="Yes" name="rating" value="Yes" onclick="_paq.push(['trackEvent', 'Rating', 'ClickYes', 'Yes']);">
  <label for="Yes">Yes</label>
  <input type="radio" id="No" name="rating" value="No" onclick="_paq.push(['trackEvent', 'Rating', 'ClickNo', 'No']);">
  <label for="No">No</label>
</fieldset>

<!-- Matomo Tag Manager -->
<script>
  var _mtm = window._mtm = window._mtm || [];
  _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
  (function() {
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='https://cdn.matomo.cloud/concordium.matomo.cloud/container_8ZIoCz8b.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Tag Manager --></div>
  
</div>
                </footer>
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#migrating-init-methods">Migrating <code class="docutils literal notranslate"><span class="pre">init</span></code> methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#migrating-receive-methods">Migrating <code class="docutils literal notranslate"><span class="pre">receive</span></code> methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#migrating-advanced-state-types">Migrating advanced state types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reference-material-for-migrating-types-and-tests">Reference material for migrating types and tests</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/Concordium/concordium.github.io/edit/main/source/mainnet/smart-contracts/guides/migrate-contracts.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  

  <p class="copyright">
    
      Â© Copyright 2021 - 2024, Concordium Software ApS.
      <br/>
    
  </p>

  <style>
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }

    .cc a {
      display: inline-block;
      text-align: left;
      padding-left: 16px;
      padding-bottom: 8px;
      color: black;
      font-size: 8px;
    }
</style>

<div class="cc">
  <a text-decoration=none href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img src="../../_static/cc-sa-by.png" />
  </a>
  <a text-decoration=none href="../../net/guides/legal.html" >
    Legal information
  </a>
</div>
  <div id="cookie-consent" class="consent">
    <p>This website only aggregates and analyzes the actions you take here if you allow cookies. If you do not allow cookies, it protects your privacy, but also prevents the owner from learning from your actions and creating a better experience for you and other users.</p><p>Note that if you opt in and you clear your cookies, delete the opt-in cookie, or if you change computers or Web browsers, you will need to perform the opt-in procedure again.</p>
    <button onclick="consentGranted()">Allow</button>
    <button onclick="consentDenied()">Decline</button>
    <a href="https://concordium.com/privacy-policy/">Privacy policy</a>
</div>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];

// Save the choice in a cookie
function storeChoice(granted) {
  document.cookie = "cookie-consent=" + granted
}

// Look for a cookie storing the previous choice of the user.
// Returns undefined if no choice was stored, otherwise a boolean for whether the
// user gave consent.
function loadChoice() {
  if (!document.cookie.includes("cookie-consent=")) {
      return undefined;
  }
  return document.cookie.includes("cookie-consent=true")
}

// Removes the cookie consent banner
function removeCookieConsentBanner() {
  document.getElementById("cookie-consent").remove()
}

// Called by the cookie consent banner if granted permission
function consentGranted() {
  storeChoice(true)
  _paq.push(['setCookieConsentGiven']);
  removeCookieConsentBanner()
}

// Called by the cookie consent banner if denied permission
function consentDenied() {
  storeChoice(true)
  removeCookieConsentBanner()
}

const stored = loadChoice();
if (stored) {
 consentGranted()
}

_paq.push(['requireCookieConsent']);
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);

(function() {
    var u="https://concordium.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/concordium.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();

  // remember tracking consent was given for all subsequent page views and visits
_paq.push(['rememberCookieConsentGiven']);

</script>


<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/4771748.js"></script>
<!-- End of HubSpot Embed Code -->

  </body>
</html>



<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Factory pattern &#8212; Concordium  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=19c83c19" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/tippy.css?v=124524c4" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=716d1818"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script defer="defer" src="https://unpkg.com/@popperjs/core@2"></script>
    <script defer="defer" src="https://unpkg.com/tippy.js@6"></script>
    <script defer="defer" src="../../../_static/tippy/docs/smart-contracts/guides/factory-pattern.3f21ed12-9e9e-494a-9662-c5938cac0b71.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/smart-contracts/guides/factory-pattern';</script>
    <link rel="canonical" href="https://docs.concordium.com/en/mainnet/docs/smart-contracts/guides/factory-pattern.html" />
    <link rel="icon" href="../../../_static/concordium-logo-no-text.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Unit testing" href="unit-test-contract.html" />
    <link rel="prev" title="Migrate contracts for concordium-std 8.1" href="migrate-contracts.html" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">Protocol 8 is now live on mainnet. For more information, visit our <a href="https://docs.concordium.com/en/mainnet/docs/release-notes/release-notes-lp.html#mainnet" target="_blank">release notes page</a>.</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item"><style>
.navbar-brand img {
    max-height: 200px;
    width: auto;
}
</style>

<div>
    <a href="https://developer.concordium.software/">
        <img class="logo light-logo" src="../../../_static/concordium-logo-dark.svg" />
        <img class="logo dark-logo" src="../../../_static/concordium-logo.svg" />
    </a>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../index.html">
    Docs
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/index.html">
    Community
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://discord.com/invite/GpKGE2hCFx" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-youtube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/@concordium" title="Medium" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-medium fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Medium</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../index.html">
    Docs
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/index.html">
    Community
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://github.com/Concordium" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="mailto:support@concordium.software" title="Support" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Support</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://developer.concordium.software/en/mainnet/net/guides/developer-page.html#block-explorers" title="Monitor" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-chart-line fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Monitor</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://support.concordium.software/latest" title="Discourse" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discourse</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://discord.com/invite/GpKGE2hCFx" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.youtube.com/channel/UCPZc2CuB2jGbZjD_5zX7-1A" title="YouTube" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-youtube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">YouTube</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://medium.com/@concordium" title="Medium" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-medium fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Medium</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Concordium Protocol</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../protocol/concordium-protocol.html">What is the Concordium Protocol</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../protocol/identity.html">Identity</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/principles-of-privacy.html">Principles of privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/user-processes.html">User processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/identity-disclosure-processes.html">Identity disclosure processes</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/manage-accounts.html">Accounts</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../protocol/transactions.html">Transactions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/transaction%20lifecycle.html">Transaction lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../protocol/transaction-fees.html">Transaction fees</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/consensus-mechanisms.html">Consensus mechanisms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/concepts-baker.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocol/concepts-delegation.html">Delegation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Smart Contracts</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">QuickStart</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction.html">What is a smart contract?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contract-lifecycle.html">Life cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contract-module.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contract-instances.html">Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contract-schema.html">Contract schemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../develop-contracts.html">Using Rust</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="build-contract.html">Build</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup-contract.html">Set up a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="compile-module.html">Module Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-errors.html">Custom errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-schema.html">Build a contract schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="no-std.html">Using <code class="docutils literal notranslate"><span class="pre">no_std</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="fallback-entrypoints.html">Fallback entrypoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgradeable-contract.html">Upgradeability Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="json-params.html">JSON parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrate-contracts.html">Migrate contracts for <code class="docutils literal notranslate"><span class="pre">concordium-std</span></code> 8.1</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Factory pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-test-contract.html">Unit testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration-test-contract.html">Integration tests</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="deploy-module.html">Deploy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="initialize-contract.html">Initialize</a></li>
<li class="toctree-l2"><a class="reference internal" href="interact-instance.html">Interact</a></li>
<li class="toctree-l2"><a class="reference internal" href="inspect-instance.html">Inspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="invoke-instance.html">Invoke</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../best-practices/index.html">Best practices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../best-practices/development.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../best-practices/costs.html">Cost reduction</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../references/index.html">References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../references/crypto-primitives.html">Cryptographic primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/host-fns.html">Contract host functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/local-settings.html">Local settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/references-on-chain.html">References on-chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/schema-json.html">Schema JSON representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references/simulate-context.html">Simulation contexts</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts">Rust contract examples (repo)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.rs/concordium-std/latest/concordium_std/">concordium-std</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Network</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/baker-pool.html">Validator Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/validation-with-wallets.html">Validation with Concordium wallets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/baker-windows.html">Import validator keys on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/baker-macos.html">Import validator keys on MacOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/baker-ubuntu.html">Import validator keys on Ubuntu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/baker-docker.html">Import validator keys on Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/become-baker.html">Validation with the Concordium Client</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/nodes/node-requirements.html">Run a node on Concordium</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/run-node-ubuntu-testnet.html">Run a node on Ubuntu - Testnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/run-node-ubuntu.html">Run a node on Ubuntu - Mainnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/troubleshoot-ubuntu.html">Troubleshoot a node on Ubuntu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/run-node-macos.html">Run and manage a node on MacOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/troubleshoot-macos.html">Troubleshoot a node on MacOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/run-node-windows.html">Run and manage a node on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/troubleshoot-windows.html">Troubleshoot a node on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/node-runner-service-configuration.html">Concordium Windows node runner service configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/run-node.html">Run a node in Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/troubleshoot-docker.html">Troubleshoot a node in Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/nodes/run-node-aws.html">Run a node on Amazon Web Services (AWS)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/web3-id/index.html">Use Concordium's ID layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/web3-id/issuer.html">Web3 ID issuers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/web3-id/identity-provider-interfaces.html">Wallet identity provider interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../network/guides/create-proofs.html">Create proofs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/guides/run-local-chain.html">Run a local chain</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../network/indexers/intro.html">Indexers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../network/indexers/subquery.html">SubQuery</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Help &amp; FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../installation/downloads.html">Downloads</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation/verification-instructions.html">Verification instructions</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/release-notes-lp.html">Release notes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../guides/wallets-lp.html">Concordium wallets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/wallet-faqs.html">Wallet FAQs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guides/deciding-wallet.html">Deciding between the wallets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/cryptox-faq.html">CryptoX Concordium Wallet FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../browser-wallet/browser-wallet-faq.html">Concordium Wallet for Web FAQ</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/setup-wallets-lp.html">Set up a wallet</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guides/setup-cryptox-wallet.html">Set up the CryptoX Concordium Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../browser-wallet/setup-browser-wallet.html">Set up the Concordium Wallet for Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/overview-desktop.html">Set up the Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/ledger-tutorial.html">Use your Ledger Device with Concordium Desktop Wallet</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/manage-wallets-lp.html">Wallet activities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/create-identity.html">Create an identity</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guides/change-identity-name.html">Change identity name</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/create-account.html">Create an account</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guides/change-account-name.html">Change account name</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/recovery.html">Backup and recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/change-passcode-mw.html">Update your passcode and biometric settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/address-book.html">Manage address book</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/transaction-report.html">Create a transaction report</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/show-seed-phrase.html">Show seed phrase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/show-wallet-private-key.html">Show wallet private key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/import-export-file.html">Import/export file wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/wallet.html">Web3 ID in the Concordium Wallet for Web</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../guides/account-activities-lp.html">Account activities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guides/send-ccd-wallets.html">Send CCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/share-address-mw.html">Find and share your account address</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../browser-wallet/connect-app.html">Connect dApps to wallets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guides/proofs.html">Proofs and revealing information</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/tokens.html">Tokens in the wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/shield-ccd-wallets.html">Unshield CCD on an account</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/scheduled-release.html">Scheduled releases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/single-sign-schedule.html">Transfer CCD with a schedule in Desktop Wallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mobile-wallet/inspect-release-schedule-mw.html">Inspect a release schedule</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/export-account-private-key.html">Export account private key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/export-transaction-logs.html">Export transaction logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/add-baker-mw.html">Add a validator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/update-baker-mw.html">Change validator options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/stop-validator.html">Stop a validator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mobile-wallet/suspend-unsuspend-validator.html">Suspend/Unsuspend a validator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/add-delegation.html">Delegate to a staking pool or passive delegation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/remove-delegation.html">Remove delegation to a staking pool or passive delegation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guides/update-delegation.html">Update delegation to a staking pool or passive delegation</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../desktop-wallet/dw-lp.html">Desktop Wallet</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/single-sign-schedule.html">Transfer CCD with a schedule in Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/transaction-log-filter.html">Apply a transaction log filter in the Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/update-application.html">Update the Desktop Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/accounts-desktop.html">Desktop Wallet navigation and settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../desktop-wallet/reset-data.html">Reset desktop wallet data</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../guides/overview-shared-accounts.html">Shared accounts with multiple credentials in Desktop Wallet</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/create-credentials-file.html">Create a credentials file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guides/multi-credentials.html">Add credentials to an account</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/multisig-simple-transfer.html">Create a multi-signature CCD transfer in the Desktop Wallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guides/multisig-transfer.html">Create a scheduled transfer in the Desktop Wallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/sign-transaction.html">Sign a transaction proposal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../desktop-wallet/proposed-transactions.html">View transaction proposals</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides/cryptox-terms.html">End User License Terms for CryptoX Concordium Wallet</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../help-and-faq/faqs.html">FAQs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/delegation-faq.html">Delegation and validation FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/onboarding-guide-ethereum-developers/faq.html">FAQ for Ethereum developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/onboarding-guide-solana-developers/faq.html">FAQ for Solana developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/onboarding-guide-solana-developers/overview.html">Onboarding for Solana developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/set-up-doc-env-MacOs.html">Set up Concordium documentation environment on MacOs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../help-and-faq/style-guide.html">Concordium documentation style guide</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference external" href="https://proposals.concordium.software/index.html">Concordium Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/glossary.html">Glossary of Concordium terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/exchangeOnBoarding.html">Exchange Onboarding Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Governance Committee Voting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../voting/gc-voting.html">Concordium Governance Committee elections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/coordinator.html">Election coordinator tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/voting.html">How to vote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/guardians.html">Guardians</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voting/verify-election-result.html">Verify election result</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="factory-pattern">
<span id="id1"></span><h1>Factory pattern<a class="headerlink" href="#factory-pattern" title="Link to this heading">#</a></h1>
<p>The factory pattern is a design pattern where one contract (the factory) creates instances of
another contract (the products). This pattern makes sense on Ethereum, where deploying a smart
contract typically means deploying the code and instantiating a contract in a single transaction.
This means that creating a new instance of a smart contract typically means redeploying the code,
even if it is identical to an already-deployed smart contract. This can be undesirable:
redeploying the same code repeatedly wastes resources. The factory pattern provides a
workaround for this: the contract code is deployed once, creating a factory contract, which then
can be invoked to create further (product) contracts.</p>
<p>By contrast, on Concordium, deploying code and instantiating contracts are separate transactions.
In particular, once the code has been deployed, any number of instances can be created without
redeploying the code. This eliminates one of the key motivations for using a factory pattern.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In object-oriented programming languages, the factory pattern is used to abstract over a constructor.
For example, consider some code that needs to create a <cite>DatabaseConnection</cite> object.
The code should work with both a <cite>MySqlDatabaseConnection</cite> and a <cite>SQLiteDatabaseConnection</cite>
(which both implement or subclass <cite>DatabaseConnection</cite>), and perhaps also other database
connections that have not even been defined yet. How should the code know which <cite>DatabaseConnection</cite>
to create?</p>
<p>This is where the factory pattern comes in. In the case of the factory class pattern,
the code is parametrized by a <cite>DatabaseConnectionFactory</cite> object, which provides a
method for constructing <cite>DatabaseConnection</cite> objects. The <cite>DatabaseConnectionFactory</cite>
interface would be implemented by <cite>MySqlDatabaseConnectionFactory</cite> and
<cite>SQLiteDatabaseConnectionFactory</cite> (and potentially others). Which specific database connection
is constructed depends on which factory is provided.</p>
<p>In the factory method pattern, the code resides in an base class that has an abstract method
for constructing <cite>DatabaseConnection</cite> objects. The base class is then subclassed to provide
different implementation of the factory method.</p>
<p>The point of this is that in object-oriented languages, the factory pattern is solving a
particular problem: creating instances of a type that is not fully determined. While it may
be idiomatic in one language, it may not be in another. For instance, in Rust the same code
could be parametrized by a generic type that implements a <cite>DatabaseConnection</cite> trait, which
provides a <cite>new</cite> function for constructing <cite>DatabaseConnection</cite> instances. The particular
type of database connection that is created would depend on how the generic type parameter
is eventually instantiated.</p>
<p>On Concordium, the same problem does not really exist (viewing contract instances as the
analogue of objects). Contract instances are always created by top-level transactions, and
the contract being instantiated is always explicitly determined.</p>
</div>
<p>Another motiviation for using a factory pattern might be for the factory to have some on-going
relationship with the products that it produces. In particular, the factory could maintain an
index of product instances, or ensure that each instance is created distinctly from the others.
It could also play a role in logging events signalling the creation of new products.</p>
<p>The sequence diagram below illustrates an idealized factory pattern.
The user invokes the <code class="docutils literal notranslate"><span class="pre">produce</span></code> endpoint on a <code class="docutils literal notranslate"><span class="pre">Factory</span></code> contract.
The factory constructs a new instance of the <code class="docutils literal notranslate"><span class="pre">product</span></code> smart contract, invoking the
<code class="docutils literal notranslate"><span class="pre">init_product</span></code> constructor.
Finally, a reference to the new product instance is returned.</p>
<img alt="sequence diagram showing the idealized interaction for the factory pattern" src="../../../_images/ideal-factory.svg" />
<p>Unfortunately, implementing a factory pattern on Concordium is complicated by the fact that one
smart contract instance cannot create other smart contract instances programmatically.
On Concordium, every smart contract instance is created by a top-level transaction. To achieve
something resembling the factory pattern, the product instances must first be created in an
uninitialized state, and then the factory must be invoked to initialize them in a separate step.</p>
<p>The sequence diagram below illustrates how the factory pattern is realized on Concordium.
First, the user constructs a new instance of the <code class="docutils literal notranslate"><span class="pre">product</span></code> smart contract, invoking the
<code class="docutils literal notranslate"><span class="pre">init_product</span></code> constructor.
This creates the <code class="docutils literal notranslate"><span class="pre">Product</span></code> contract in a special uninitialized state.
The user then invokes the <code class="docutils literal notranslate"><span class="pre">produce</span></code> endpoint on the <code class="docutils literal notranslate"><span class="pre">Factory</span></code> contract, passing in a reference
to the <code class="docutils literal notranslate"><span class="pre">Product</span></code> contract.
The <code class="docutils literal notranslate"><span class="pre">Factory</span></code> contract in turn calls <code class="docutils literal notranslate"><span class="pre">initialize</span></code> on the <code class="docutils literal notranslate"><span class="pre">Product</span></code> contract, resulting in
the <code class="docutils literal notranslate"><span class="pre">Product</span></code> being fully initialized.</p>
<img alt="sequence diagram showing how the factory pattern might be realised on Concordium" src="../../../_images/concordium-factory.svg" />
<p>This process is significantly more complex than the original idealized factory pattern.
In particular, the user is required to sign two separate transactions, with the second one depending
on the result of the first one. If this two-step process is presented to the end user, it is likely
to cause confusion. Additionally, two-step process means that the smart contracts have to be robust
against misuse. For instance, the factory has to deal with the possibility that <code class="docutils literal notranslate"><span class="pre">produce</span></code> is
called with a reference to the wrong type of product contract.</p>
<section id="alternatives-to-the-factory-pattern">
<h2>Alternatives to the factory pattern<a class="headerlink" href="#alternatives-to-the-factory-pattern" title="Link to this heading">#</a></h2>
<p>Since there are a number of disadvantages to using the factory pattern on Concordium, it is
important to consider whether a better alternative is available. One of the following alternatives
may be suitable, depending on the application.</p>
<section id="construct-the-product-directly">
<h3>Construct the product directly<a class="headerlink" href="#construct-the-product-directly" title="Link to this heading">#</a></h3>
<p>If the factory does not maintain an on-going relationship with the product,
then it is generally possible to simply initialize the product entirely in
the constructor (<code class="docutils literal notranslate"><span class="pre">init_product</span></code>), removing the separate <code class="docutils literal notranslate"><span class="pre">initialize</span></code> operation entirely.
In general, if the factory contract does not need to update its state
when initializing the product, then it serves no purpose. It would be
sufficient for the user to construct the product directly in the same way as the factory
would have.</p>
</section>
<section id="register-the-instance-with-a-contract-registry">
<h3>Register the instance with a contract registry<a class="headerlink" href="#register-the-instance-with-a-contract-registry" title="Link to this heading">#</a></h3>
<p>A factory contract may serve as a registry of its products.
The factory pattern enables this, as the factory is responsible for initializing each product
instance. However, the factory pattern is not in itself necessary for a contract registry.
Instead, instances could be constructed directly (as discussed above) and subsequently registered
with a registry contract, which maintains an index of the instances registered with it.
The registration process could also provide additional initialization information for the contract
being registered (such as the index it is assigned by the registry).</p>
</section>
<section id="use-a-monolithic-contract">
<h3>Use a monolithic contract<a class="headerlink" href="#use-a-monolithic-contract" title="Link to this heading">#</a></h3>
<p>Instead of having separate contract instances for the factory and each product, all of these
could be combined in a single monolithic contract. In this model, each product is assigned a
virtual address, and the contract maintains a mapping from virtual addresses to the state of
each product.</p>
<p>For instance, a CIS2 contract can manage multiple NFTs that each have distinct token IDs.
Rather than each NFT being its own contract instance (created by a factory), they are simply
handled as part of the state of the overall CIS2 contract. Here, the token ID acts as a
virtual address.</p>
<p>The main disadvantage of this approach is that the isolation between the states of each product
must be enforced by the contract itself. If the state becomes corrupted (due to a bug in the
contract) then all of the encapsulated products can potentially be affected. With the factory
pattern, the runtime system of the blockchain enforces isolation. As always, the balance of risks
should be considered when choosing the approach for any application.</p>
</section>
</section>
<section id="implementing-the-factory-pattern">
<h2>Implementing the factory pattern<a class="headerlink" href="#implementing-the-factory-pattern" title="Link to this heading">#</a></h2>
<p>The guide below is based on the <a class="reference external" href="https://github.com/Concordium/concordium-rust-smart-contracts/blob/main/examples/factory/src/lib.rs">factory contract example</a>,
taking illustrative code snippets. Please refer to the example for the full context of these snippets.</p>
<section id="the-factory-contract">
<h3>The <code class="docutils literal notranslate"><span class="pre">factory</span></code> contract<a class="headerlink" href="#the-factory-contract" title="Link to this heading">#</a></h3>
<p>For the purposes of this example, the factory contract assigns each new product a unique (sequential)
index. It also retains a map of all of the products that it has previously produced.
The state of the factory contract is represented by the following Rust struct:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FactoryState</span><span class="o">&lt;</span><span class="n">S</span><span class="p">:</span><span class="w"> </span><span class="nc">HasStateApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StateApi</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// The index that will be assigned to the next product contract.</span>
<span class="w">    </span><span class="n">next_product</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// Index of the product smart contract instances.</span>
<span class="w">    </span><span class="n">products</span><span class="p">:</span><span class="w">     </span><span class="nc">StateMap</span><span class="o">&lt;</span><span class="kt">u64</span><span class="p">,</span><span class="w"> </span><span class="n">ContractAddress</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="the-produce-endpoint">
<h4>The <code class="docutils literal notranslate"><span class="pre">produce</span></code> endpoint<a class="headerlink" href="#the-produce-endpoint" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">produce</span></code> method of the factory expects one parameter that is the address of an uninitialized
instance of the <code class="docutils literal notranslate"><span class="pre">product</span></code> contract. First, the parameter is read from the context:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">product_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">parameter_cursor</span><span class="p">().</span><span class="n">get</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</pre></div>
</div>
<p>The factory needs to be sure that the address actually refers to an instance of the <code class="docutils literal notranslate"><span class="pre">product</span></code>
contract, in order to ensure correct behavior. This can be achieved by checking the module reference
and contract name against expected values. Together, the module reference and contract name uniquely
identify the code of the smart contract instance.</p>
<p>Getting the module reference and contract name is done using the host functions
<code class="docutils literal notranslate"><span class="pre">contract_module_reference</span></code> and <code class="docutils literal notranslate"><span class="pre">contract_name</span></code>, respectively. <strong>Note: both of these functions</strong>
<strong>are introduced in protocol version 7, and will not work while the chain is running an earlier</strong>
<strong>protocol version.</strong></p>
<p>In this example, the factory and product contracts are defined in the same module.
Thus, to check that the module reference of the product is correct, it is sufficient to check that
it is the same as the module reference of the factory, as follows:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// We can depend upon getting the module reference for our own contract.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">self_module_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">contract_module_reference</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">self_address</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="c1">// Check the product module is the same as our own module.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">product_module_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span>
<span class="w">    </span><span class="p">.</span><span class="n">contract_module_reference</span><span class="p">(</span><span class="n">product_address</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">or</span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="n">FactoryError</span><span class="p">::</span><span class="n">NonExistentProduct</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<span class="n">ensure_eq</span><span class="o">!</span><span class="p">(</span><span class="n">self_module_ref</span><span class="p">,</span><span class="w"> </span><span class="n">product_module_ref</span><span class="p">,</span><span class="w"> </span><span class="n">FactoryError</span><span class="p">::</span><span class="n">InvalidProduct</span><span class="p">);</span>
</pre></div>
</div>
<p>If the product were instead defined in a different module from the factory, then the expected
module reference for the product could be hard-coded into the factory. Alternatively, if the
module rereference for the product is to be determined later, it could be passed as a parameter
when creating the <code class="docutils literal notranslate"><span class="pre">factory</span></code> instance.</p>
<p>If the module defining the product is known to only contain one smart contract, then checking the
module reference is sufficient for identifying the code of the product smart contract. In the example smart contract,
however, both the factory and product contracts are defined in the same module, so it is also necessary
to check the contract name. This is achieved as follows:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">host</span><span class="p">.</span><span class="n">contract_name</span><span class="p">(</span><span class="n">product_address</span><span class="p">).</span><span class="n">or</span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="n">FactoryError</span><span class="p">::</span><span class="n">NonExistentProduct</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<span class="n">ensure_eq</span><span class="o">!</span><span class="p">(</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">PRODUCT_INIT_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">FactoryError</span><span class="p">::</span><span class="n">InvalidProduct</span><span class="p">);</span>
</pre></div>
</div>
<p>Now the contract is known to be an instance of <code class="docutils literal notranslate"><span class="pre">product</span></code>, the next step is to update the state of
the factory contract:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">state_mut</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">next_product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">next_product</span><span class="p">;</span>
<span class="n">state</span><span class="p">.</span><span class="n">next_product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_product</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">state</span><span class="p">.</span><span class="n">products</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">next_product</span><span class="p">,</span><span class="w"> </span><span class="n">product_address</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, it remains to invoke <code class="docutils literal notranslate"><span class="pre">initialize</span></code> on the product.
In this example, <code class="docutils literal notranslate"><span class="pre">initialize</span></code> takes a parameter that is the index assigned to
it, which will be the old value of <code class="docutils literal notranslate"><span class="pre">next_product</span></code> in the state.</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="p">.</span><span class="n">invoke_contract</span><span class="p">(</span>
<span class="w">    </span><span class="o">&amp;</span><span class="n">product_address</span><span class="p">,</span>
<span class="w">    </span><span class="o">&amp;</span><span class="n">next_product</span><span class="p">,</span>
<span class="w">    </span><span class="n">EntrypointName</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="n">PRODUCT_INITIALIZE_ENTRYPOINT</span><span class="p">),</span>
<span class="w">    </span><span class="n">Amount</span><span class="p">::</span><span class="n">zero</span><span class="p">(),</span>
<span class="p">)</span>
<span class="p">.</span><span class="n">or</span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="n">FactoryError</span><span class="p">::</span><span class="n">InitializeFailed</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, it is assumed that <code class="docutils literal notranslate"><span class="pre">initialize</span></code> will fail, for instance, if it is called on a product that
has previously been initialized.</p>
</section>
</section>
<section id="the-product-contract">
<h3>The <code class="docutils literal notranslate"><span class="pre">product</span></code> contract<a class="headerlink" href="#the-product-contract" title="Link to this heading">#</a></h3>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">product</span></code> contract tracks the address of the factory that produced it and
the index assigned to it when it was produced. This is represented by the following struct:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// The factory that created the product.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">factory</span><span class="p">:</span><span class="w"> </span><span class="nc">ContractAddress</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// The index given to the product by the factory.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">index</span><span class="p">:</span><span class="w">   </span><span class="kt">u64</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note, however, that this state information does not exist when the product is first created as
uninitialized. The full state of the product is thus represented as follows:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">ProductState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// The product has not yet been initialized by the factory.</span>
<span class="w">    </span><span class="n">Uninitialized</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// The product has been initialised by the factory.</span>
<span class="w">    </span><span class="n">Initialized</span><span class="p">(</span><span class="n">Product</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">init</span></code> function for the product will simply create a new product in the <code class="docutils literal notranslate"><span class="pre">Uninitialized</span></code>
state:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[init(contract = </span><span class="s">&quot;product&quot;</span><span class="cp">)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">_ctx</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">InitContext</span><span class="p">,</span><span class="w"> </span><span class="n">_state_builder</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StateBuilder</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">InitResult</span><span class="o">&lt;</span><span class="n">ProductState</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">ProductState</span><span class="p">::</span><span class="n">Uninitialized</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="the-initialize-endpoint">
<h4>The <code class="docutils literal notranslate"><span class="pre">initialize</span></code> endpoint<a class="headerlink" href="#the-initialize-endpoint" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method of the product first checks that the product has not already been
initialized:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">state_mut</span><span class="p">();</span>
<span class="n">ensure_eq</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">ProductState</span><span class="p">::</span><span class="n">Uninitialized</span><span class="p">,</span><span class="w"> </span><span class="n">ProductError</span><span class="p">::</span><span class="n">AlreadyInitialized</span><span class="p">);</span>
</pre></div>
</div>
<p>Since the construction and initialization of the product occur in two
separate transactions, it is possible that a third party might try to hijack
the process by inserting their own transaction to initialize the product.
For instance, an adversary could invoke a different factory instance than intended by the user,
as illustrated in the following sequence diagram:</p>
<img alt="sequence diagram showing how a third party might hijack a product" src="../../../_images/factory-adversary.svg" />
<p>To prevent this possibility, the product checks in its <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method that the invoker of the
transaction (i.e., the account that originated the transaction as a whole) is the same account as
created the product contract instance (i.e., the “owner”):</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="n">ensure_eq</span><span class="o">!</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">invoker</span><span class="p">(),</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">owner</span><span class="p">(),</span><span class="w"> </span><span class="n">ProductError</span><span class="p">::</span><span class="n">NotAuthorized</span><span class="p">);</span>
</pre></div>
</div>
<p>With this check, the attack described above would result in failure for Adversary (because
the invoker Adversary does not match the owner User), but success for User:</p>
<img alt="sequence diagram showing how a hijacking attempt fails" src="../../../_images/factory-adversary2.svg" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Typically, it is wrong to use the invoker of a transaction for
authorization, rather than the immediate caller. For instance, a user might
invoke some untrusted smart contract, and expect it is not authorized to
transfer tokens they hold on another contract. If the token-holding contract
used the invoker for authorization, then the untrusted contract could
transfer the tokens. In the case of the factory pattern, however, the
authorization is for a one-time use (initializing the product contract)
and should occur immediately after the product is created. An adversary
would have to convince a user to sign a malicious transaction in between the
construction and (intended) initialization transactions in order to hijack
the product contract, as shown in the following sequence diagram:</p>
<img alt="sequence diagram showing how a hijacking attempt may succeed if the user is deceived into signing a bad transaction" src="../../../_images/factory-tricked.svg" />
<p>Hopefully, this is unlikely. Moreover, the effect of
such a hijacking should typically be that the product cannot be used as the
user intended, but the user would still be able to create another product
and have the factory produce that correctly.</p>
</div>
<p>At this point, it just remains to initialize the state of the product:</p>
<div class="highlight-Rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// The index is supplied as a parameter by the factory.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">parameter_cursor</span><span class="p">().</span><span class="n">get</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
<span class="c1">// This endpoint should only be called by another smart contract, namely the</span>
<span class="c1">// factory, which we record in the state.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">sender</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Address</span><span class="p">::</span><span class="n">Contract</span><span class="p">(</span><span class="n">ca</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ca</span><span class="p">,</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">ProductError</span><span class="p">::</span><span class="n">SenderIsAccountAddress</span><span class="p">)</span><span class="o">?</span><span class="p">,</span>
<span class="p">};</span>
<span class="c1">// Initialize the state.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">,</span>
<span class="w">    </span><span class="n">factory</span><span class="p">,</span>
<span class="p">};</span>
<span class="o">*</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProductState</span><span class="p">::</span><span class="n">Initialized</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a user invokes <code class="docutils literal notranslate"><span class="pre">initialize</span></code> directly (rather than through a factory contract) it will fail.
This is because <code class="docutils literal notranslate"><span class="pre">initialize</span></code> checks that the immediate caller is a smart contract, and
records the contract address in the state. The fact that this prevents a user from directly
invoking <code class="docutils literal notranslate"><span class="pre">initialize</span></code> is incidental. The design intent is not to prevent the user from
initializing products badly (which they could also do by invoking a “BadFactory” as previously
noted). The intent is that products that are produced by the factory are produced correctly.</p>
</div>
</section>
</section>
</section>
<section id="security-considerations">
<span id="id2"></span><h2>Security considerations<a class="headerlink" href="#security-considerations" title="Link to this heading">#</a></h2>
<p>The security model for the factory pattern presented here relies on the fact that none of the initialization of
the product occurs in the constructor of the product (the <code class="docutils literal notranslate"><span class="pre">init</span></code> method),
but instead is handled by the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> endpoint that is called by the
factory. In particular, if any funds or authorization are granted to the
product before <cite>initialize</cite> is called, then the consequences and risk of
hijacking are more sever. Thus, to adhere to the factory pattern, the
product contract must:</p>
<ol class="arabic simple">
<li><p>Always be constructed in an uninitialized state, with no balance, authority, or any other state.</p></li>
<li><p>Only permit the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> update operation while it is in the uninitialized state.</p></li>
<li><p>On a successful call of <code class="docutils literal notranslate"><span class="pre">initialize</span></code>, transition from the uninitialized state to an initialized state.</p></li>
<li><p>Never transition back to the uninitialized state.</p></li>
</ol>
<p>It is important to always consider the risks presented by malicious third
parties and to evaluate if any given solution is appropriate to the
application at hand.</p>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><style>
  legend {
    font-size: 12px;
    font-weight:bold ;
  }

  label {
    font-size: 12px;
  }
</style>

<fieldset>
  <legend>Was this article helpful?</legend>
  <input type="radio" id="Yes" name="rating" value="Yes" onclick="_paq.push(['trackEvent', 'Rating', 'ClickYes', 'Yes']);">
  <label for="Yes">Yes</label>
  <input type="radio" id="No" name="rating" value="No" onclick="_paq.push(['trackEvent', 'Rating', 'ClickNo', 'No']);">
  <label for="No">No</label>
</fieldset>

<!-- Matomo Tag Manager -->
<script>
  var _mtm = window._mtm = window._mtm || [];
  _mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});
  (function() {
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='https://cdn.matomo.cloud/concordium.matomo.cloud/container_8ZIoCz8b.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Tag Manager --></div>
  
</div>
                </footer>
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="migrate-contracts.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Migrate contracts for <code class="docutils literal notranslate"><span class="pre">concordium-std</span></code> 8.1</p>
      </div>
    </a>
    <a class="right-next"
       href="unit-test-contract.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Unit testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternatives-to-the-factory-pattern">Alternatives to the factory pattern</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-the-product-directly">Construct the product directly</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#register-the-instance-with-a-contract-registry">Register the instance with a contract registry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-monolithic-contract">Use a monolithic contract</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-factory-pattern">Implementing the factory pattern</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-factory-contract">The <code class="docutils literal notranslate"><span class="pre">factory</span></code> contract</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-produce-endpoint">The <code class="docutils literal notranslate"><span class="pre">produce</span></code> endpoint</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-product-contract">The <code class="docutils literal notranslate"><span class="pre">product</span></code> contract</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-initialize-endpoint">The <code class="docutils literal notranslate"><span class="pre">initialize</span></code> endpoint</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#security-considerations">Security considerations</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/Concordium/concordium.github.io/edit/main/source/mainnet/docs/smart-contracts/guides/factory-pattern.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  

  <p class="copyright">
    
      © Copyright 2021 - 2025, Concordium Software ApS.
      <br/>
    
  </p>

  <style>
    .cc {
      position: relative;
      bottom: 0%;
      left: 0%;
    }

    .cc a {
      display: inline-block;
      text-align: left;
      padding-left: 16px;
      padding-bottom: 8px;
      color: black;
      font-size: 8px;
    }
</style>

<div class="cc">
  <a text-decoration=none href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img src="../../../_static/cc-sa-by.png" />
  </a>
  <a text-decoration=none href="../../../net/guides/legal.html" >
    Legal information
  </a>
</div>
  <div id="cookie-consent" class="consent">
    <p>This website only aggregates and analyzes the actions you take here if you allow cookies. If you do not allow cookies, it protects your privacy, but also prevents the owner from learning from your actions and creating a better experience for you and other users.</p><p>Note that if you opt in and you clear your cookies, delete the opt-in cookie, or if you change computers or Web browsers, you will need to perform the opt-in procedure again.</p>
    <button onclick="consentGranted()">Allow</button>
    <button onclick="consentDenied()">Decline</button>
    <a href="https://concordium.com/privacy-policy/">Privacy policy</a>
</div>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];

// Save the choice in a cookie
function storeChoice(granted) {
  document.cookie = "cookie-consent=" + granted
}

// Look for a cookie storing the previous choice of the user.
// Returns undefined if no choice was stored, otherwise a boolean for whether the
// user gave consent.
function loadChoice() {
  if (!document.cookie.includes("cookie-consent=")) {
      return undefined;
  }
  return document.cookie.includes("cookie-consent=true")
}

// Removes the cookie consent banner
function removeCookieConsentBanner() {
  document.getElementById("cookie-consent").remove()
}

// Called by the cookie consent banner if granted permission
function consentGranted() {
  storeChoice(true)
  _paq.push(['setCookieConsentGiven']);
  removeCookieConsentBanner()
}

// Called by the cookie consent banner if denied permission
function consentDenied() {
  storeChoice(true)
  removeCookieConsentBanner()
}

const stored = loadChoice();
if (stored) {
 consentGranted()
}

_paq.push(['requireCookieConsent']);
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);

(function() {
    var u="https://concordium.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/concordium.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();

  // remember tracking consent was given for all subsequent page views and visits
_paq.push(['rememberCookieConsentGiven']);

</script>


<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/4771748.js"></script>
<!-- End of HubSpot Embed Code -->

  </body>
</html>